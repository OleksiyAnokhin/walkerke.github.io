<!DOCTYPE html>
<html lang="en_us.utf-8 pelican">
<head>
    <meta charset="utf-8">
    <title>Teaching with Interactive Data Visualization</title>
    <meta name="description" content="">
    <meta name="author" content="Kyle Walker">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://walkerke.github.io/theme/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="http://walkerke.github.io/theme/bootstrap.min.css" rel="stylesheet">
    <link href="http://walkerke.github.io/theme/bootstrap.min.responsive.css" rel="stylesheet">
    <link href="http://walkerke.github.io/theme/local.css" rel="stylesheet">
    <link href="http://walkerke.github.io/theme/pygments.css" rel="stylesheet">

</head>

<body>

<div class="navbar">
    <div class="navbar-inner">
    <div class="container">

         <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
         </a>

        <a class="brand" href="http://walkerke.github.io">Teaching with Interactive Data Visualization</a>

        <div class="nav-collapse">
        <ul class="nav">
            
            <li><a href="http://walkerke.github.io/about/">About</a></li>
            <li><a href="http://walkerke.github.io/rpydocs/">RPubs/IPython Notebooks</a></li>
        </ul>
        </div>
        
    </div>
    </div>
</div>

<div class="container">
    <div class="content">
    <div class="row">

        <div class="span9">
        

        


    <div class='article'>
        <div class="content-title">
            <a href="http://walkerke.github.io/2015/02/religion/"><h1>Mapping religious adherence in the US with CartoDB and value-by-alpha</h1></a>
Thu 26 February 2015

by <a class="url fn" href="http://walkerke.github.io/author/kyle-walker.html">Kyle Walker</a>
 


 
        </div>
        
        <div><p>Before coming to TCU, I worked as a data analyst for the <a href="https://www.cpg.org/">Church Pension Group</a>, which manages the retirement funds and provides other financial services for the Episcopal Church.  I was part of a small research group that completed both internal and public-facing studies using the company's data.  <a href="https://www.cpg.org/global/research/reports-statistics/">You can take a look at some of the studies I worked on here</a>.  While I was at CPG, I developed an interest in the sociology of religion, as changing rates of religious adherence were of critical importance to CPG's work, as they impact the overall viability of parishes (and in turn the fiscal health of the Church).  During this time, data for the <a href="http://www.rcms2010.org/">2010 US Religion Census (or Religious Congregations and Membership Study, abbreviated as RCMS)</a> started to become available.  As the US Census does not ask questions about religion, researchers interested in studying religion must turn to other data sources like these.  </p>
<p>I never had the opportunity to really dig into this dataset while at CPG, as I left for my current position at TCU shortly afterward.  However, as I teach about the geography of religious adherence (defined here as the proportion of the population actively practicing a religion) in my World Regional Geography course, I took the opportunity to dive back into the data.  I was inspired by <a href="http://www.glenmary.org/rcms2010/">this map from the Glenmary Research Center</a> which maps the top religious family by county in the United States.  This map is excellent, but I wanted an interactive version that I could explore with my students in class (and that they could explore outside of class).  However, I did really like the cartographic technique they used to present the data.  Their approach is similar to the <strong>value-by-alpha</strong> approach, which is a method for bivariate mapping.  In this instance, the top religious group in each county is assigned a color; then, the intensity of the color is related to the adherence percentage for that group.  This makes sense; if two counties have Catholic as their top group, but one has an adherence of 75 percent as opposed to 20 percent for the other, they should not be represented that way.  </p>
<p>Value-by-alpha works in a similar way in that the color of a feature represents one attribute (often a nominal attribute, mapped with a qualitative color scheme), and the opacity of that feature represents another (a quantitative attribute).  My inspiration for the technique comes from <a href="https://twitter.com/awoodruff">Andy Woodruff's</a> fine work on the topic: you can read about Andy's work <a href="http://andywoodruff.com/blog/how-to-make-a-value-by-alpha-map/">here</a>, <a href="http://andywoodruff.com/blog/value-by-alpha-maps/">here</a>, and <a href="http://www.ncbi.nlm.nih.gov/pmc/articles/PMC3173776/">here</a>.  </p>
<p>I chose to implement value-by-alpha using <a href="http://cartodb.com/">CartoDB</a>, a phenomenal web-based platform for creating interactive maps.  CartoDB's functionality ranges from the creation of simple maps with a user-friendly web UI to actual GIS functionality using its PostGIS backend with spatial SQL.  Here is the map I created; below, I'll explain how I did it!  Use the arrows button in the upper left to pop the map out to full screen.  </p>
<iframe width='100%' height='600' frameborder='0' src='http://kwalkertcu.cartodb.com/viz/dfe2d3b2-a0da-11e4-a315-0e4fddd5de28/embed_map' allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>

<p>The map shows the top religious adherence group by county, with some key differences from the Glenmary map; I classified the data as Catholic, Evangelical Protestant, Latter-Day Saints (Mormon), Mainline Protestant, and Black Protestant.  No other major category was the top group in the lower 48 states plus DC.  I used R to process the data; I won't go into detail about that here, but you can <a href="https://github.com/walkerke/teaching-with-datavis/blob/master/religion/religion2.R">view the code in my GitHub repository</a>.  The whole process can be reproduced by <a href="https://github.com/walkerke/teaching-with-datavis/tree/master/religion">cloning the repo</a>, running the script, and zipping up the new shapefile <code>cty_religion</code> for uploading to CartoDB. </p>
<p>Uploading your data to CartoDB is straightforward: once your data are in the right format (in this instance, in the form of a zipped shapefile), just sign in and drag and drop!  Once your data have loaded, CartoDB includes a number of "wizards" you can use to style your data in a very user-friendly way.  For more complex visualizations, however, you can use <a href="https://www.mapbox.com/tilemill/docs/manual/carto/">CartoCSS</a>.  CartoCSS, which is also used by MapBox Studio (another new favorite of mine), is a CSS-like syntax for styling map data.  It also makes bivariate visualizations like value-by-alpha maps possible.  To style the map, I grabbed some colors from <a href="http://colorbrewer2.org/">ColorBrewer</a> and used the following syntax: </p>
<div class="highlight"><pre><span class="nf">#cty_religion</span> <span class="p">{</span>
   <span class="n">line</span><span class="o">-</span><span class="k">color</span><span class="o">:</span> <span class="m">#FFF</span><span class="p">;</span>
   <span class="n">line</span><span class="o">-</span><span class="k">width</span><span class="o">:</span> <span class="m">1</span><span class="p">;</span>
   <span class="n">line</span><span class="o">-</span><span class="k">opacity</span><span class="o">:</span> <span class="m">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="nf">#cty_religion</span><span class="o">[</span><span class="nt">religion</span><span class="o">=</span><span class="s2">&quot;Evangelical&quot;</span><span class="o">]</span> <span class="p">{</span>
   <span class="n">polygon</span><span class="o">-</span><span class="n">fill</span><span class="o">:</span> <span class="m">#e41a1c</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#cty_religion</span><span class="o">[</span><span class="nt">religion</span><span class="o">=</span><span class="s2">&quot;Catholic&quot;</span><span class="o">]</span> <span class="p">{</span>
   <span class="n">polygon</span><span class="o">-</span><span class="n">fill</span><span class="o">:</span> <span class="m">#377eb8</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#cty_religion</span><span class="o">[</span><span class="nt">religion</span><span class="o">=</span><span class="s2">&quot;Mainline&quot;</span><span class="o">]</span> <span class="p">{</span>
   <span class="n">polygon</span><span class="o">-</span><span class="n">fill</span><span class="o">:</span> <span class="m">#4daf4a</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#cty_religion</span><span class="o">[</span><span class="nt">religion</span><span class="o">=</span><span class="s2">&quot;LDS&quot;</span><span class="o">]</span> <span class="p">{</span>
   <span class="n">polygon</span><span class="o">-</span><span class="n">fill</span><span class="o">:</span> <span class="m">#984ea3</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#cty_religion</span><span class="o">[</span><span class="nt">religion</span><span class="o">=</span><span class="s2">&quot;African-American&quot;</span><span class="o">]</span> <span class="p">{</span>
   <span class="n">polygon</span><span class="o">-</span><span class="n">fill</span><span class="o">:</span> <span class="m">#ff7f00</span><span class="p">;</span>
<span class="p">}</span>

<span class="nf">#cty_religion</span><span class="o">[</span><span class="nt">percent</span> <span class="o">&gt;=</span> <span class="nt">0</span><span class="o">]</span> <span class="p">{</span>
  <span class="n">polygon</span><span class="o">-</span><span class="k">opacity</span><span class="o">:</span> <span class="m">0</span><span class="o">.</span><span class="m">2</span><span class="p">;</span> 
<span class="p">}</span>
<span class="nf">#cty_religion</span><span class="o">[</span><span class="nt">percent</span> <span class="o">&gt;=</span> <span class="nt">20</span><span class="o">]</span> <span class="p">{</span>
  <span class="n">polygon</span><span class="o">-</span><span class="k">opacity</span><span class="o">:</span> <span class="m">0</span><span class="o">.</span><span class="m">4</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#cty_religion</span><span class="o">[</span><span class="nt">percent</span> <span class="o">&gt;=</span> <span class="nt">30</span><span class="o">]</span> <span class="p">{</span>
  <span class="n">polygon</span><span class="o">-</span><span class="k">opacity</span><span class="o">:</span> <span class="m">0</span><span class="o">.</span><span class="m">6</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#cty_religion</span><span class="o">[</span><span class="nt">percent</span> <span class="o">&gt;=</span> <span class="nt">40</span><span class="o">]</span> <span class="p">{</span>
  <span class="n">polygon</span><span class="o">-</span><span class="k">opacity</span><span class="o">:</span> <span class="m">0</span><span class="o">.</span><span class="m">8</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>The <code>polygon-fill</code> method is used to style my data by religious category with colors; the <code>polygon-opacity</code> method then adjusts the opacity of the features, which then blend with the light-gray CartoDB basemap.  I used, roughly, a quantile classification scheme with four bins (with some slight rounding to 20, 30, and 40) for this.  The map, I feel, shows clear trends in religious adherence in the US.  The South is the Evangelical center of the country; Catholicism is more prevalent along the US/Mexico border and in the Northeast, Utah is a Mormon stronghold, and Mainline Protestantism predominates in the Upper Midwest.   The value-by-alpha approach also gives the viewer a sense of the relative religiosity of different places; whereas Utah and the Southeast appear to have much stronger adherence to their top religious groups, the opacity of features in the Northwest suggests lower religiosity there (or at least no group that is significant numbers-wise).  </p>
<p>There is a lot more I'd like to do with this map; here are some ideas: </p>
<ul>
<li>I've restricted this to the lower 48 states plus DC; Alaska and Hawaii should be added.  </li>
<li>I'd like a better legend that shows variation in opacity as well as hue; I experimented with this a little but couldn't quite get anything satisfactory working.  </li>
<li>It would be great to have an interactive chart appear upon clicking each county that shows the overall distribution of each group; this is beyond my current CartoDB.js skills but something to consider for a future iteration.  </li>
</ul>
<p>If you have any comments or questions, please let me know!</p>
<p><strong>Thanks to:</strong></p>
<ul>
<li>Andy Woodruff and others for resources on the value-by-alpha technique</li>
<li>CartoDB</li>
<li>The <a href="http://www.thearda.com/">Association of Religion Data Archives</a> for providing free access to the RCMS data</li>
<li><a href="http://www.nhgis.org">NHGIS</a> at the University of Minnesota for the spatial data</li>
<li>The Glenmary Research Center for inspiring this map</li>
</ul></div>
        <hr />
    </div>
		

 
        

 

    <div class='article'>
        <a href="http://walkerke.github.io/2014/12/dygraphs/"><h2>Charting time series data with dygraphs in R and Python</h2></a>
        <div class= "well small"> Sat 20 December 2014

by <a class="url fn" href="http://walkerke.github.io/author/kyle-walker.html">Kyle Walker</a>
 


 </div>
        <div class="summary"><p>This past week, the good people at <a href="http://www.rstudio.com">RStudio</a> advertised over Twitter the release of <a href="http://www.htmlwidgets.org/index.html">htmlwidgets for R</a>, a project in collaboration with <a href="http://rcharts.io">rCharts</a> wizards <a href="https://twitter.com/ramnath_vaidya">Ramnath Vaidyanathan</a> and <a href="https://twitter.com/timelyportfolio">Kenton Russell</a>. The packages showcased are incredible; I was particularly intrigued by the <a href="http://rstudio.github.io/dygraphs/">dygraphs</a> package, which creates interactive time-series charts.  </p>
<p>Aside from maps ...</p> <a class="btn btn-info xsmall" href="http://walkerke.github.io/2014/12/dygraphs/">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="http://walkerke.github.io/2014/12/slidify/"><h2>Using Slidify to teach with interactive content</h2></a>
        <div class= "well small"> Tue 02 December 2014

by <a class="url fn" href="http://walkerke.github.io/author/kyle-walker.html">Kyle Walker</a>
 


 </div>
        <div class="summary"><p>I frequently come across criticisms of PowerPoint as a presentation tool, which is interesting to me given the ubiquity of its use across industries.  When I worked as a data analyst prior to coming to TCU, I frequently prepared PowerPoints using a company template for my boss's presentations or ...</p> <a class="btn btn-info xsmall" href="http://walkerke.github.io/2014/12/slidify/">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="http://walkerke.github.io/2014/10/russia-lex/"><h2>Life expectancy trends in the former USSR</h2></a>
        <div class= "well small"> Thu 16 October 2014

by <a class="url fn" href="http://walkerke.github.io/author/kyle-walker.html">Kyle Walker</a>
 


 </div>
        <div class="summary"><p>When covering Russia and the former republics of the USSR in World Regional Geography, a key part of my material addresses the issues that some of these countries have had in their transitions from centralized to market economies.  Some of these countries experienced dramatic demographic shifts after the dissolution of ...</p> <a class="btn btn-info xsmall" href="http://walkerke.github.io/2014/10/russia-lex/">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="http://walkerke.github.io/2014/08/un-projections/"><h2>Exploring the United Nations population projections with rCharts</h2></a>
        <div class= "well small"> Tue 05 August 2014

by <a class="url fn" href="http://walkerke.github.io/author/kyle-walker.html">Kyle Walker</a>
 


 </div>
        <div class="summary"><p><strong>Please note: some NVD3 charts are performing very slowly in the latest version of Google Chrome at the moment; <a href="https://github.com/novus/nvd3/issues/702">see this GitHub issue.</a>  As such, this post is best viewed in other browsers.</strong></p>
<p>I recently came across <a href="http://dataremixed.com/2014/07/story-types-a-thought-starter/">this really interesting post</a> from <a href="https://twitter.com/DataRemixed">Ben Jones</a> that explores the history and future ...</p> <a class="btn btn-info xsmall" href="http://walkerke.github.io/2014/08/un-projections/">read more</a></div>
    </div>	
				
<div class="pagination">
<ul>
    <li class="prev disabled"><a href="#">&larr; Previous</a></li>

    <li class="active"><a href="http://walkerke.github.io/author/kyle-walker.html">1</a></li>
    <li class=""><a href="http://walkerke.github.io/author/kyle-walker2.html">2</a></li>

    <li class="next"><a href="http://walkerke.github.io/author/kyle-walker2.html">Next &rarr;</a></li>

</ul>
</div>
 
  
        </div>
        
        <div class="span3">

            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Site
                </li>
            
                <li><a href="http://walkerke.github.io/archives.html">Archives</a>
                <li><a href="http://walkerke.github.io/tags.html">Tags</a>
                <li><a href="http://walkerke.github.io/feeds/all.atom.xml" rel="alternate">Atom feed</a></li>
            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Categories
                </li>
                
                <li><a href="http://walkerke.github.io/category/charts.html">Charts</a></li>
                <li><a href="http://walkerke.github.io/category/maps.html">Maps</a></li>
                <li><a href="http://walkerke.github.io/category/presentations.html">Presentations</a></li>
                   
            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Links
                </li>
            
                <li><a href="http://personal.tcu.edu/kylewalker">Professional website</a></li>
                <li><a href="http://his.tcu.edu/">Department website</a></li>
                <li><a href="http://www.tcu.edu">TCU</a></li>
            </ul>
            </div>


            <div class="social">
            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Social
                </li>
           
                <li><a href="https://twitter.com/kyle_e_walker">Twitter</a></li>
                <li><a href="https://github.com/walkerke">Github</a></li>
                <li><a href="http://www.linkedin.com/in/walkerke">LinkedIn</a></li>
            </ul>
            </div>
            </div>

        </div>  
    </div>     </div> 
<footer>
<br />
<p><a href="http://walkerke.github.io">Teaching with Interactive Data Visualization</a> &copy; Kyle Walker 2015</p>
</footer>

</div> <!-- /container -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="http://walkerke.github.io/theme/bootstrap-collapse.js"></script>
<script>var _gaq=[['_setAccount','UA-51388803-1'],['_trackPageview']];(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.src='//www.google-analytics.com/ga.js';s.parentNode.insertBefore(g,s)}(document,'script'))</script>
 
</body>
</html>