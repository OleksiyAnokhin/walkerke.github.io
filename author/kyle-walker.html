<!DOCTYPE html>
<html lang="en_us.utf-8 pelican">
<head>
    <meta charset="utf-8">
    <title>Teaching with Interactive Data Visualization</title>
    <meta name="description" content="">
    <meta name="author" content="Kyle Walker">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://walkerke.github.io/theme/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="http://walkerke.github.io/theme/bootstrap.min.css" rel="stylesheet">
    <link href="http://walkerke.github.io/theme/bootstrap.min.responsive.css" rel="stylesheet">
    <link href="http://walkerke.github.io/theme/local.css" rel="stylesheet">
    <link href="http://walkerke.github.io/theme/pygments.css" rel="stylesheet">

</head>

<body>

<div class="navbar">
    <div class="navbar-inner">
    <div class="container">

         <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
         </a>

        <a class="brand" href="http://walkerke.github.io">Teaching with Interactive Data Visualization</a>

        <div class="nav-collapse">
        <ul class="nav">
            
            <li><a href="http://walkerke.github.io/about/">About</a></li>
            <li><a href="http://walkerke.github.io/rpydocs/">RPubs/IPython Notebooks</a></li>
        </ul>
        </div>
        
    </div>
    </div>
</div>

<div class="container">
    <div class="content">
    <div class="row">

        <div class="span9">
        

        


    <div class='article'>
        <div class="content-title">
            <a href="http://walkerke.github.io/2014/12/dygraphs/"><h1>Charting time series data with dygraphs in R and Python</h1></a>
Sat 20 December 2014

by <a class="url fn" href="http://walkerke.github.io/author/kyle-walker.html">Kyle Walker</a>
 


 
        </div>
        
        <div><p>This past week, the good people at <a href="http://www.rstudio.com">RStudio</a> advertised over Twitter the release of <a href="http://www.htmlwidgets.org/index.html">htmlwidgets for R</a>, a project in collaboration with <a href="http://rcharts.io">rCharts</a> wizards <a href="https://twitter.com/ramnath_vaidya">Ramnath Vaidyanathan</a> and <a href="https://twitter.com/timelyportfolio">Kenton Russell</a>. The packages showcased are incredible; I was particularly intrigued by the <a href="http://rstudio.github.io/dygraphs/">dygraphs</a> package, which creates interactive time-series charts.  </p>
<p>Aside from maps, time series line charts are the most common chart type I use in my teaching, as I often discuss how characteristics of places evolve over time.  As such, I took dygraphs for a spin to create charts relevant to a couple topics I address in World Regional Geography.  </p>
<p>The first chart shows quarterly unemployment rates in Egypt over the past decade.  I obtained the data from <a href="https://www.quandl.com">Quandl</a>, a massive repository of publicly-available datasets, by connecting to their API.  Quandl aims to be as user-friendly as possible; as such, <a href="https://www.quandl.com/ILOSTAT/UNE_DEAP_RT_SEX_T_Q_EGY-Unemployment-Rate-Quarterly-Egypt">on the page for the dataset you want</a>, you can get the command to access the data in R (or any number of other languages/formats) with a single click.  Additionally, you can specify the format for the data from Quandl; dygraphs in R accepts data in <code>xts</code> format, which Quandl can return for me.  </p>
<p>Once I have the data, I can create the plot.    </p>
<div class="highlight"><pre>library<span class="p">(</span>dygraphs<span class="p">)</span>
library<span class="p">(</span>Quandl<span class="p">)</span>


egypt <span class="o">&lt;-</span> Quandl<span class="p">(</span><span class="s">&quot;ILOSTAT/UNE_DEAP_RT_SEX_T_Q_EGY&quot;</span><span class="p">,</span> type <span class="o">=</span> <span class="s">&quot;xts&quot;</span><span class="p">)</span>

dygraph<span class="p">(</span>egypt<span class="p">,</span> main <span class="o">=</span> <span class="s">&quot;Quarterly unemployment in Egypt, 2003-2013&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  dySeries<span class="p">(</span><span class="s">&quot;V1&quot;</span><span class="p">,</span> label <span class="o">=</span> <span class="s">&quot;Unemployment (%)&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  dyRangeSelector<span class="p">(</span>strokeColor <span class="o">=</span> <span class="s">&quot;darkred&quot;</span><span class="p">,</span> fillColor <span class="o">=</span> <span class="s">&quot;darkred&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  dyOptions<span class="p">(</span>colors <span class="o">=</span> c<span class="p">(</span><span class="s">&quot;darkred&quot;</span><span class="p">,</span> <span class="s">&quot;darkred&quot;</span><span class="p">))</span> 
</pre></div>


<iframe id="frame" src="http://walkerke.github.io/teaching-with-datavis/dygraphs/egypt.html" height="500" width="800" frameBorder = "0" scrolling = "no"></iframe>

<p>The dygraphs package supports piping with the <code>%&gt;%</code> operator from the <strong>magrittr</strong> package, which organizes the code nicely.  I've changed the label in the legend and the colors, though I did notice that I had to supply a length-2 vector of colors to get the line's color to change, even though I only had one line.  I've also created a range selector at the bottom of the plot.  The chart itself has excellent interactivity; click and drag on the plot to zoom in to a specific section, and double-click to return to the original view.  In class, I can use this chart to show the major spike in unemployment after the fall of the Mubarak regime in early 2011. Unemployment, especially among youth, remains a critical issue in Egypt; <a href="http://data.worldbank.org/indicator/SL.UEM.1524.ZS">the World Bank estimates that 38.9 percent of Egyptians aged 15-24 were unemployed in 2013</a>.  </p>
<p>The World Bank API is also an excellent resource for demographic and economic data; <a href="http://walkerke.github.io/2014/03/tfr-in-europe/">I've written about using it here</a>.  Quandl also provides access to World Bank data, but I'll include an example below that involves connecting directly to the World Bank's API to show how to get data from a different format into dygraphs.  </p>
<p>The <strong>WDI</strong> package allows R users to connect directly to the World Bank's API and download data for selected countries, indicators, and years from the World Bank's <a href="http://data.worldbank.org/">Open Data Catalog</a>.  The code below fetches <a href="http://data.worldbank.org/indicator/TX.QTY.MRCH.XD.WD">export volume index data</a>, which shows how the relative size of countries' export economies have changed over time.  I discuss this in class heavily in the context of China, so I'll get data to compare China and the United States.  </p>
<div class="highlight"><pre>library<span class="p">(</span>WDI<span class="p">)</span>
library<span class="p">(</span>tidyr<span class="p">)</span>
library<span class="p">(</span>xts<span class="p">)</span>
library<span class="p">(</span>dplyr<span class="p">)</span>

df <span class="o">&lt;-</span> WDI<span class="p">(</span>country <span class="o">=</span> c<span class="p">(</span><span class="s">&quot;CN&quot;</span><span class="p">,</span> <span class="s">&quot;US&quot;</span><span class="p">),</span> indicator <span class="o">=</span> <span class="s">&quot;TX.QTY.MRCH.XD.WD&quot;</span><span class="p">,</span> start <span class="o">=</span> <span class="m">1980</span><span class="p">,</span> end <span class="o">=</span> <span class="m">2013</span><span class="p">,</span> extra <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>

df<span class="o">$</span>exports <span class="o">&lt;-</span> df<span class="o">$</span>TX.QTY.MRCH.XD.WD

df1 <span class="o">&lt;-</span> df <span class="o">%&gt;%</span>
  select<span class="p">(</span>country<span class="p">,</span> year<span class="p">,</span> exports<span class="p">)</span> <span class="o">%&gt;%</span>
  mutate<span class="p">(</span>country <span class="o">=</span> gsub<span class="p">(</span><span class="s">&quot;United States&quot;</span><span class="p">,</span> <span class="s">&quot;USA&quot;</span><span class="p">,</span> df<span class="o">$</span>country<span class="p">))</span> <span class="o">%&gt;%</span>
  spread<span class="p">(</span>key <span class="o">=</span> country<span class="p">,</span> value <span class="o">=</span> exports<span class="p">)</span> <span class="o">%&gt;%</span>
  mutate<span class="p">(</span>date <span class="o">=</span> as.Date<span class="p">(</span>as.character<span class="p">(</span>year<span class="p">),</span> format <span class="o">=</span> <span class="s">&quot;%Y&quot;</span><span class="p">))</span> <span class="o">%&gt;%</span>
  select<span class="p">(</span><span class="o">-</span>year<span class="p">)</span> 

xtdata <span class="o">&lt;-</span> xts<span class="p">(</span>df1<span class="p">,</span> order.by <span class="o">=</span> df1<span class="o">$</span>date<span class="p">)</span> 

xtdata<span class="o">$</span>date <span class="o">&lt;-</span> <span class="kc">NULL</span>
</pre></div>


<p>The WDI package returns data in "tidy" format, in which rows represent country-years.  I've reshaped my data frame to "wide" format, so that columns represent countries, and then I converted the data frame to an <code>xts</code> object for plotting with dygraphs.  Now, I can create the plot: </p>
<div class="highlight"><pre>dygraph<span class="p">(</span>xtdata<span class="p">,</span> main <span class="o">=</span> <span class="s">&quot;Export volume index, 1980-2013 (2000 = 100)&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  dyHighlight<span class="p">(</span>highlightSeriesOpts <span class="o">=</span> list<span class="p">(</span>strokeWidth <span class="o">=</span> <span class="m">3</span><span class="p">))</span> <span class="o">%&gt;%</span>
  dyOptions<span class="p">(</span>colors <span class="o">=</span> c<span class="p">(</span><span class="s">&quot;red&quot;</span><span class="p">,</span> <span class="s">&quot;navy&quot;</span><span class="p">))</span>
</pre></div>


<iframe id="frame" src="http://walkerke.github.io/teaching-with-datavis/dygraphs/exports.html" height="500" width="800" frameBorder = "0" scrolling = "no"></iframe>

<p>I've configured this plot so that a data series is highlighted if hovered over by the user's cursor.  The chart is designed to show one perspective on the massive growth of China's export economy in recent years; its index is over 700 in 2013, which means that China's export volume in this year is over seven times what it was in 2000.  By contrast, export volume in the United States only increased about 50 percent during the same period.  </p>
<p>Dygraphs can also be produced in my other language of choice, Python, using the <a href="https://github.com/DayStarEngineering/PyDyGraphs">PyDyGraphs module, available from GitHub.</a>  The module allows you to create interactive dygraphs charts in your IPython Notebook session.  This module is also very user-friendly; download the <code>pydygraphs.py</code> module from GitHub and run the code below in your IPython Notebook to produce a plot of aging over time in Italy, Spain, and the Netherlands.  This module is not as mature as the R package, however; I was unable to display the plot in <a href="http://nbviewer.ipython.org/gist/walkerke/7d055b109a3f4b790127">nbviewer</a>, although admittedly my knowledge of the Notebook's architecture is limited.  </p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">wbdata</span> <span class="kn">as</span> <span class="nn">wb</span>
<span class="kn">import</span> <span class="nn">pydygraphs</span>

<span class="c">## First, fetch the data from the World Bank API</span>

<span class="n">over65ind</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;SP.POP.65UP.TO.ZS&quot;</span><span class="p">:</span> <span class="s">&quot;pctover65&quot;</span><span class="p">}</span>

<span class="n">countries</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;IT&quot;</span><span class="p">,</span> <span class="s">&quot;NL&quot;</span><span class="p">,</span> <span class="s">&quot;ES&quot;</span><span class="p">]</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">get_dataframe</span><span class="p">(</span><span class="n">over65ind</span><span class="p">,</span> <span class="n">country</span> <span class="o">=</span> <span class="n">countries</span><span class="p">,</span> <span class="n">data_date</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1960</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c">## Now, reshape to wide format</span>

<span class="n">wide</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">df_all</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="s">&#39;pctover65&#39;</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="s">&#39;date&#39;</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="s">&#39;country&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">wide</span><span class="p">[</span><span class="s">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wide</span><span class="p">[</span><span class="s">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

<span class="c">## Finally, create the interactive plot!</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">pydygraphs</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

<span class="n">xaxis</span> <span class="o">=</span> <span class="s">&#39;date&#39;</span>

<span class="n">fig</span><span class="o">.</span><span class="n">plotDataFrame</span><span class="p">(</span><span class="n">wide</span><span class="p">,</span> <span class="n">xaxis</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;Percent of population over age 65&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&quot;Year&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;Percent over 65&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p>Thanks are due, as always, to the RStudio team, Ramnath, and Kenton for their amazing work!</p></div>
        <hr />
    </div>
		

 
        

 

    <div class='article'>
        <a href="http://walkerke.github.io/2014/12/slidify/"><h2>Using Slidify to teach with interactive content</h2></a>
        <div class= "well small"> Tue 02 December 2014

by <a class="url fn" href="http://walkerke.github.io/author/kyle-walker.html">Kyle Walker</a>
 


 </div>
        <div class="summary"><p>I frequently come across criticisms of PowerPoint as a presentation tool, which is interesting to me given the ubiquity of its use across industries.  When I worked as a data analyst prior to coming to TCU, I frequently prepared PowerPoints using a company template for my boss's presentations or ...</p> <a class="btn btn-info xsmall" href="http://walkerke.github.io/2014/12/slidify/">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="http://walkerke.github.io/2014/10/russia-lex/"><h2>Life expectancy trends in the former USSR</h2></a>
        <div class= "well small"> Thu 16 October 2014

by <a class="url fn" href="http://walkerke.github.io/author/kyle-walker.html">Kyle Walker</a>
 


 </div>
        <div class="summary"><p>When covering Russia and the former republics of the USSR in World Regional Geography, a key part of my material addresses the issues that some of these countries have had in their transitions from centralized to market economies.  Some of these countries experienced dramatic demographic shifts after the dissolution of ...</p> <a class="btn btn-info xsmall" href="http://walkerke.github.io/2014/10/russia-lex/">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="http://walkerke.github.io/2014/08/un-projections/"><h2>Exploring the United Nations population projections with rCharts</h2></a>
        <div class= "well small"> Tue 05 August 2014

by <a class="url fn" href="http://walkerke.github.io/author/kyle-walker.html">Kyle Walker</a>
 


 </div>
        <div class="summary"><p><strong>Please note: some NVD3 charts are performing very slowly in the latest version of Google Chrome at the moment; <a href="https://github.com/novus/nvd3/issues/702">see this GitHub issue.</a>  As such, this post is best viewed in other browsers.</strong></p>
<p>I recently came across <a href="http://dataremixed.com/2014/07/story-types-a-thought-starter/">this really interesting post</a> from <a href="https://twitter.com/DataRemixed">Ben Jones</a> that explores the history and future ...</p> <a class="btn btn-info xsmall" href="http://walkerke.github.io/2014/08/un-projections/">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="http://walkerke.github.io/2014/06/rcharts-pyramids/"><h2>Interactive international population pyramids with R, rCharts</h2></a>
        <div class= "well small"> Sat 07 June 2014

by <a class="url fn" href="http://walkerke.github.io/author/kyle-walker.html">Kyle Walker</a>
 


 </div>
        <div class="summary"><p>I find population pyramids to be very effective teaching tools.  In short, a population pyramid is a type of chart that shows the population size of different age cohorts on the x-axis, with gender usually displayed back-to-back to create the shape of a "pyramid."  It is used to illustrate a ...</p> <a class="btn btn-info xsmall" href="http://walkerke.github.io/2014/06/rcharts-pyramids/">read more</a></div>
    </div>	
				
<div class="pagination">
<ul>
    <li class="prev disabled"><a href="#">&larr; Previous</a></li>

    <li class="active"><a href="http://walkerke.github.io/author/kyle-walker.html">1</a></li>
    <li class=""><a href="http://walkerke.github.io/author/kyle-walker2.html">2</a></li>

    <li class="next"><a href="http://walkerke.github.io/author/kyle-walker2.html">Next &rarr;</a></li>

</ul>
</div>
 
  
        </div>
        
        <div class="span3">

            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Site
                </li>
            
                <li><a href="http://walkerke.github.io/archives.html">Archives</a>
                <li><a href="http://walkerke.github.io/tags.html">Tags</a>
                <li><a href="http://walkerke.github.io/" rel="alternate">Atom feed</a></li>
            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Categories
                </li>
                
                <li><a href="http://walkerke.github.io/category/plotly.html">Plotly</a></li>
                <li><a href="http://walkerke.github.io/category/presentations.html">Presentations</a></li>
                <li><a href="http://walkerke.github.io/category/r.html">R</a></li>
                <li><a href="http://walkerke.github.io/category/rcharts.html">rCharts</a></li>
                <li><a href="http://walkerke.github.io/category/shiny.html">Shiny</a></li>
                   
            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Links
                </li>
            
                <li><a href="http://personal.tcu.edu/kylewalker">Professional website</a></li>
                <li><a href="http://his.tcu.edu/">TCU Dept. of History & Geography</a></li>
                <li><a href="http://www.tcu.edu">TCU</a></li>
            </ul>
            </div>


            <div class="social">
            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Social
                </li>
           
                <li><a href="https://twitter.com/kyle_e_walker">Twitter</a></li>
                <li><a href="https://github.com/walkerke">Github</a></li>
                <li><a href="http://www.linkedin.com/in/walkerke">LinkedIn</a></li>
            </ul>
            </div>
            </div>

        </div>  
    </div>     </div> 
<footer>
<br />
<p><a href="http://walkerke.github.io">Teaching with Interactive Data Visualization</a> &copy; Kyle Walker 2014</p>
</footer>

</div> <!-- /container -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="http://walkerke.github.io/theme/bootstrap-collapse.js"></script>
<script>var _gaq=[['_setAccount','UA-51388803-1'],['_trackPageview']];(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.src='//www.google-analytics.com/ga.js';s.parentNode.insertBefore(g,s)}(document,'script'))</script>
 
</body>
</html>