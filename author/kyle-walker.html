<!DOCTYPE html>
<html lang="en_us.utf-8 pelican">
<head>
    <meta charset="utf-8">
    <title>Teaching with Interactive Data Visualization</title>
    <meta name="description" content="">
    <meta name="author" content="Kyle Walker">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://walkerke.github.io/theme/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="http://walkerke.github.io/theme/bootstrap.min.css" rel="stylesheet">
    <link href="http://walkerke.github.io/theme/bootstrap.min.responsive.css" rel="stylesheet">
    <link href="http://walkerke.github.io/theme/local.css" rel="stylesheet">
    <link href="http://walkerke.github.io/theme/pygments.css" rel="stylesheet">

</head>

<body>

<div class="navbar">
    <div class="navbar-inner">
    <div class="container">

         <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
         </a>

        <a class="brand" href="http://walkerke.github.io">Teaching with Interactive Data Visualization</a>

        <div class="nav-collapse">
        <ul class="nav">
            
            <li><a href="http://walkerke.github.io/about/">About</a></li>
        </ul>
        </div>
        
    </div>
    </div>
</div>

<div class="container">
    <div class="content">
    <div class="row">

        <div class="span9">
        

        


    <div class='article'>
        <div class="content-title">
            <a href="http://walkerke.github.io/2014/06/rcharts-pyramids/"><h1>Interactive international population pyramids with R, rCharts</h1></a>
Sat 07 June 2014

by <a class="url fn" href="http://walkerke.github.io/author/kyle-walker.html">Kyle Walker</a>
 


 
        </div>
        
        <div><p>I find population pyramids to be very effective teaching tools.  In short, a population pyramid is a type of chart that shows the population size of different age cohorts on the x-axis, with gender usually displayed back-to-back to create the shape of a "pyramid."  It is used to illustrate a snapshot of the age and sex structure of a population, and can serve as a tool that aids in discussion of many thematic issues such as population growth, aging, and gender imbalance.  The visually appealing structure of the population pyramid also makes it easy to compare the population structures of different countries, which is why I like to use pyramids in my classes.  This is exemplified by <a href="http://blogs.worldbank.org/futuredevelopment/end-population-pyramid">this post from the World Bank</a>, which shows how different "shapes" of the pyramid reflect different demographic contexts.  </p>
<p>I was originally motivated to learn interactive visualization to produce interactive population pyramids.  My inspiration came from these examples from <a href="http://vis.stanford.edu/jheer/d3/pyramid/shift.html">Jeff Heer</a> and <a href="http://bl.ocks.org/mbostock/4062085">Mike Bostock</a>, which use data from the U.S. Census.  Since then, a number of other creative interactive population pyramid applications have gotten a lot of attention, such as <a href="http://populationpyramid.net/">this visualization from Martin De Wulf</a>, and <a href="http://www.nytimes.com/2014/05/13/upshot/a-changing-shape-in-americas-age-distribution.html?rref=upshot&amp;_r=1">this animated graphic from the Pew Research Center</a>, referenced in <em>The New York Times'</em> Upshot.  </p>
<p>These are all great resources, but I wanted something both re-usable and customizable so that I could embed interactive pyramids for any country I needed in my slide decks for my World Regional Geography course.  To do this, I turned to the fantastic <a href="http://www.census.gov/population/international/data/idb/informationGateway.php">International Data Base from the US Census Bureau</a> for data, and the amazing <a href="http://rcharts.io">rCharts</a> to create the pyramids.  The Census Bureau's International Data Base contains a tremendous amount of information about basic demographic characteristics of the world's countries, and is easily downloaded; I've had students use it before to create their own population pyramids in Excel for class assignments.  However, as I wanted quick access to the data to in turn create interactive rCharts visualizations, I wrote a script, <code>rcharts_pyramids.R</code>, that includes functions to scrape the Data Base website and produce an interactive pyramid with R within seconds.  </p>
<p>Below, I'll discuss how to use the script.  I'd like anyone to be able to use this, regardless of their background with R; as such, I'm going to go easy on the technical details.  I'll follow up with another more code-heavy post, and <a href="https://github.com/walkerke/teaching-with-datavis/blob/master/pyramids/rcharts_pyramids.R">the code is available on GitHub here</a>.  </p>
<hr />
<p>To get started, make sure you have the following R packages installed: <strong>XML</strong>, <strong>reshape2</strong>, <strong>rCharts</strong>, and <strong>plyr</strong>.  <strong>rCharts</strong> is not on CRAN, so you'll need to install it from GitHub with the <strong>devtools</strong> package.  This script requires the <code>dev</code> branch of <strong>rCharts</strong>.  If you are just getting started with R, install the packages with the code below.  </p>
<div class="highlight"><pre>install.packages<span class="p">(</span>c<span class="p">(</span><span class="s">&#39;XML&#39;</span><span class="p">,</span> <span class="s">&#39;reshape2&#39;</span><span class="p">,</span> <span class="s">&#39;devtools&#39;</span><span class="p">,</span> <span class="s">&#39;plyr&#39;</span><span class="p">))</span>
library<span class="p">(</span>devtools<span class="p">)</span>
install_github<span class="p">(</span><span class="s">&#39;ramnathv/rCharts@dev&#39;</span><span class="p">)</span>
</pre></div>


<p>Once these packages are installed, you are ready to get started.  If you are using <a href="http://www.rstudio.com/">RStudio</a> (which I strongly recommend), simply enter the following command into the R Console: </p>
<div class="highlight"><pre>source<span class="p">(</span><span class="s">&#39;https://raw.githubusercontent.com/walkerke/teaching-with-datavis/master/pyramids/rcharts_pyramids.R&#39;</span><span class="p">)</span>
</pre></div>


<p>If you are not using RStudio, use <code>source_url</code> from the <strong>devtools</strong> package instead of <code>source</code>.  Alternatively, you can get the script from GitHub yourself and load it.</p>
<p>The script contains four functions: <code>getAgeTable</code>, <code>dPyramid</code>, <code>hPyramid</code>, and <code>nPyramid</code>.  <code>getAgeTable</code> is a helper function that uses the <strong>XML</strong> package to scrape data from the International Data Base and convert it into an R data frame.  I pull data from the category "Mid-year Population by Five Year Age Groups and Sex" to create the pyramids.  The other three functions are used to create population pyramids from the data with different JavaScript libraries available through <strong>rCharts</strong>.  Each function has three parameters:  </p>
<ol>
<li><code>country</code> (required): the FIPS 10-4 country code for your country of interest.  You can find the codes from <a href="http://en.wikipedia.org/wiki/List_of_FIPS_country_codes">this Wikipedia page</a>, or use the <a href="https://github.com/vincentarelbundock/countrycode"><strong>countrycode</strong> R package</a>.  </li>
<li><code>year</code> (required): The year for which you want to make the pyramid.  The Data Base includes historical information going back to 1950, and projected counts up to 2050 <a href="http://www.census.gov/population/international/data/idb/informationGateway.php">see this link for the Census Bureau's projection methodology</a>.  Not all years are available for all countries, however.  </li>
<li><code>colors</code> (optional): A vector of length 2 that contains the colors you want to use for your pyramid.  If you leave this argument blank, you'll get the default colors for your pyramid.  </li>
</ol>
<p>Now, let's see how this works!  </p>
<hr />
<p>The first example I'll show you is <code>nPyramid</code>, which uses the <a href="http://nvd3.org/">NVD3.js library</a>, which is built on top of D3.  I'm going to create a population pyramid for Qatar in 2014.  I spend a fair amount of time talking about Qatar in my course, as it exemplifies many of the topics we cover such as economic inequality, energy and economic growth, and international labor migration.  In fact, <a href="http://www.pewsocialtrends.org/2013/12/17/migration-tables/">around three-quarters of Qatar's population is foreign-born</a>; further, <a href="http://espn.go.com/video/clip?id=11019010&amp;categoryid=2378529">the conditions endured by migrant laborers in Qatar are attracting international attention in the run-up to the 2022 World Cup</a>.  </p>
<p>To create the visualization, simply type the following command into your R console: </p>
<div class="highlight"><pre>nPyramid<span class="p">(</span><span class="s">&#39;QA&#39;</span><span class="p">,</span> <span class="m">2014</span><span class="p">,</span> colors <span class="o">=</span> c<span class="p">(</span><span class="s">&#39;darkred&#39;</span><span class="p">,</span> <span class="s">&#39;silver&#39;</span><span class="p">))</span>
</pre></div>


<p>Which produces the chart below. I have trouble with NVD3 in the RStudio viewer, so you may need to open it in a web browser if you are using RStudio.  </p>
<iframe src="http://walkerke.github.io/teaching-with-datavis/pyramids/qatar.html" width="850" height="400" seamless scrolling="no" frameBorder = "0"></iframe>

<p>The pyramid is striking for the dramatic gender imbalance in Qatar introduced by the influx of foreign laborers to the country.  Males aged 30-34 number nearly 300,000; this is over four times the number of females in that age category, who number just over 70,000.  Admittedly, population pyramids like this can be problematic for making gender comparisons (<a href="http://bl.ocks.org/mbostock/4062085">Mike Bostock argues as much here</a>), but this is allayed somewhat when using these pyramids interactively, as the visualizations produce a tooltip on hover that returns the precise population count for the age cohort, allowing for comparisons of the numbers.  </p>
<hr />
<p>The next example comes from <a href="http://www.highcharts.com/">Highcharts</a>, an interactive JavaScript charting library that includes many different examples and is very well-documented.  I'm going to use Highcharts here to create an interactive population pyramid for Japan in 2050 with the <code>hPyramid</code> function.  In class, we discussed the <a href="http://www.economist.com/news/asia/21603076-first-time-proper-debate-starting-about-immigration-incredible-shrinking-country?spc=scode&amp;spv=xm&amp;ah=9d7f7ab945510a56fa6d37c30b6f1709">challenges Japan is facing as its population ages</a>; this population pyramid provided important visual context.  To create the chart, use the code below: </p>
<div class="highlight"><pre>hPyramid<span class="p">(</span><span class="s">&#39;JA&#39;</span><span class="p">,</span> <span class="m">2050</span><span class="p">,</span> colors <span class="o">=</span> c<span class="p">(</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="s">&#39;red&#39;</span><span class="p">))</span>
</pre></div>


<iframe src="http://walkerke.github.io/teaching-with-datavis/pyramids/japan2050.html" width="850" height="400" seamless scrolling="no" frameBorder = "0"></iframe>

<p>Japan's projected population structure in 2050 exemplifies an "inverted" population pyramid, with the oldest age cohorts comprising the largest proportions of the population, and the youngest the smallest.  There are many reasons why this is projected to happen in Japan, including high life expectancy, restrictive immigration policies, and declining marriage rates (contributing to low fertility levels).  In turn, Japan's shrinking workforce will have to provide for an increasingly large elderly population, which is illustrated in the chart.  As with the NVD3 pyramid, the chart gives a tooltip on mouseover that returns specific population figures.  One of the most striking features of the pyramid this reveals is the population of female centenarians (people aged 100+), which is projected to exceed 1 million by 2050 as per the Census Bureau.  </p>
<hr />
<p>The last example I'll show you is <code>dPyramid</code>, which uses the <a href="http://dimplejs.org/">DimpleJS</a> library, built on top of D3.  <code>dPyramid</code> works in much the same way as the other functions, but has the added bonus of being able to take advantage of Dimple's <code>storyboard</code> property, which facilitates the creation of temporal animations.  As such, <code>dPyramid</code> accepts a vector of years for the <code>year</code> parameter; if you choose multiple years instead of a single year, <code>dPyramid</code> will give you a population pyramid that changes over time.  Here's an example that shows the aging of Germany's population between 2000 and 2050.  If you are new to R, the <code>seq</code> function returns a sequence of numbers from argument 1 (in this case, the year 2000), to argument 2 (2050), in intervals of argument 3 (every 10 years).   </p>
<div class="highlight"><pre>dPyramid<span class="p">(</span><span class="s">&#39;GM&#39;</span><span class="p">,</span> seq<span class="p">(</span><span class="m">2000</span><span class="p">,</span> <span class="m">2050</span><span class="p">,</span> <span class="m">10</span><span class="p">),</span> colors <span class="o">=</span> c<span class="p">(</span><span class="s">&#39;black&#39;</span><span class="p">,</span> <span class="s">&#39;red&#39;</span><span class="p">))</span>
</pre></div>


<iframe src="http://walkerke.github.io/teaching-with-datavis/pyramids/germany.html" width="850" height="425" seamless scrolling="no" frameBorder = "0"></iframe>

<p>The animation does a compelling job of showing how Germany's population is projected to both age and shrink in the years ahead.  Animation can also be used to provide demographic context to key historical circumstances I teach about in class.  For example, I covered the devastation wrought by the <a href="http://www.aljazeera.com/indepth/features/2012/02/20122314155454169.html">Khmer Rouge</a> during the Cambodian genocide, and used the animated population pyramid below to illustrate the demographic impacts of the genocide. The chart covers 1974 to 1982, the time just before, during, and in the years following the Khmer Rouge.  </p>
<div class="highlight"><pre>dPyramid<span class="p">(</span><span class="s">&#39;CB&#39;</span><span class="p">,</span> seq<span class="p">(</span><span class="m">1974</span><span class="p">,</span> <span class="m">1982</span><span class="p">,</span> <span class="m">1</span><span class="p">))</span>
</pre></div>


<iframe src="http://walkerke.github.io/teaching-with-datavis/pyramids/cambodia.html" width="850" height="425" seamless scrolling="no" frameBorder = "0"></iframe>

<p>You can see how the bars shrink between 1975 and 1979, the years when Cambodia was ruled by the Khmer Rouge.  I could see the shock on some of my students' faces when I showed this to them - many of them were unfamiliar with the history of Cambodia and the Khmer Rouge.  The visualization shows an overall decline in population of around 900,000 between 1974 and 1979, which reflects official population numbers; this likely underestimates the scale of the atrocities in Cambodia (<a href="http://www.yale.edu/gsp/publications/KiernanRevised1.pdf">see the article linked here</a>), as the actual losses may have been twice that.  </p>
<p>To save any of your pyramids as a standalone HTML document, just assign your pyramid to a variable and use rCharts' <code>save</code> option to save your chart, setting the <code>cdn</code> parameter to <code>TRUE</code>.  The code below provides an example of how to save the html file in your working directory.    </p>
<div class="highlight"><pre>q1 <span class="o">&lt;-</span> nPyramid<span class="p">(</span><span class="s">&#39;QA&#39;</span><span class="p">,</span> <span class="m">2014</span><span class="p">,</span> colors <span class="o">=</span> c<span class="p">(</span><span class="s">&#39;darkred&#39;</span><span class="p">,</span> <span class="s">&#39;silver&#39;</span><span class="p">))</span>
q1<span class="o">$</span>save<span class="p">(</span><span class="s">&#39;qatar.html&#39;</span><span class="p">,</span> cdn <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</pre></div>


<hr />
<p>I've learned a lot about rCharts as I've put these together; my next post will cover how these charts are created.  In the meantime, have a look at the <a href="https://github.com/walkerke/teaching-with-datavis/blob/master/pyramids/rcharts_pyramids.R">code on GitHub</a>; you are welcome to use and modify it as you please.  I'd love to hear your comments or feedback; you can contact me at <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#107;&#121;&#108;&#101;&#46;&#119;&#97;&#108;&#107;&#101;&#114;&#64;&#116;&#99;&#117;&#46;&#101;&#100;&#117;">&#107;&#121;&#108;&#101;&#46;&#119;&#97;&#108;&#107;&#101;&#114;&#64;&#116;&#99;&#117;&#46;&#101;&#100;&#117;</a> or get in touch with me on <a href="https://twitter.com/kyle_e_walker">Twitter</a>.    </p>
<p><strong>Thanks to:</strong></p>
<ul>
<li><a href="https://twitter.com/ramnath_vaidya">Ramnath Vaidyanathan</a>, <a href="https://twitter.com/timelyportfolio">Timely Portfolio</a>, and <a href="https://twitter.com/jkiernander">John Kiernander</a> for their incredible contributions that make this all possible - and for helping me out with some Dimple formatting issues;</li>
<li>The authors of the NVD3, D3, and Highcharts JavaScript libraries;</li>
<li>The US Census Bureau for making the International Data Base such a valuable resource.   </li>
</ul></div>
        <hr />
    </div>
		

 
        

 

    <div class='article'>
        <a href="http://walkerke.github.io/2014/05/tourism-plotly/"><h2>Visualizing the economics of tourism in the Pacific with Plotly</h2></a>
        <div class= "well small"> Mon 12 May 2014

by <a class="url fn" href="http://walkerke.github.io/author/kyle-walker.html">Kyle Walker</a>
 


 </div>
        <div class="summary"><p>Over the last month or so, I've been working a lot with <a href="http://plot.ly">Plotly</a> to visualize data for my World Regional Geography course.  Plotly is a web-based service that allows for the creation of interactive, D3-based visualizations that can be easily shared.  Visualizations are deployed and hosted on Plotly's ...</p> <a class="btn btn-info xsmall" href="http://walkerke.github.io/2014/05/tourism-plotly/">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="http://walkerke.github.io/2014/03/tfr-in-europe/"><h2>Visualizing fertility trends in Europe</h2></a>
        <div class= "well small"> Thu 06 March 2014

by <a class="url fn" href="http://walkerke.github.io/author/kyle-walker.html">Kyle Walker</a>
 


 </div>
        <div class="summary"><p>In the classroom, interactive data visualizations can embed a wealth of information that can be interactively queried by the instructor depending on the course topics and students' questions.  The example I'll discuss below worked for me exactly in this way.  I'll show how to create an interactive chart ...</p> <a class="btn btn-info xsmall" href="http://walkerke.github.io/2014/03/tfr-in-europe/">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="http://walkerke.github.io/2014/01/hispanic-pop-by-state/"><h2>Visualizing the U.S. Hispanic population by state</h2></a>
        <div class= "well small"> Thu 09 January 2014

by <a class="url fn" href="http://walkerke.github.io/author/kyle-walker.html">Kyle Walker</a>
 


 </div>
        <div class="summary"><p>Welcome!  This is the first post of my effort to document my foray into developing interactive data visualizations for use in my teaching.  Hopefully these examples will be of use to some readers who are interested in creating their own visualizations.  </p>
<p>I'll first provide a bit of background.  I ...</p> <a class="btn btn-info xsmall" href="http://walkerke.github.io/2014/01/hispanic-pop-by-state/">read more</a></div>
    </div>	
				
<div class="pagination">
<ul>
    <li class="prev disabled"><a href="#">&larr; Previous</a></li>

    <li class="active"><a href="http://walkerke.github.io/author/kyle-walker.html">1</a></li>

    <li class="next disabled"><a href="#">&rarr; Next</a></li>

</ul>
</div>
 
  
        </div>
        
        <div class="span3">

            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Site
                </li>
            
                <li><a href="http://walkerke.github.io/">Archives</a>
                <li><a href="http://walkerke.github.io/tags.html">Tags</a>
                <li><a href="http://walkerke.github.io/" rel="alternate">Atom feed</a></li>
            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Categories
                </li>
                
                <li><a href="http://walkerke.github.io/category/misc.html">misc</a></li>
                   
            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Links
                </li>
            
                <li><a href="http://kylewalkertcu.wordpress.com/">Professional website</a></li>
                <li><a href="http://his.tcu.edu/">TCU Dept. of History & Geography</a></li>
                <li><a href="http://www.tcu.edu">TCU</a></li>
                <li><a href="http://www.r-bloggers.com/">R-bloggers</a></li>
            </ul>
            </div>


            <div class="social">
            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Social
                </li>
           
                <li><a href="https://twitter.com/kyle_e_walker">Twitter</a></li>
                <li><a href="https://github.com/walkerke">Github</a></li>
                <li><a href="http://www.linkedin.com/in/walkerke">LinkedIn</a></li>
            </ul>
            </div>
            </div>

        </div>  
    </div>     </div> 
<footer>
<br />
<p><a href="http://walkerke.github.io">Teaching with Interactive Data Visualization</a> &copy; Kyle Walker 2014</p>
</footer>

</div> <!-- /container -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="http://walkerke.github.io/theme/bootstrap-collapse.js"></script>
<script>var _gaq=[['_setAccount','UA-51388803-1'],['_trackPageview']];(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.src='//www.google-analytics.com/ga.js';s.parentNode.insertBefore(g,s)}(document,'script'))</script>
 
</body>
</html>