<!DOCTYPE html>
<html lang="en_us.utf-8 pelican">
<head>
    <meta charset="utf-8">
    <title>Teaching with Interactive Data Visualization</title>
    <meta name="description" content="">
    <meta name="author" content="Kyle Walker">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://walkerke.github.io/theme/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="http://walkerke.github.io/theme/bootstrap.min.css" rel="stylesheet">
    <link href="http://walkerke.github.io/theme/bootstrap.min.responsive.css" rel="stylesheet">
    <link href="http://walkerke.github.io/theme/local.css" rel="stylesheet">
    <link href="http://walkerke.github.io/theme/pygments.css" rel="stylesheet">

</head>

<body>

<div class="navbar">
    <div class="navbar-inner">
    <div class="container">

         <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
         </a>

        <a class="brand" href="http://walkerke.github.io">Teaching with Interactive Data Visualization</a>

        <div class="nav-collapse">
        <ul class="nav">
            
            <li><a href="http://walkerke.github.io/about/">About</a></li>
        </ul>
        </div>
        
    </div>
    </div>
</div>

<div class="container">
    <div class="content">
    <div class="row">

        <div class="span9">
        

        


    <div class='article'>
        <div class="content-title">
            <a href="http://walkerke.github.io/2014/03/tfr-in-europe/"><h1>Visualizing fertility trends in Europe</h1></a>
Thu 06 March 2014

by <a class="url fn" href="http://walkerke.github.io/author/kyle-walker.html">Kyle Walker</a>
 


 
        </div>
        
        <div><p>In the classroom, interactive data visualizations can embed a wealth of information that can be interactively queried by the instructor depending on the course topics and students' questions.  The example I'll discuss below worked for me exactly in this way.  I'll show how to create an interactive chart using the World Bank's open data API; my example looks at fertility trends in European countries since 1960.  </p>
<p><a href="http://data.worldbank.org/">The World Bank's Open Data catalog</a> is a tremendous resource for any instructor addressing global issues; the website itself has readily-available data and charts for view.  Additionally, the World Bank makes these datasets available to developers via their API, <a href="https://blogs.worldbank.org/opendata/accessing-world-bank-data-apis-python-r-ruby-stata">which can in turn be accessed through modules in Python, R, Ruby, and Stata</a>.    In R, the API is available through the <a href="https://github.com/vincentarelbundock/WDI">WDI</a> package by Vincent Arel-Bundock, which makes it very simple for users to quickly access formatted World Bank datasets.  With the <a href="https://github.com/ramnathv/rCharts">rCharts</a> package, R users can then create dynamic D3 visualizations using these data.  </p>
<p>In my World Regional Geography course at TCU, I spent a class period discussing demographic shifts in Europe, with a focus on fertility declines and aging populations in various parts of the continent.  My goal was to create a visualization that would allow me to interactively explore how fertility has declined in different ways in in different regions, and then discuss with my students the reasons why we observe these variations.  To get started, I called the World Bank API in R with the WDI package to give me the total fertility rates (the number of children a woman in a population would be expected to have in her lifetime given current age-specific fertility rates) for selected European countries by year since 1960.  The code below shows how to do this: </p>
<div class="highlight"><pre>library<span class="p">(</span>WDI<span class="p">)</span>
library<span class="p">(</span>rCharts<span class="p">)</span>
library<span class="p">(</span>plyr<span class="p">)</span>

countries <span class="o">&lt;-</span> c<span class="p">(</span><span class="s">&quot;AL&quot;</span><span class="p">,</span> <span class="s">&quot;AT&quot;</span><span class="p">,</span> <span class="s">&quot;BE&quot;</span><span class="p">,</span> <span class="s">&quot;BA&quot;</span><span class="p">,</span> <span class="s">&quot;BG&quot;</span><span class="p">,</span> <span class="s">&quot;HR&quot;</span><span class="p">,</span> <span class="s">&quot;CZ&quot;</span><span class="p">,</span> <span class="s">&quot;DK&quot;</span><span class="p">,</span> <span class="s">&quot;FI&quot;</span><span class="p">,</span> <span class="s">&quot;FR&quot;</span><span class="p">,</span> <span class="s">&quot;DE&quot;</span><span class="p">,</span> <span class="s">&quot;GR&quot;</span><span class="p">,</span> 
               <span class="s">&quot;HU&quot;</span><span class="p">,</span> <span class="s">&quot;IS&quot;</span><span class="p">,</span> <span class="s">&quot;IE&quot;</span><span class="p">,</span> <span class="s">&quot;IT&quot;</span><span class="p">,</span> <span class="s">&quot;NL&quot;</span><span class="p">,</span> <span class="s">&quot;NO&quot;</span><span class="p">,</span> <span class="s">&quot;PL&quot;</span><span class="p">,</span> <span class="s">&quot;PT&quot;</span><span class="p">,</span> <span class="s">&quot;RO&quot;</span><span class="p">,</span> <span class="s">&quot;RS&quot;</span><span class="p">,</span> <span class="s">&quot;SK&quot;</span><span class="p">,</span> <span class="s">&quot;SI&quot;</span><span class="p">,</span> 
               <span class="s">&quot;ES&quot;</span><span class="p">,</span> <span class="s">&quot;SE&quot;</span><span class="p">,</span> <span class="s">&quot;CH&quot;</span><span class="p">,</span> <span class="s">&quot;GB&quot;</span><span class="p">)</span>

tfr <span class="o">&lt;-</span> WDI<span class="p">(</span>country <span class="o">=</span> countries<span class="p">,</span> indicator <span class="o">=</span> <span class="s">&quot;SP.DYN.TFRT.IN&quot;</span><span class="p">,</span> start <span class="o">=</span> <span class="m">1960</span><span class="p">,</span> end <span class="o">=</span> <span class="m">2011</span><span class="p">)</span>
</pre></div>


<p>A couple notes about the above code.  The WDI package asks for a vector of ISO-2 country codes for which it will fetch data; you can get those from many places, such as <a href="http://en.wikipedia.org/wiki/ISO_3166-1_alpha-2">this Wikipedia page</a>.  The <code>WDI</code> function also requires the World Bank's code for your indicator of interest; you can use the <code>WDIsearch</code> function in R to look for indicator codes, or simply look them up on the World Bank's website.  I've selected the code for the total fertility rate (TFR), and asked the function to give me data from 1960 to 2011 (the last year that TFR data are available).   I now have an R data frame, <code>tfr</code>, that includes a time series of total fertility rates since 1960 for each country I asked for.  </p>
<p>To visualize the data, I have selected the <a href="http://nvd3.org/">NVD3 library</a>, which is a D3 charting library that is available to R users through rCharts.  The code below will clean the data slightly for visualization, and call rCharts' <code>nPlot</code> function to create an interactive chart.  </p>
<div class="highlight"><pre><span class="c1">#Clean up the data a bit</span>
tfr <span class="o">&lt;-</span> rename<span class="p">(</span>tfr<span class="p">,</span> replace <span class="o">=</span> c<span class="p">(</span><span class="s">&quot;SP.DYN.TFRT.IN&quot;</span> <span class="o">=</span> <span class="s">&quot;TFR&quot;</span><span class="p">))</span>

tfr<span class="o">$</span>TFR <span class="o">&lt;-</span> round<span class="p">(</span>tfr<span class="o">$</span>TFR<span class="p">,</span> <span class="m">2</span><span class="p">)</span>

<span class="c1"># Create the chart</span>
tfrPlot <span class="o">&lt;-</span> nPlot<span class="p">(</span>
  TFR <span class="o">~</span> year<span class="p">,</span> 
  data <span class="o">=</span> tfr<span class="p">,</span> 
  group <span class="o">=</span> <span class="s">&quot;country&quot;</span><span class="p">,</span>
  type <span class="o">=</span> <span class="s">&quot;lineChart&quot;</span><span class="p">)</span>

<span class="c1"># Add axis labels and format the tooltip</span>
tfrPlot<span class="o">$</span>yAxis<span class="p">(</span>axisLabel <span class="o">=</span> <span class="s">&quot;Total fertility rate&quot;</span><span class="p">,</span> width <span class="o">=</span> <span class="m">62</span><span class="p">)</span>

tfrPlot<span class="o">$</span>xAxis<span class="p">(</span>axisLabel <span class="o">=</span> <span class="s">&quot;Year&quot;</span><span class="p">)</span>

tfrPlot<span class="o">$</span>chart<span class="p">(</span>tooltipContent <span class="o">=</span> <span class="s">&quot;#! function(key, x, y){</span>
<span class="s">        return &#39;&lt;h3&gt;&#39; + key + &#39;&lt;/h3&gt;&#39; + </span>
<span class="s">        &#39;&lt;p&gt;&#39; + y + &#39; in &#39; + x + &#39;&lt;/p&gt;&#39;</span>
<span class="s">        } !#&quot;</span><span class="p">)</span>
</pre></div>


<p>Typing <code>tfrPlot</code> in the console produces the graphic below:</p>
<hr />
<p><iframe src="http://dl.dropboxusercontent.com/s/atqfmcybgl1rk5n/tfrplot.html" width="825" height="450" seamless frameBorder = "0"></iframe></p>
<hr />
<p>The chart shows an overall decline in fertility in Europe since 1960; however, beyond that, it is a mess of information.  You can get tooltips on hover that allow you to discern some things that are going on, but it is really difficult to make out any particular country.  This is where NVD3 and rCharts really shine, however.  The chart's legend is interactive; you can click the bubble next to each country's name to turn off and on its line.  Further, if you double-click a country, the chart will reveal the line for that country only.  In turn, the chart functions as an application that the user can modify as she or he wishes.  For example, I used this chart to explore differences between fertility levels in Scandinavia and Southern Europe with a few clicks, as seen in the example below:</p>
<hr />
<p><iframe src="http://dl.dropboxusercontent.com/s/ulb0fdqii1atycp/selected.html" width="825" height="450" seamless frameBorder = "0"></iframe></p>
<hr />
<p>In class, we interactively explored comparisons between countries all over Europe, discussing the varying roles of social programs, cultural differences, economic well-being, etc. in influencing the type of gaps like those observed in the chart above.  </p>
<p>Additionally, rCharts includes options for specifying the type of chart you want to show in advance.  For example, I discussed in class the specific case of Romania, which during the <a href="http://en.wikipedia.org/wiki/Nicolae_Ceausescu">Ceausescu era</a> pursued severe pro-natalist policies that influenced sharp fluctuations in the country's TFR, and had lasting negative impacts on the health of Romanian women.  The code below modifies the chart's options to show only Romania.  To do this, I created a vector of unique country codes in their sorted order in my <code>tfr</code> data frame, then created a boolean vector in which only the position representing Romania was set to false.  I can then pass this vector as a parameter in my chart's options, telling it to disable all lines except Romania.  </p>
<div class="highlight"><pre>ids <span class="o">&lt;-</span> unique<span class="p">(</span>tfr<span class="o">$</span>iso2c<span class="p">)</span>

rom <span class="o">&lt;-</span> as.logical<span class="p">(</span>ids <span class="o">!=</span> <span class="s">&#39;RO&#39;</span><span class="p">)</span>

tfrPlot<span class="o">$</span>set<span class="p">(</span>disabled <span class="o">=</span> rom<span class="p">)</span>
</pre></div>


<p>Below, you can see the result. Note the huge jump in fertility between 1966 and 1967, which was in part the result of strong restrictions on abortion and contraception in the country.  Shortly thereafter, however, fertility rates fell once again; the slight bump in the 1980s was due to additional government influence in child-bearing, which in part included government monitoring of women to ensure that they were carrying pregnancies to term. Since the fall of the Ceausescu regime, the fertility rate plummeted to what is now one of the lowest in the world.  </p>
<hr />
<p><iframe src="http://dl.dropbox.com/s/1c3e3iixo1alfgn/romaniaplot.html" width="825" height="450" seamless frameBorder = "0"></iframe></p>
<hr />
<p>For me, this example shows the power of interactive data visualization in the classroom.  Instead of a series of pre-made charts that I had chosen in advance of my lecture, my students were able to choose countries they were interested in looking at, allowing me to build a more interactive classroom experience.  </p>
<p>I should mention as well that I display these charts in class using <a href="https://github.com/ramnathv/slidify">slidify</a>, which is an R package for creating HTML5 presentations from Markdown.  Its author, Ramnath Vaidyanathan, is also the author of rCharts; as such, slidify and rCharts play very nicely together.  I'll likely discuss my experiences with slidify in a future post, as I am using it now to produce all my lecture materials.  </p>
<p><strong>To create the fertility chart on your computer, follow these steps:</strong></p>
<ol>
<li>Be sure that you have the following R packages installed: <strong>WDI</strong>, <strong>plyr</strong>, and <strong>rCharts</strong>.  rCharts is not yet on CRAN, so you'll need to install it from GitHub with the <strong>devtools</strong> package.  I use the <code>dev</code> branch of rCharts, which has the latest updates; you can install this with the command, <code>devtools::install_github('rCharts', 'ramnathv', ref='dev')</code>.  </li>
<li>Run the following command: <code>source("https://raw.github.com/walkerke/teaching-with-datavis/master/tfr-in-europe.R")</code></li>
<li>Type <code>tfrPlot</code> in the R console to create your chart!  Just a quick note: I have trouble showing NVD3 charts in the RStudio viewer, so you may need to open the chart in your web browser of choice to view it.  </li>
</ol>
<p>The code is available on GitHub; use it as you please (though I'd love to hear how you are adapting/modifying it if you do).    </p>
<p>To contact me, email me at <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#107;&#121;&#108;&#101;&#46;&#119;&#97;&#108;&#107;&#101;&#114;&#64;&#116;&#99;&#117;&#46;&#101;&#100;&#117;">&#107;&#121;&#108;&#101;&#46;&#119;&#97;&#108;&#107;&#101;&#114;&#64;&#116;&#99;&#117;&#46;&#101;&#100;&#117;</a>, or connect with me on <a href="https://twitter.com/kyle_e_walker">Twitter</a>.  </p>
<p><strong>Thanks to:</strong></p>
<ul>
<li><a href="http://data.worldbank.org/">The World Bank</a> for generously making their data publicly available;</li>
<li><a href="https://twitter.com/ramnath_vaidya">Ramnath Vaidyanathan</a> and <a href="https://twitter.com/timelyportfolio">Timely Portfolio</a> for the amazing rCharts;</li>
<li>Vincent Arel-Bundock for creating the WDI package;</li>
<li>The developers of NVD3 and d3.js for their innovations in data visualization.  </li>
</ul></div>
        <hr />
    </div>
		

 
        

 

    <div class='article'>
        <a href="http://walkerke.github.io/2014/01/hispanic-pop-by-state/"><h2>Visualizing the U.S. Hispanic population by state</h2></a>
        <div class= "well small"> Thu 09 January 2014

by <a class="url fn" href="http://walkerke.github.io/author/kyle-walker.html">Kyle Walker</a>
 


 </div>
        <div class="summary"><p>Welcome!  This is the first post of my effort to document my foray into developing interactive data visualizations for use in my teaching.  Hopefully these examples will be of use to some readers who are interested in creating their own visualizations.  </p>
<p>I'll first provide a bit of background.  I ...</p> <a class="btn btn-info xsmall" href="http://walkerke.github.io/2014/01/hispanic-pop-by-state/">read more</a></div>
    </div>	
				
<div class="pagination">
<ul>
    <li class="prev disabled"><a href="#">&larr; Previous</a></li>

    <li class="active"><a href="http://walkerke.github.io/tag/rcharts.html">1</a></li>

    <li class="next disabled"><a href="#">&rarr; Next</a></li>

</ul>
</div>
 
  
        </div>
        
        <div class="span3">

            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Site
                </li>
            
                <li><a href="http://walkerke.github.io/">Archives</a>
                <li><a href="http://walkerke.github.io/tags.html">Tags</a>
                <li><a href="http://walkerke.github.io/" rel="alternate">Atom feed</a></li>
            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Categories
                </li>
                
                <li><a href="http://walkerke.github.io/category/misc.html">misc</a></li>
                   
            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Links
                </li>
            
                <li><a href="http://kylewalkertcu.wordpress.com/">Professional website</a></li>
                <li><a href="http://his.tcu.edu/">TCU Dept. of History & Geography</a></li>
                <li><a href="http://www.tcu.edu">TCU</a></li>
                <li><a href="http://www.r-bloggers.com/">R-bloggers</a></li>
            </ul>
            </div>


            <div class="social">
            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Social
                </li>
           
                <li><a href="https://twitter.com/kyle_e_walker">Twitter</a></li>
                <li><a href="https://github.com/walkerke">Github</a></li>
                <li><a href="http://www.linkedin.com/in/walkerke">LinkedIn</a></li>
            </ul>
            </div>
            </div>

        </div>  
    </div>     </div> 
<footer>
<br />
<p><a href="http://walkerke.github.io">Teaching with Interactive Data Visualization</a> &copy; Kyle Walker 2014</p>
</footer>

</div> <!-- /container -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="http://walkerke.github.io/theme/bootstrap-collapse.js"></script>
<script>var _gaq=[['_setAccount','UA-51388803-1'],['_trackPageview']];(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.src='//www.google-analytics.com/ga.js';s.parentNode.insertBefore(g,s)}(document,'script'))</script>
 
</body>
</html>