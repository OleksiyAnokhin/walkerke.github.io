<!DOCTYPE html>
<html lang="en_us.utf-8 pelican">
<head>
    <meta charset="utf-8">
    <title>Teaching with Interactive Data Visualization</title>
    <meta name="description" content="">
    <meta name="author" content="Kyle Walker">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://walkerke.github.io/theme/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="http://walkerke.github.io/theme/bootstrap.min.css" rel="stylesheet">
    <link href="http://walkerke.github.io/theme/bootstrap.min.responsive.css" rel="stylesheet">
    <link href="http://walkerke.github.io/theme/local.css" rel="stylesheet">
    <link href="http://walkerke.github.io/theme/pygments.css" rel="stylesheet">

</head>

<body>

<div class="navbar">
    <div class="navbar-inner">
    <div class="container">

         <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
         </a>

        <a class="brand" href="http://walkerke.github.io">Teaching with Interactive Data Visualization</a>

        <div class="nav-collapse">
        <ul class="nav">
            
            <li><a href="http://walkerke.github.io/about/">About</a></li>
            <li><a href="http://walkerke.github.io/rpydocs/">RPubs/IPython Notebooks</a></li>
        </ul>
        </div>
        
    </div>
    </div>
</div>

<div class="container">
    <div class="content">
    <div class="row">

        <div class="span9">
        

        


    <div class='article'>
        <div class="content-title">
            <a href="http://walkerke.github.io/2014/08/un-projections/"><h1>Exploring the United Nations population projections with rCharts</h1></a>
Tue 05 August 2014

by <a class="url fn" href="http://walkerke.github.io/author/kyle-walker.html">Kyle Walker</a>
 


 
        </div>
        
        <div><p>I recently came across <a href="http://dataremixed.com/2014/07/story-types-a-thought-starter/">this really interesting post</a> from <a href="https://twitter.com/DataRemixed">Ben Jones</a> that explores the history and future of world population change with Tableau.  I haven't used Tableau much, but I was impressed with the different ways in which Ben used the software to visualize various aspects of global population change.  More broadly, I can see multiple ways in which a visualization like this would be useful in teaching a course like World Regional Geography.  An instructor could ask students to answer a series of questions regarding global population change, using the visualizations as their evidence.  Students would then report back to the class about what they've learned from the visualizations, presenting different views to support their answers to the questions.  </p>
<p>Reading this post motivated me to share a couple more basic visualizations that I've used in my teaching to support discussions of global population change.  These are some of the first charts I created with <a href="http://rcharts.io/">rCharts</a> when I first started working with the package late last year.  However, I've updated the code below to use the new Hadley Wickham package <a href="https://github.com/hadley/dplyr">dplyr</a>, which makes data munging in R so much easier.  Eventually, I would like to create a <a href="http://shiny.rstudio.com/">Shiny</a> application that is similar to what Ben created with Tableau, but instead using R and rCharts.  </p>
<p>In the examples below, I use population projection data from <a href="http://esa.un.org/wpp/">the United Nations' World Population Prospects, 2012 Revision</a>.  I create the visualizations with <a href="http://nvd3.org/">NVD3</a>.  The first example is a stacked area chart that shows the changing regional distribution of the world's population between 1950 and 2100.  </p>
<div class="highlight"><pre>library<span class="p">(</span>dplyr<span class="p">)</span>
library<span class="p">(</span>rCharts<span class="p">)</span>
library<span class="p">(</span>RColorBrewer<span class="p">)</span>

dat <span class="o">&lt;-</span> read.csv<span class="p">(</span><span class="s">&quot;http://esa.un.org/wpp/ASCII-Data/ASCII_FILES/WPP2012_DB02_POPULATIONS_ANNUAL.csv&quot;</span><span class="p">)</span>

<span class="c1">## Alternatively, download the file from the above link and save it in your working directory</span>

<span class="c1"># library(data.table)</span>
<span class="c1"># dat &lt;- fread(&quot;WPP2012_DB02_POPULATIONS_ANNUAL.csv&quot;)</span>

regions <span class="o">&lt;-</span> c<span class="p">(</span><span class="s">&quot;Africa&quot;</span><span class="p">,</span> <span class="s">&quot;Latin America and the Caribbean&quot;</span><span class="p">,</span> <span class="s">&quot;Northern America&quot;</span><span class="p">,</span> <span class="s">&quot;Europe&quot;</span><span class="p">,</span> <span class="s">&quot;Oceania&quot;</span><span class="p">,</span> <span class="s">&quot;Asia&quot;</span><span class="p">)</span>

region_dat <span class="o">&lt;-</span> dat <span class="o">%&gt;%</span>
  filter<span class="p">(</span>VarID <span class="o">==</span> <span class="m">2</span><span class="p">,</span> 
         Location <span class="o">%in%</span> regions<span class="p">)</span> <span class="o">%&gt;%</span>
  mutate<span class="p">(</span>billions <span class="o">=</span> PopTotal <span class="o">/</span> <span class="m">1000000</span><span class="p">)</span> <span class="o">%&gt;%</span>
  select<span class="p">(</span>Location<span class="p">,</span> Time<span class="p">,</span> billions<span class="p">)</span>

<span class="c1"># Stacked area chart by region</span>

c1 <span class="o">&lt;-</span> nPlot<span class="p">(</span>billions <span class="o">~</span> Time<span class="p">,</span> 
            group <span class="o">=</span> <span class="s">&quot;Location&quot;</span><span class="p">,</span> 
            data <span class="o">=</span> region_dat<span class="p">,</span> 
            type <span class="o">=</span> <span class="s">&quot;stackedAreaChart&quot;</span><span class="p">)</span>

c1<span class="o">$</span>chart<span class="p">(</span>color <span class="o">=</span> brewer.pal<span class="p">(</span><span class="m">6</span><span class="p">,</span> <span class="s">&quot;Set2&quot;</span><span class="p">))</span>
c1<span class="o">$</span>yAxis<span class="p">(</span>tickFormat<span class="o">=</span> <span class="s">&quot;#!d3.format(&#39;,.1f&#39;)!#&quot;</span><span class="p">)</span>
c1<span class="o">$</span>yAxis<span class="p">(</span>axisLabel <span class="o">=</span> <span class="s">&quot;Population (billions)&quot;</span><span class="p">,</span> width <span class="o">=</span> <span class="m">62</span><span class="p">)</span>
c1<span class="o">$</span>xAxis<span class="p">(</span>axisLabel <span class="o">=</span> <span class="s">&quot;Year&quot;</span><span class="p">)</span>

c1<span class="o">$</span>chart<span class="p">(</span>tooltipContent <span class="o">=</span> <span class="s">&quot;#! function(key, x, y){</span>
<span class="s">        return &#39;&lt;h3&gt;&#39; + key + &#39;&lt;/h3&gt;&#39; + </span>
<span class="s">        &#39;&lt;p&gt;&#39; + y + &#39; billion in &#39; + x + &#39;&lt;/p&gt;&#39;</span>
<span class="s">        } !#&quot;</span><span class="p">)</span>
</pre></div>


<p>The above code reads the data file directly into R from the UN's website; however this can be slow (about a couple minutes) so if you'd prefer, I'd advise downloading the CSV to your working directory and using <code>fread</code> from the <strong>data.table</strong> package to read it in (<a href="http://r.789695.n4.nabble.com/Odd-problem-using-fread-to-read-in-a-csv-file-no-data-just-headers-td4686302.html">there is an issue with using <code>fread</code> to read CSVs from websites on Windows</a>).  I then subset the data into a new data frame, <code>region_dat</code>, using <strong>dplyr</strong>.  If you are unfamiliar with dplyr, I highly recommend that you check it out; <a href="http://rpubs.com/walkerke/ipums_dplyr">I have written about other use cases for dplyr here</a>.  </p>
<p>The remaining code creates the NVD3 chart with rCharts. Notice that when working with rCharts, you sometimes have to pass in JavaScript directly to modify the chart options, which is enclosed in <code>"#!...!#"</code>.  I do this when formatting the y-axis values as well as the content of the tooltip.  Notice that <code>key</code> refers to the group value, <code>y</code> is the y-axis value, and <code>x</code> is the x-axis value in the JavaScript function.  You can also pass in other values to the tooltip with NVD3; <a href="https://gist.github.com/walkerke/11002398">I show how in this GitHub gist</a>.  </p>
<p>Typing <code>c1</code> in the console then produces the chart below: </p>
<iframe src="http://walkerke.github.io/teaching-with-datavis/un-projections/regions.html" width="850" height="400" seamless scrolling="no" frameBorder = "0"></iframe>

<p>I used this chart during the first week of my World Regional Geography class to discuss population change in global context.  The region that stands out, of course, is Africa, which is projected to almost-quadruple in population by the end of century.  If these projections pan out, Africa would have over 4 billion residents by 2100, and account for around 40 percent of the world's population.  The interactivity in the chart then allows for more detailed exploration of the data.  By clicking on the Europe data series, for example, the user can hide all of the other regions, and show how the continent's population is projected to peak in the next several years and then begin to decline.  These figures provided important context to many of the thematic topics specific to these regions I covered later in the class.  Additionally, the chart can be modified with a single click to a "Stream" or "Expanded" 100% view (try it!), for different views of the data. </p>
<p>I also created another visualization to show UN projections for the world's population based on different projection scenarios.  The code and resultant chart are below.  </p>
<div class="highlight"><pre>variants <span class="o">&lt;-</span> c<span class="p">(</span><span class="s">&quot;Low&quot;</span><span class="p">,</span> <span class="s">&quot;Medium&quot;</span><span class="p">,</span> <span class="s">&quot;High&quot;</span><span class="p">,</span> <span class="s">&quot;Constant fertility&quot;</span><span class="p">)</span>

global_dat <span class="o">&lt;-</span> dat <span class="o">%&gt;%</span>
  filter<span class="p">(</span>Location <span class="o">==</span> <span class="s">&quot;World&quot;</span><span class="p">,</span> 
         Variant <span class="o">%in%</span> variants<span class="p">,</span>
         Time <span class="o">&gt;=</span> <span class="m">2012</span><span class="p">)</span> <span class="o">%&gt;%</span>
  mutate<span class="p">(</span>varfactor <span class="o">=</span> factor<span class="p">(</span>Variant<span class="p">,</span>
                            levels <span class="o">=</span> c<span class="p">(</span><span class="s">&quot;Constant fertility&quot;</span><span class="p">,</span>
                                       <span class="s">&quot;High&quot;</span><span class="p">,</span>
                                       <span class="s">&quot;Medium&quot;</span><span class="p">,</span>
                                       <span class="s">&quot;Low&quot;</span><span class="p">)),</span> 
         billions <span class="o">=</span> PopTotal <span class="o">/</span> <span class="m">1000000</span><span class="p">)</span> <span class="o">%&gt;%</span>
  select<span class="p">(</span>varfactor<span class="p">,</span> Time<span class="p">,</span> billions<span class="p">)</span> <span class="o">%&gt;%</span>
  arrange<span class="p">(</span>varfactor<span class="p">)</span>

c2 <span class="o">&lt;-</span> nPlot<span class="p">(</span>billions <span class="o">~</span> Time<span class="p">,</span> 
            group <span class="o">=</span> <span class="s">&quot;varfactor&quot;</span><span class="p">,</span> 
            data <span class="o">=</span> global_dat<span class="p">,</span> 
            type<span class="o">=</span><span class="s">&quot;lineChart&quot;</span><span class="p">)</span>

c2<span class="o">$</span>chart<span class="p">(</span>color <span class="o">=</span> brewer.pal<span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="s">&quot;Set2&quot;</span><span class="p">))</span>
c2<span class="o">$</span>yAxis<span class="p">(</span>tickFormat<span class="o">=</span> <span class="s">&quot;#!d3.format(&#39;,.1f&#39;)!#&quot;</span><span class="p">)</span>
c2<span class="o">$</span>yAxis<span class="p">(</span>axisLabel <span class="o">=</span> <span class="s">&quot;Population (billions)&quot;</span><span class="p">,</span> width <span class="o">=</span> <span class="m">62</span><span class="p">)</span>
c2<span class="o">$</span>xAxis<span class="p">(</span>axisLabel <span class="o">=</span> <span class="s">&quot;Year&quot;</span><span class="p">)</span>


c2<span class="o">$</span>chart<span class="p">(</span>tooltipContent <span class="o">=</span> <span class="s">&quot;#! function(key, x, y){</span>
<span class="s">        return &#39;&lt;h3&gt;&#39; + &#39;Variant: &#39; + key + &#39;&lt;/h3&gt;&#39; + </span>
<span class="s">        &#39;&lt;p&gt;&#39; + y + &#39; billion in &#39; + x + &#39;&lt;/p&gt;&#39;</span>
<span class="s">        } !#&quot;</span><span class="p">)</span>
c2
</pre></div>


<iframe src="http://walkerke.github.io/teaching-with-datavis/un-projections/global.html" width="850" height="400" seamless scrolling="no" frameBorder = "0"></iframe>

<p>The chart shows wide disparities between the UN's projection scenarios.  If global fertility were to remain at 2012 levels, the world's population would be expected to reach nearly 28 billion by the end of the century!  However, any reasonable projection scenarios take into account global declines in fertility.  While the annual rate of world population growth has been declining for several decades, <a href="http://en.wikipedia.org/wiki/Demographic_momentum">demographic momentum</a> is projected to carry the world's population to close to 11 billion by 2100, according to the most commonly-cited Medium projection variant.  However, it is notable that if global fertility were to decline more than expected, the world's population could peak in size and then decline over the next century.  This is shown by the Low variant, which is calculated with a fertility rate half a child lower than the medium variant.  If you are interested in learning more about the UN's projections and methodology, <a href="http://esa.un.org/wpp/Documentation/pdf/WPP2012_HIGHLIGHTS.pdf">read their report here</a>. </p>
<p>The UN population projection dataset contains a lot more information than just this, however.  Projections are included for every country, and other files are available with additional demographic information <a href="http://esa.un.org/wpp/ASCII-Data/DISK_NAVIGATION_ASCII.htm">at the UN's website</a>.  As such, there are many other ways to visualize these data; I envision a Shiny application in which the user could interactively select countries and compare projection scenarios. </p>
<p>You are welcome to use these visualizations if you'd like, or feel free to <a href="https://github.com/walkerke/teaching-with-datavis/blob/master/un-projections/un-projections.R">get the code from GitHub</a> and build on this.  If you do, I'd love to hear about what you've created!</p>
<p><strong>Thanks to:</strong></p>
<ul>
<li>The UN Population Division for making all their data freely and publicly available;</li>
<li>The developers of rCharts and dplyr</li>
</ul></div>
        <hr />
    </div>
		

 
        

 

    <div class='article'>
        <a href="http://walkerke.github.io/2014/06/rcharts-pyramids/"><h2>Interactive international population pyramids with R, rCharts</h2></a>
        <div class= "well small"> Sat 07 June 2014

by <a class="url fn" href="http://walkerke.github.io/author/kyle-walker.html">Kyle Walker</a>
 


 </div>
        <div class="summary"><p>I find population pyramids to be very effective teaching tools.  In short, a population pyramid is a type of chart that shows the population size of different age cohorts on the x-axis, with gender usually displayed back-to-back to create the shape of a "pyramid."  It is used to illustrate a ...</p> <a class="btn btn-info xsmall" href="http://walkerke.github.io/2014/06/rcharts-pyramids/">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="http://walkerke.github.io/2014/03/tfr-in-europe/"><h2>Visualizing fertility trends in Europe</h2></a>
        <div class= "well small"> Thu 06 March 2014

by <a class="url fn" href="http://walkerke.github.io/author/kyle-walker.html">Kyle Walker</a>
 


 </div>
        <div class="summary"><p>In the classroom, interactive data visualizations can embed a wealth of information that can be interactively queried by the instructor depending on the course topics and students' questions.  The example I'll discuss below worked for me exactly in this way.  I'll show how to create an interactive chart ...</p> <a class="btn btn-info xsmall" href="http://walkerke.github.io/2014/03/tfr-in-europe/">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="http://walkerke.github.io/2014/01/hispanic-pop-by-state/"><h2>Visualizing the U.S. Hispanic population by state</h2></a>
        <div class= "well small"> Thu 09 January 2014

by <a class="url fn" href="http://walkerke.github.io/author/kyle-walker.html">Kyle Walker</a>
 


 </div>
        <div class="summary"><p>Welcome!  This is the first post of my effort to document my foray into developing interactive data visualizations for use in my teaching.  Hopefully these examples will be of use to some readers who are interested in creating their own visualizations.  </p>
<p>I'll first provide a bit of background.  I ...</p> <a class="btn btn-info xsmall" href="http://walkerke.github.io/2014/01/hispanic-pop-by-state/">read more</a></div>
    </div>	
				
<div class="pagination">
<ul>
    <li class="prev disabled"><a href="#">&larr; Previous</a></li>

    <li class="active"><a href="http://walkerke.github.io/tag/rcharts.html">1</a></li>

    <li class="next disabled"><a href="#">&rarr; Next</a></li>

</ul>
</div>
 
  
        </div>
        
        <div class="span3">

            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Site
                </li>
            
                <li><a href="http://walkerke.github.io/">Archives</a>
                <li><a href="http://walkerke.github.io/tags.html">Tags</a>
                <li><a href="http://walkerke.github.io/" rel="alternate">Atom feed</a></li>
            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Categories
                </li>
                
                <li><a href="http://walkerke.github.io/category/misc.html">misc</a></li>
                   
            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Links
                </li>
            
                <li><a href="http://kylewalkertcu.wordpress.com/">Professional website</a></li>
                <li><a href="http://his.tcu.edu/">TCU Dept. of History & Geography</a></li>
                <li><a href="http://www.tcu.edu">TCU</a></li>
                <li><a href="http://www.r-bloggers.com/">R-bloggers</a></li>
            </ul>
            </div>


            <div class="social">
            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Social
                </li>
           
                <li><a href="https://twitter.com/kyle_e_walker">Twitter</a></li>
                <li><a href="https://github.com/walkerke">Github</a></li>
                <li><a href="http://www.linkedin.com/in/walkerke">LinkedIn</a></li>
            </ul>
            </div>
            </div>

        </div>  
    </div>     </div> 
<footer>
<br />
<p><a href="http://walkerke.github.io">Teaching with Interactive Data Visualization</a> &copy; Kyle Walker 2014</p>
</footer>

</div> <!-- /container -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="http://walkerke.github.io/theme/bootstrap-collapse.js"></script>
<script>var _gaq=[['_setAccount','UA-51388803-1'],['_trackPageview']];(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.src='//www.google-analytics.com/ga.js';s.parentNode.insertBefore(g,s)}(document,'script'))</script>
 
</body>
</html>