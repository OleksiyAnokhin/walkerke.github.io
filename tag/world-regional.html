<!DOCTYPE html>
<html lang="en_us.utf-8 pelican">
<head>
    <meta charset="utf-8">
    <title>Teaching with Interactive Data Visualization</title>
    <meta name="description" content="">
    <meta name="author" content="Kyle Walker">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://walkerke.github.io/theme/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="http://walkerke.github.io/theme/bootstrap.min.css" rel="stylesheet">
    <link href="http://walkerke.github.io/theme/bootstrap.min.responsive.css" rel="stylesheet">
    <link href="http://walkerke.github.io/theme/local.css" rel="stylesheet">
    <link href="http://walkerke.github.io/theme/pygments.css" rel="stylesheet">

</head>

<body>

<div class="navbar">
    <div class="navbar-inner">
    <div class="container">

         <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
         </a>

        <a class="brand" href="http://walkerke.github.io">Teaching with Interactive Data Visualization</a>

        <div class="nav-collapse">
        <ul class="nav">
            
            <li><a href="http://walkerke.github.io/about/">About</a></li>
            <li><a href="http://walkerke.github.io/rpydocs/">RPubs/IPython Notebooks</a></li>
        </ul>
        </div>
        
    </div>
    </div>
</div>

<div class="container">
    <div class="content">
    <div class="row">

        <div class="span9">
        

        


    <div class='article'>
        <div class="content-title">
            <a href="http://walkerke.github.io/2016/01/idbr/"><h1>Visualizing international demographic indicators with idbr and Plotly</h1></a>
Fri 29 January 2016

by <a class="url fn" href="http://walkerke.github.io/author/kyle-walker.html">Kyle Walker</a>
 


 
        </div>
        
        <div><p>It's been a while since I last posted here - but I've been working on a new R package that I'm quite excited about, and I thought this would be the right place to post.  My new package, <strong>idbr</strong>, is an R interface to the <a href="http://www.census.gov/data/developers/data-sets/international-database.html">United States Census Bureau's International Data Base API</a>.  The IDB includes a host of international demographic indicators - including historical data and projections to 2050.  I use IDB data all of the time for my teaching - and <strong>idbr</strong> makes the process of getting the data much easier!  While this product uses the Census Bureau Data API, it is not endorsed or certified by the Census Bureau.  </p>
<p>I plan to submit to CRAN soon once I've finished writing all of the documentation.  For now, install from GitHub with the following command: </p>
<div class="highlight"><pre>devtools<span class="o">::</span>install_github<span class="p">(</span><span class="s">&#39;walkerke/idbr&#39;</span><span class="p">)</span>
</pre></div>


<p>To get started, you'll need a Census API key; this can be obtained from <a href="http://api.census.gov/data/key_signup.html">http://api.census.gov/data/key_signup.html</a> if you don't already have one.  Before downloading data, set your API key for your <strong>idbr</strong> session with the <code>set_api_key</code> function: </p>
<div class="highlight"><pre><span class="kn">library</span><span class="p">(</span>idbr<span class="p">)</span>

idb_api_key<span class="p">(</span><span class="s">&#39;Your API key goes here&#39;</span><span class="p">)</span>
</pre></div>


<p>There are two main functions in the <strong>idbr</strong> package.  <code>idb1</code> fetches population data by one-year age bands for one or more countries in one or more years, optionally by age ranges or by sex.  <code>idb5</code> has a lot more indicators available, including total fertility rate, life expectancy, and population by five-year age ranges.  To view all of the variables available in the <code>idb</code> function, call <code>idb_variables()</code>.  Groups of similar variables, termed <strong>concepts</strong>, can be fetched at once; see the available concepts with <code>idb_concepts()</code>.  </p>
<p>Below are some examples of how to use the package with Plotly's fantastic new R client.  Browse the code for <strong>idbr</strong> at <a href="https://github.com/walkerke/idbr">https://github.com/walkerke/idbr</a>, and please let me know if you have any feedback!</p>
<p><strong>World map of infant mortality rates by country for 2016:</strong></p>
<div class="highlight"><pre><span class="kn">library</span><span class="p">(</span>plotly<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>viridis<span class="p">)</span>

df <span class="o">&lt;-</span> idb5<span class="p">(</span>country <span class="o">=</span> <span class="s">&#39;all&#39;</span><span class="p">,</span> year <span class="o">=</span> <span class="m">2016</span><span class="p">,</span> variable <span class="o">=</span> <span class="s">&#39;IMR&#39;</span><span class="p">,</span> country_name <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>

plot_ly<span class="p">(</span>df<span class="p">,</span> z <span class="o">=</span> IMR<span class="p">,</span> text <span class="o">=</span> NAME<span class="p">,</span> locations <span class="o">=</span> NAME<span class="p">,</span> locationmode <span class="o">=</span> <span class="s">&#39;country names&#39;</span><span class="p">,</span>
        type <span class="o">=</span> <span class="s">&#39;choropleth&#39;</span><span class="p">,</span> colors <span class="o">=</span> viridis<span class="p">(</span><span class="m">99</span><span class="p">),</span> hoverinfo <span class="o">=</span> <span class="s">&#39;text+z&#39;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  layout<span class="p">(</span>title <span class="o">=</span> <span class="s">&#39;Infant mortality rate, 2016&#39;</span><span class="p">,</span> 
         geo <span class="o">=</span> <span class="kt">list</span><span class="p">(</span>projection <span class="o">=</span> <span class="kt">list</span><span class="p">(</span>type <span class="o">=</span> <span class="s">&#39;robinson&#39;</span><span class="p">)))</span>
</pre></div>


<iframe src="http://personal.tcu.edu/kylewalker/r/imr.html" frameborder = "0" scrolling = "no" width = "800" height = "500"></iframe>

<p><strong>Projected population pyramid of China in 2050:</strong></p>
<div class="highlight"><pre><span class="kn">library</span><span class="p">(</span>dplyr<span class="p">)</span>

male <span class="o">&lt;-</span> idb1<span class="p">(</span><span class="s">&#39;CH&#39;</span><span class="p">,</span> <span class="m">2050</span><span class="p">,</span> sex <span class="o">=</span> <span class="s">&#39;male&#39;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  mutate<span class="p">(</span>POP <span class="o">=</span> POP <span class="o">*</span> <span class="m">-1</span><span class="p">,</span>
         SEX <span class="o">=</span> <span class="s">&#39;Male&#39;</span><span class="p">)</span>

female <span class="o">&lt;-</span> idb1<span class="p">(</span><span class="s">&#39;CH&#39;</span><span class="p">,</span> <span class="m">2050</span><span class="p">,</span> sex <span class="o">=</span> <span class="s">&#39;female&#39;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  mutate<span class="p">(</span>SEX <span class="o">=</span> <span class="s">&#39;Female&#39;</span><span class="p">)</span>

china <span class="o">&lt;-</span> <span class="kp">rbind</span><span class="p">(</span>male<span class="p">,</span> female<span class="p">)</span> <span class="o">%&gt;%</span>
  mutate<span class="p">(</span>abs_pop <span class="o">=</span> <span class="kp">abs</span><span class="p">(</span>POP<span class="p">))</span>

plot_ly<span class="p">(</span>china<span class="p">,</span> x <span class="o">=</span> POP<span class="p">,</span> y <span class="o">=</span> AGE<span class="p">,</span> color <span class="o">=</span> SEX<span class="p">,</span> type <span class="o">=</span> <span class="s">&#39;bar&#39;</span><span class="p">,</span> orientation <span class="o">=</span> <span class="s">&#39;h&#39;</span><span class="p">,</span>
        hoverinfo <span class="o">=</span> <span class="s">&#39;y+text+name&#39;</span><span class="p">,</span> text <span class="o">=</span> abs_pop<span class="p">,</span> colors <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#39;red&#39;</span><span class="p">,</span> <span class="s">&#39;gold&#39;</span><span class="p">))</span> <span class="o">%&gt;%</span>
  layout<span class="p">(</span>bargap <span class="o">=</span> <span class="m">0.1</span><span class="p">,</span> barmode <span class="o">=</span> <span class="s">&#39;overlay&#39;</span><span class="p">,</span>
         xaxis <span class="o">=</span> <span class="kt">list</span><span class="p">(</span>tickmode <span class="o">=</span> <span class="s">&#39;array&#39;</span><span class="p">,</span> tickvals <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">-10000000</span><span class="p">,</span> <span class="m">-5000000</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">5000000</span><span class="p">,</span> <span class="m">10000000</span><span class="p">),</span>
         ticktext <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#39;10M&#39;</span><span class="p">,</span> <span class="s">&#39;5M&#39;</span><span class="p">,</span> <span class="s">&#39;0&#39;</span><span class="p">,</span> <span class="s">&#39;5M&#39;</span><span class="p">,</span> <span class="s">&#39;10M&#39;</span><span class="p">)),</span> 
         title <span class="o">=</span> <span class="s">&#39;Projected population structure of China, 2050&#39;</span><span class="p">)</span>
</pre></div>


<iframe src="http://personal.tcu.edu/kylewalker/r/china.html" frameborder = "0" scrolling = "no" width = "800" height = "500"></iframe>

<p><strong>Life expectancy at birth by sex compared in a Shiny app</strong></p>
<p>First, get the data from <strong>idbr</strong> then save out (so you don't have to call the API each time): </p>
<div class="highlight"><pre><span class="c1"># setup.R</span>

<span class="kn">library</span><span class="p">(</span>idbr<span class="p">)</span>

idb_api_key<span class="p">(</span><span class="s">&quot;Your API key here&quot;</span><span class="p">)</span>

full <span class="o">&lt;-</span> idb5<span class="p">(</span>country <span class="o">=</span> <span class="s">&#39;all&#39;</span><span class="p">,</span> year <span class="o">=</span> <span class="s">&#39;2016&#39;</span><span class="p">,</span> variables <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#39;E0_F&#39;</span><span class="p">,</span> <span class="s">&#39;E0_M&#39;</span><span class="p">),</span> country_name <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>

<span class="kp">save</span><span class="p">(</span>full<span class="p">,</span> file <span class="o">=</span> <span class="s">&#39;idbr_data.rds&#39;</span><span class="p">)</span>
</pre></div>


<p>Next, build the app: </p>
<div class="highlight"><pre><span class="c1"># app.R</span>

<span class="kn">library</span><span class="p">(</span>shiny<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>countrycode<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>plotly<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>dplyr<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>tidyr<span class="p">)</span>

<span class="kp">load</span><span class="p">(</span><span class="s">&#39;idbr_data.rds&#39;</span><span class="p">)</span>

ui <span class="o">&lt;-</span> fluidPage<span class="p">(</span>

  titlePanel<span class="p">(</span><span class="s">&quot;Life expectancy at birth by country and sex&quot;</span><span class="p">),</span>

  sidebarLayout<span class="p">(</span>
    sidebarPanel<span class="p">(</span>
      selectInput<span class="p">(</span><span class="s">&quot;region&quot;</span><span class="p">,</span>
                  <span class="s">&quot;Select region to plot:&quot;</span><span class="p">,</span>
                  choices <span class="o">=</span> <span class="kp">sort</span><span class="p">(</span><span class="kp">unique</span><span class="p">(</span>countrycode_data<span class="o">$</span>region<span class="p">)),</span>
                  selected <span class="o">=</span> <span class="s">&#39;Northern Africa&#39;</span><span class="p">)</span>
    <span class="p">),</span>

    mainPanel<span class="p">(</span>
      plotlyOutput<span class="p">(</span><span class="s">&quot;dumbbell&quot;</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="p">)</span>
<span class="p">)</span>

server <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>input<span class="p">,</span> output<span class="p">)</span> <span class="p">{</span>

  regiondf <span class="o">&lt;-</span> reactive<span class="p">({</span>

    reg <span class="o">&lt;-</span> countrycode_data<span class="p">[</span>countrycode_data<span class="o">$</span>region <span class="o">==</span> input<span class="o">$</span>region<span class="p">,</span> <span class="p">]</span>

    fips <span class="o">&lt;-</span> reg<span class="o">$</span>fips104

    sub <span class="o">&lt;-</span> full <span class="o">%&gt;%</span>
      filter<span class="p">(</span>FIPS <span class="o">%in%</span> fips<span class="p">)</span> <span class="o">%&gt;%</span>
      rename<span class="p">(</span>Male <span class="o">=</span> E0_M<span class="p">,</span> Female <span class="o">=</span> E0_F<span class="p">)</span> <span class="o">%&gt;%</span>
      arrange<span class="p">(</span>Female<span class="p">)</span>

    <span class="kp">sub</span>

  <span class="p">})</span>

  output<span class="o">$</span>dumbbell <span class="o">&lt;-</span> renderPlotly<span class="p">({</span>

    regiondf<span class="p">()</span> <span class="o">%&gt;%</span>
      gather<span class="p">(</span>Sex<span class="p">,</span> value<span class="p">,</span> Male<span class="p">,</span> Female<span class="p">)</span> <span class="o">%&gt;%</span>
      plot_ly<span class="p">(</span>x <span class="o">=</span> value<span class="p">,</span> y <span class="o">=</span> NAME<span class="p">,</span> mode <span class="o">=</span> <span class="s">&#39;lines&#39;</span><span class="p">,</span>
              group <span class="o">=</span> NAME<span class="p">,</span> showlegend <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span> line <span class="o">=</span> <span class="kt">list</span><span class="p">(</span>color <span class="o">=</span> <span class="s">&#39;gray&#39;</span><span class="p">),</span>
              hovermode <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span> hoverinfo <span class="o">=</span> <span class="s">&#39;none&#39;</span><span class="p">)</span> <span class="o">%&gt;%</span>
      add_trace<span class="p">(</span>x <span class="o">=</span> value<span class="p">,</span> y <span class="o">=</span> NAME<span class="p">,</span> color <span class="o">=</span> Sex<span class="p">,</span> mode <span class="o">=</span> <span class="s">&#39;markers&#39;</span><span class="p">,</span>
              colors <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#39;darkred&#39;</span><span class="p">,</span> <span class="s">&#39;navy&#39;</span><span class="p">),</span> marker <span class="o">=</span> <span class="kt">list</span><span class="p">(</span>size <span class="o">=</span> <span class="m">10</span><span class="p">))</span> <span class="o">%&gt;%</span>
      layout<span class="p">(</span>xaxis <span class="o">=</span> <span class="kt">list</span><span class="p">(</span>title <span class="o">=</span> <span class="s">&#39;Life expectancy at birth&#39;</span><span class="p">),</span>
             yaxis <span class="o">=</span> <span class="kt">list</span><span class="p">(</span>title <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">),</span>
             margin <span class="o">=</span> <span class="kt">list</span><span class="p">(</span>l <span class="o">=</span> <span class="m">120</span><span class="p">))</span>

  <span class="p">})</span>

<span class="p">}</span>

shinyApp<span class="p">(</span>ui <span class="o">=</span> ui<span class="p">,</span> server <span class="o">=</span> server<span class="p">)</span>
</pre></div>


<iframe src="https://walkerke.shinyapps.io/idbr_dumbbell/" frameborder = "0" scrolling = "no" width = "800" height = "500"></iframe></div>
        <hr />
    </div>
		

 
        

 

    <div class='article'>
        <a href="http://walkerke.github.io/2015/04/map-or-chart/"><h2>Should you visualize data with a map or a chart?  Thoughts from teaching introductory geography</h2></a>
        <div class= "well small"> Wed 29 April 2015

by <a class="url fn" href="http://walkerke.github.io/author/kyle-walker.html">Kyle Walker</a>
 


 </div>
        <div class="summary"><p>While studying geography for many years as an undergraduate and graduate student, my main connection to the world of data visualization was through the worlds of cartography and Geographic Information Systems (GIS).  I learned about basic principles of data visualization in my geography courses, but it was always through the ...</p> <a class="btn btn-info xsmall" href="http://walkerke.github.io/2015/04/map-or-chart/">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="http://walkerke.github.io/2015/02/religion/"><h2>Mapping religious adherence in the US with CartoDB</h2></a>
        <div class= "well small"> Thu 26 February 2015

by <a class="url fn" href="http://walkerke.github.io/author/kyle-walker.html">Kyle Walker</a>
 


 </div>
        <div class="summary"><p><strong>Update 2/26: changes made after conversations with Steven Romalewski on Twitter.  For the previous version of the post, check my GitHub version history.</strong></p>
<p>Before coming to TCU, I worked as a data analyst for the <a href="https://www.cpg.org/">Church Pension Group</a>, which manages the retirement funds and provides other financial services for ...</p> <a class="btn btn-info xsmall" href="http://walkerke.github.io/2015/02/religion/">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="http://walkerke.github.io/2014/12/dygraphs/"><h2>Charting time series data with dygraphs in R and Python</h2></a>
        <div class= "well small"> Sat 20 December 2014

by <a class="url fn" href="http://walkerke.github.io/author/kyle-walker.html">Kyle Walker</a>
 


 </div>
        <div class="summary"><p>This past week, the good people at <a href="http://www.rstudio.com">RStudio</a> advertised over Twitter the release of <a href="http://www.htmlwidgets.org/index.html">htmlwidgets for R</a>, a project in collaboration with <a href="http://rcharts.io">rCharts</a> wizards <a href="https://twitter.com/ramnath_vaidya">Ramnath Vaidyanathan</a> and <a href="https://twitter.com/timelyportfolio">Kenton Russell</a>. The packages showcased are incredible; I was particularly intrigued by the <a href="http://rstudio.github.io/dygraphs/">dygraphs</a> package, which creates interactive time-series charts.  </p>
<p>Aside from maps ...</p> <a class="btn btn-info xsmall" href="http://walkerke.github.io/2014/12/dygraphs/">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="http://walkerke.github.io/2014/12/slidify/"><h2>Using Slidify to teach with interactive content</h2></a>
        <div class= "well small"> Tue 02 December 2014

by <a class="url fn" href="http://walkerke.github.io/author/kyle-walker.html">Kyle Walker</a>
 


 </div>
        <div class="summary"><p>I frequently come across criticisms of PowerPoint as a presentation tool, which is interesting to me given the ubiquity of its use across industries.  When I worked as a data analyst prior to coming to TCU, I frequently prepared PowerPoints using a company template for my boss's presentations or ...</p> <a class="btn btn-info xsmall" href="http://walkerke.github.io/2014/12/slidify/">read more</a></div>
    </div>	
				
<div class="pagination">
<ul>
    <li class="prev disabled"><a href="#">&larr; Previous</a></li>

    <li class="active"><a href="http://walkerke.github.io/tag/world-regional.html">1</a></li>
    <li class=""><a href="http://walkerke.github.io/tag/world-regional2.html">2</a></li>
    <li class=""><a href="http://walkerke.github.io/tag/world-regional3.html">3</a></li>

    <li class="next"><a href="http://walkerke.github.io/tag/world-regional2.html">Next &rarr;</a></li>

</ul>
</div>
 
  
        </div>
        
        <div class="span3">

            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Site
                </li>
            
                <li><a href="http://walkerke.github.io/archives.html">Archives</a>
                <li><a href="http://walkerke.github.io/tags.html">Tags</a>
                <li><a href="http://walkerke.github.io/feeds/all.atom.xml" rel="alternate">Atom feed</a></li>
            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Categories
                </li>
                
                <li><a href="http://walkerke.github.io/category/charts.html">Charts</a></li>
                <li><a href="http://walkerke.github.io/category/maps.html">Maps</a></li>
                <li><a href="http://walkerke.github.io/category/presentations.html">Presentations</a></li>
                   
            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Links
                </li>
            
                <li><a href="http://personal.tcu.edu/kylewalker">Professional website</a></li>
                <li><a href="http://his.tcu.edu/">Department website</a></li>
                <li><a href="http://www.tcu.edu">TCU</a></li>
            </ul>
            </div>


            <div class="social">
            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Social
                </li>
           
                <li><a href="https://twitter.com/kyle_e_walker">Twitter</a></li>
                <li><a href="https://github.com/walkerke">Github</a></li>
                <li><a href="http://www.linkedin.com/in/walkerke">LinkedIn</a></li>
            </ul>
            </div>
            </div>

        </div>  
    </div>     </div> 
<footer>
<br />
<p><a href="http://walkerke.github.io">Teaching with Interactive Data Visualization</a> &copy; Kyle Walker 2016</p>
</footer>

</div> <!-- /container -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="http://walkerke.github.io/theme/bootstrap-collapse.js"></script>
<script>var _gaq=[['_setAccount','UA-51388803-1'],['_trackPageview']];(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.src='//www.google-analytics.com/ga.js';s.parentNode.insertBefore(g,s)}(document,'script'))</script>
 
</body>
</html>