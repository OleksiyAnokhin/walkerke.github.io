<!DOCTYPE html>
<html lang="en_us.utf-8 pelican">
<head>
    <meta charset="utf-8">
    <title>Teaching with Interactive Data Visualization</title>
    <meta name="description" content="">
    <meta name="author" content="Kyle Walker">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://walkerke.github.io/theme/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="http://walkerke.github.io/theme/bootstrap.min.css" rel="stylesheet">
    <link href="http://walkerke.github.io/theme/bootstrap.min.responsive.css" rel="stylesheet">
    <link href="http://walkerke.github.io/theme/local.css" rel="stylesheet">
    <link href="http://walkerke.github.io/theme/pygments.css" rel="stylesheet">

</head>

<body>

<div class="navbar">
    <div class="navbar-inner">
    <div class="container">

         <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
         </a>

        <a class="brand" href="http://walkerke.github.io">Teaching with Interactive Data Visualization</a>

        <div class="nav-collapse">
        <ul class="nav">
            
            <li><a href="http://walkerke.github.io/about/">About</a></li>
            <li><a href="http://walkerke.github.io/rpydocs/">RPubs/IPython Notebooks</a></li>
        </ul>
        </div>
        
    </div>
    </div>
</div>

<div class="container">
    <div class="content">
    <div class="row">

        <div class="span9">
        

        


    <div class='article'>
        <div class="content-title">
            <a href="http://walkerke.github.io/2015/02/religion/"><h1>Mapping religious adherence in the US with CartoDB</h1></a>
Thu 26 February 2015

by <a class="url fn" href="http://walkerke.github.io/author/kyle-walker.html">Kyle Walker</a>
 


 
        </div>
        
        <div><p><strong>Update 2/26: changes made after conversations with Steven Romalewski on Twitter.  For the previous version of the post, check my GitHub version history.</strong></p>
<p>Before coming to TCU, I worked as a data analyst for the <a href="https://www.cpg.org/">Church Pension Group</a>, which manages the retirement funds and provides other financial services for the Episcopal Church.  I was part of a small research group that completed both internal and public-facing studies using the company's data.  <a href="https://www.cpg.org/global/research/reports-statistics/">You can take a look at some of the studies I worked on here</a>.  While I was at CPG, I developed an interest in the sociology of religion, as changing rates of religious adherence were of critical importance to CPG's work, as they impact the overall viability of parishes (and in turn the fiscal health of the Church).  During this time, data for the <a href="http://www.rcms2010.org/">2010 US Religion Census (or Religious Congregations and Membership Study, abbreviated as RCMS)</a> started to become available.  As the US Census does not ask questions about religion, researchers interested in studying religion must turn to other data sources like these.  </p>
<p>I never had the opportunity to really dig into this dataset while at CPG, as I left for my current position at TCU shortly afterward.  However, as I teach about the geography of religious adherence (defined here as the proportion of the population actively practicing a religion) in my World Regional Geography course, I took the opportunity to dive back into the data.  I was inspired by <a href="http://www.glenmary.org/rcms2010/">this map from the Glenmary Research Center</a> which maps the top religious family by county in the United States.  This map is excellent, but I wanted an interactive version that I could explore with my students in class (and that they could explore outside of class).  However, I did really like the bivariate cartographic technique they used to present the data (<a href="http://www.joshuastevens.net/cartography/make-a-bivariate-choropleth-map/">see this post from Joshua Stevens for a great overview of bivariate mapping</a>).  In this instance, the top religious group in each county is assigned a color; then, the intensity of the color is related to the adherence percentage for that group.  This makes sense; if two counties have Catholic as their top group, but one has an adherence of 75 percent as opposed to 20 percent for the other, they should not be represented the same way.  </p>
<p>There are many other examples of this type of cartographic approach.  Some excellent examples have come from <a href="https://twitter.com/SR_spatial">Steven Romalewski</a> and CUNY's Center for Urban Research, where they have mapped <a href="http://www.urbanresearchmaps.org/comparinator/pluralitymap.htm">demographic change</a> and <a href="http://www.electionatlas.nyc/maps.html#!interactive">election results</a>.  I use the demographic map in my teaching every semester to discuss issues of gentrification and demographic inversion in metropolitan areas.  In the CUNY maps, the qualitative color of a feature represents the most prevalent group (e.g. race) and then the intensity of the hue represents its relative value (the percentage represented by that racial group).  </p>
<p>A related approach is <strong>value-by-alpha</strong>, which works in a similar way in that the color of a feature represents one attribute, and its opacity represents an equalizing attribute, like total population.  You can read more about <a href="https://twitter.com/awoodruff">Andy Woodruff's</a> fine work on the topic <a href="http://andywoodruff.com/blog/how-to-make-a-value-by-alpha-map/">here</a>, <a href="http://andywoodruff.com/blog/value-by-alpha-maps/">here</a>, and <a href="http://www.ncbi.nlm.nih.gov/pmc/articles/PMC3173776/">here</a>.  </p>
<p>I borrow from these approaches to map religious adherence by county using <a href="http://cartodb.com/">CartoDB</a>, a phenomenal web-based platform for creating interactive maps.  CartoDB's functionality ranges from the creation of simple maps with a user-friendly web UI to actual GIS functionality using its PostGIS backend with spatial SQL.  Here is the map I created; below, I'll explain how I did it!  Use the arrows button in the upper left to pop the map out to full screen; <a href="http://kwalkertcu.cartodb.com/viz/dfe2d3b2-a0da-11e4-a315-0e4fddd5de28/embed_map">click here if you'd like a direct link to the map.</a>  </p>
<iframe width='100%' height='600' frameborder='0' src='http://kwalkertcu.cartodb.com/viz/dfe2d3b2-a0da-11e4-a315-0e4fddd5de28/embed_map' allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>

<p>The map shows the top religious adherence group by county, with some key differences from the Glenmary map; I classified the data as Catholic, Evangelical Protestant, Latter-Day Saints (Mormon), Mainline Protestant, and Black Protestant.  No other major category was the top group in the lower 48 states plus DC.  I used R to process the data; I won't go into detail about that here, but you can <a href="https://github.com/walkerke/teaching-with-datavis/blob/master/religion/religion2.R">view the code in my GitHub repository</a>.  The whole process can be reproduced by <a href="https://github.com/walkerke/teaching-with-datavis/tree/master/religion">cloning the repo</a>, running the script, and zipping up the new shapefile <code>cty_religion</code> for uploading to CartoDB. </p>
<p>Uploading your data to CartoDB is straightforward: once your data are in the right format (in this instance, in the form of a zipped shapefile), just sign in and drag and drop!  Once your data have loaded, CartoDB includes a number of "wizards" you can use to style your data in a very user-friendly way.  For more complex visualizations, however, you can use <a href="https://www.mapbox.com/tilemill/docs/manual/carto/">CartoCSS</a>.  CartoCSS, which is also used by MapBox Studio (another new favorite of mine), is a CSS-like syntax for styling map data.  It also makes bivariate visualizations possible.  To style the map, I grabbed some colors from <a href="http://colorbrewer2.org/">ColorBrewer</a> and used the following syntax: </p>
<div class="highlight"><pre><span class="nf">#cty_religion</span> <span class="p">{</span>
   <span class="n">line</span><span class="o">-</span><span class="k">color</span><span class="o">:</span> <span class="m">#FFF</span><span class="p">;</span>
   <span class="n">line</span><span class="o">-</span><span class="k">width</span><span class="o">:</span> <span class="m">1</span><span class="p">;</span>
   <span class="n">line</span><span class="o">-</span><span class="k">opacity</span><span class="o">:</span> <span class="m">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="nf">#cty_religion</span><span class="o">[</span><span class="nt">religion</span><span class="o">=</span><span class="s2">&quot;Evangelical&quot;</span><span class="o">]</span> <span class="p">{</span>
   <span class="n">polygon</span><span class="o">-</span><span class="n">fill</span><span class="o">:</span> <span class="m">#e41a1c</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#cty_religion</span><span class="o">[</span><span class="nt">religion</span><span class="o">=</span><span class="s2">&quot;Catholic&quot;</span><span class="o">]</span> <span class="p">{</span>
   <span class="n">polygon</span><span class="o">-</span><span class="n">fill</span><span class="o">:</span> <span class="m">#377eb8</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#cty_religion</span><span class="o">[</span><span class="nt">religion</span><span class="o">=</span><span class="s2">&quot;Mainline&quot;</span><span class="o">]</span> <span class="p">{</span>
   <span class="n">polygon</span><span class="o">-</span><span class="n">fill</span><span class="o">:</span> <span class="m">#4daf4a</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#cty_religion</span><span class="o">[</span><span class="nt">religion</span><span class="o">=</span><span class="s2">&quot;LDS&quot;</span><span class="o">]</span> <span class="p">{</span>
   <span class="n">polygon</span><span class="o">-</span><span class="n">fill</span><span class="o">:</span> <span class="m">#984ea3</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#cty_religion</span><span class="o">[</span><span class="nt">religion</span><span class="o">=</span><span class="s2">&quot;African-American&quot;</span><span class="o">]</span> <span class="p">{</span>
   <span class="n">polygon</span><span class="o">-</span><span class="n">fill</span><span class="o">:</span> <span class="m">#ff7f00</span><span class="p">;</span>
<span class="p">}</span>

<span class="nf">#cty_religion</span><span class="o">[</span><span class="nt">percent</span> <span class="o">&gt;=</span> <span class="nt">0</span><span class="o">]</span> <span class="p">{</span>
  <span class="n">polygon</span><span class="o">-</span><span class="k">opacity</span><span class="o">:</span> <span class="m">0</span><span class="o">.</span><span class="m">2</span><span class="p">;</span> 
<span class="p">}</span>
<span class="nf">#cty_religion</span><span class="o">[</span><span class="nt">percent</span> <span class="o">&gt;=</span> <span class="nt">20</span><span class="o">]</span> <span class="p">{</span>
  <span class="n">polygon</span><span class="o">-</span><span class="k">opacity</span><span class="o">:</span> <span class="m">0</span><span class="o">.</span><span class="m">4</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#cty_religion</span><span class="o">[</span><span class="nt">percent</span> <span class="o">&gt;=</span> <span class="nt">30</span><span class="o">]</span> <span class="p">{</span>
  <span class="n">polygon</span><span class="o">-</span><span class="k">opacity</span><span class="o">:</span> <span class="m">0</span><span class="o">.</span><span class="m">6</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#cty_religion</span><span class="o">[</span><span class="nt">percent</span> <span class="o">&gt;=</span> <span class="nt">40</span><span class="o">]</span> <span class="p">{</span>
  <span class="n">polygon</span><span class="o">-</span><span class="k">opacity</span><span class="o">:</span> <span class="m">0</span><span class="o">.</span><span class="m">8</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>The <code>polygon-fill</code> method is used to style my data by religious category with colors; the <code>polygon-opacity</code> method then adjusts the opacity of the features, which then blend with the light-gray CartoDB basemap to show relative intensity.  I used, roughly, a quantile classification scheme with four bins (with some slight rounding to 20, 30, and 40) for this.  The map, I feel, shows clear trends in religious adherence in the US.  The South is the Evangelical center of the country; Catholicism is more prevalent along the US/Mexico border and in the Northeast, Utah is a Mormon stronghold, and Mainline Protestantism predominates in the Upper Midwest.   The bivariate approach also gives the viewer a sense of the relative religiosity of different places; whereas Utah and the Southeast appear to have much stronger adherence to their top religious groups, the opacity of features in the Northwest suggests lower religiosity there (or at least no group that is significant numbers-wise).  </p>
<p>There is a lot more I'd like to do with this map; here are some ideas: </p>
<ul>
<li>I've restricted this to the lower 48 states plus DC; Alaska and Hawaii should be added.  </li>
<li>I'd like a better legend that shows variation in intensity as well as hue; I experimented with this a little but couldn't quite get anything satisfactory working.  </li>
<li>It would be great to have an interactive chart appear upon clicking each county that shows the overall distribution of each group; this is beyond my current CartoDB.js skills but something to consider for a future iteration.  </li>
</ul>
<p>If you have any comments or questions, please let me know!</p>
<p><strong>Thanks to:</strong></p>
<ul>
<li>Steven Romalewski and the CUNY Center for Urban Research for their innovative approaches to bivariate mapping</li>
<li>Andy Woodruff and others for resources on the value-by-alpha technique</li>
<li>CartoDB</li>
<li>The <a href="http://www.thearda.com/">Association of Religion Data Archives</a> for providing free access to the RCMS data</li>
<li><a href="http://www.nhgis.org">NHGIS</a> at the University of Minnesota for the spatial data</li>
<li>The Glenmary Research Center for inspiring this map</li>
</ul></div>
        <hr />
    </div>
		
<div class="pagination">
<ul>
    <li class="prev disabled"><a href="#">&larr; Previous</a></li>

    <li class="active"><a href="http://walkerke.github.io/tag/cartodb.html">1</a></li>

    <li class="next disabled"><a href="#">&rarr; Next</a></li>

</ul>
</div>
 
  
        </div>
        
        <div class="span3">

            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Site
                </li>
            
                <li><a href="http://walkerke.github.io/archives.html">Archives</a>
                <li><a href="http://walkerke.github.io/tags.html">Tags</a>
                <li><a href="http://walkerke.github.io/feeds/all.atom.xml" rel="alternate">Atom feed</a></li>
            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Categories
                </li>
                
                <li><a href="http://walkerke.github.io/category/charts.html">Charts</a></li>
                <li><a href="http://walkerke.github.io/category/maps.html">Maps</a></li>
                <li><a href="http://walkerke.github.io/category/presentations.html">Presentations</a></li>
                   
            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Links
                </li>
            
                <li><a href="http://personal.tcu.edu/kylewalker">Professional website</a></li>
                <li><a href="http://his.tcu.edu/">Department website</a></li>
                <li><a href="http://www.tcu.edu">TCU</a></li>
            </ul>
            </div>


            <div class="social">
            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Social
                </li>
           
                <li><a href="https://twitter.com/kyle_e_walker">Twitter</a></li>
                <li><a href="https://github.com/walkerke">Github</a></li>
                <li><a href="http://www.linkedin.com/in/walkerke">LinkedIn</a></li>
            </ul>
            </div>
            </div>

        </div>  
    </div>     </div> 
<footer>
<br />
<p><a href="http://walkerke.github.io">Teaching with Interactive Data Visualization</a> &copy; Kyle Walker 2015</p>
</footer>

</div> <!-- /container -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="http://walkerke.github.io/theme/bootstrap-collapse.js"></script>
<script>var _gaq=[['_setAccount','UA-51388803-1'],['_trackPageview']];(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.src='//www.google-analytics.com/ga.js';s.parentNode.insertBefore(g,s)}(document,'script'))</script>
 
</body>
</html>