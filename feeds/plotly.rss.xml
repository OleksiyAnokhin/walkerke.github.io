<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Teaching with Interactive Data Visualization</title><link>http://walkerke.github.io/</link><description></description><atom:link href="http://walkerke.github.io/feeds/plotly.rss.xml" rel="self"></atom:link><lastBuildDate>Mon, 12 May 2014 00:00:00 -0500</lastBuildDate><item><title>Visualizing the economics of tourism in the Pacific with Plotly</title><link>http://walkerke.github.io/2014/05/tourism-plotly/</link><description>&lt;p&gt;Over the last month or so, I've been working a lot with &lt;a href="http://plot.ly"&gt;Plotly&lt;/a&gt; to visualize data for my World Regional Geography course.  Plotly is a web-based service that allows for the creation of interactive, D3-based visualizations that can be easily shared.  Visualizations are deployed and hosted on Plotly's servers, so the service requires a connection to the internet to work.  One of the great things about Plotly is that it has APIs for popular data programming languages like &lt;a href="http://plot.ly/r/"&gt;R&lt;/a&gt;, &lt;a href="http://plot.ly/python/"&gt;Python&lt;/a&gt;, and &lt;a href="http://plot.ly/julia/"&gt;Julia&lt;/a&gt;.  I really got hooked on Plotly, however, when I learned about &lt;code&gt;ggplotly&lt;/code&gt;, &lt;a href="http://ropensci.org/blog/2014/04/17/plotly/"&gt;which allows you to convert &lt;strong&gt;ggplot2&lt;/strong&gt; graphs in R to interactive Plotly charts with just a couple extra lines of code&lt;/a&gt;.   I'm going to go over an example of how I used &lt;code&gt;ggplotly&lt;/code&gt; to assist with a discussion of the economic significance of tourism in the Pacific.&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;In my final class of the semester, I focused on Oceania (defined as Australia, New Zealand, and Pacific Island nations).  In this class, I wanted to show students how small, relatively isolated countries in the Pacific can be acutely affected by larger global forces.  We focused on topics such as trash accumulation in the Pacific, sea level rise due to climate change, and the ways in which island countries are connected to the global economy.  As part of this, we discussed the role of tourism in Pacific Island economies.  To help illustrate this to my students, I sought out data on the tourist economies of these countries, which is freely available from the &lt;a href="http://www.wttc.org/research/economic-data-search-tool/"&gt;World Travel &amp;amp; Tourism Council's Economic Data Search Tool&lt;/a&gt;.  To download the data, I followed these steps: &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;For Step 1 of the search tool, I clicked &lt;strong&gt;Countries &amp;gt; Oceania&lt;/strong&gt;, then selected Fiji, Kiribati, Other Oceania, Solomon Islands, Tonga, and Vanuatu.  &lt;/li&gt;
&lt;li&gt;For Step 2, I selected "Travel &amp;amp; Tourism Total Contribution to GDP."  These figures include both tourism's direct contributions to GDP (e.g. GDP generated by hotels, airlines, etc.) and its indirect contributions to the economy; &lt;a href="http://www.wttc.org/site_media/uploads/downloads/oceania2014.pdf"&gt;see this report for more details&lt;/a&gt;.  &lt;/li&gt;
&lt;li&gt;For Step 3, I selected "% share" as my unit, as I was interested in the extent to which tourism figures in the overall constitution of these countries' economies.  &lt;/li&gt;
&lt;li&gt;I chose the entire date range from 1988 to 2024 (projected), and clicked &lt;strong&gt;Submit&lt;/strong&gt;.  &lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The data can then be downloaded as an Excel file.  However, the Excel file is formatted in a way that resembles the HTML on the web page, and as such is not in the "tidy" format that is required for visualization in ggplot2.  As such, I saved the file as a CSV (which is available from my GitHub repository) and imported the data into R for some cleaning.  &lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;The R code below shows one way to clean up data downloaded from the WTTC in this particular format (multiple countries, one variable).  I've written a function, &lt;code&gt;tidy_WTTC&lt;/code&gt;, that should work for any dataset in this form available from the WTTC.  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c1"&gt;# Load packages and data&lt;/span&gt;

library&lt;span class="p"&gt;(&lt;/span&gt;reshape2&lt;span class="p"&gt;)&lt;/span&gt;
library&lt;span class="p"&gt;(&lt;/span&gt;ggplot2&lt;span class="p"&gt;)&lt;/span&gt;
library&lt;span class="p"&gt;(&lt;/span&gt;plotly&lt;span class="p"&gt;)&lt;/span&gt;
library&lt;span class="p"&gt;(&lt;/span&gt;zoo&lt;span class="p"&gt;)&lt;/span&gt;

dat &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; read.csv&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;tourism.csv&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;## Define the &amp;quot;tidy&amp;quot; function and call it&lt;/span&gt;

tidy_WTTC &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kr"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;df&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;

  start &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; df&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="m"&gt;7&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
  end &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; df&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="m"&gt;7&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; ncol&lt;span class="p"&gt;(&lt;/span&gt;df&lt;span class="p"&gt;)]&lt;/span&gt;

  df &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; df&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="m"&gt;8&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;nrow&lt;span class="p"&gt;(&lt;/span&gt;df&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt;

  nms &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; c&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;country&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; paste0&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;y&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; seq&lt;span class="p"&gt;(&lt;/span&gt;start&lt;span class="p"&gt;,&lt;/span&gt; end&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;

  names&lt;span class="p"&gt;(&lt;/span&gt;df&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; nms

  df &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; na.locf&lt;span class="p"&gt;(&lt;/span&gt;df&lt;span class="p"&gt;,&lt;/span&gt; fromLast &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

  df &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; df&lt;span class="p"&gt;[&lt;/span&gt;seq&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; nrow&lt;span class="p"&gt;(&lt;/span&gt;df&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt;

  df.melt &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; melt&lt;span class="p"&gt;(&lt;/span&gt;df&lt;span class="p"&gt;,&lt;/span&gt; id.vars &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;country&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; value.name&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;value&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; variable.name &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;year&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

  df.melt&lt;span class="o"&gt;$&lt;/span&gt;year &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; as.numeric&lt;span class="p"&gt;(&lt;/span&gt;gsub&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;y&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; df.melt&lt;span class="o"&gt;$&lt;/span&gt;year&lt;span class="p"&gt;))&lt;/span&gt;

  df.melt&lt;span class="o"&gt;$&lt;/span&gt;value &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; as.numeric&lt;span class="p"&gt;(&lt;/span&gt;df.melt&lt;span class="o"&gt;$&lt;/span&gt;value&lt;span class="p"&gt;)&lt;/span&gt;

  df.melt
&lt;span class="p"&gt;}&lt;/span&gt;

tidy_dat &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; tidy_WTTC&lt;span class="p"&gt;(&lt;/span&gt;dat&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;A few notes about the above code.  To do anything with Plotly in R, it is necessary to use the &lt;strong&gt;plotly&lt;/strong&gt; R package, &lt;a href="https://github.com/ropensci/plotly"&gt;which is available from rOpenSci's repository on GitHub&lt;/a&gt;.  As such, it must be installed first using the &lt;strong&gt;devtools&lt;/strong&gt; package with the command &lt;code&gt;install_github("ropensci/plotly")&lt;/code&gt;.  &lt;/p&gt;
&lt;p&gt;I'd also like to explain the function in brief.  I've set it up to handle data downloads from the WTTC, provided that a) you've chosen a group of countries and one variable, and b) you've saved the Excel download as a CSV.  Given the structure of the WTTC data, the function will detect the years you've chosen for your download and re-format the data accordingly.  Next, I use the &lt;code&gt;na.locf&lt;/code&gt; function from the &lt;strong&gt;zoo&lt;/strong&gt; package to resolve the fact that country names are on one row in the original data file, with corresponding values on the next row; this fills in NAs with their correct values.  I then remove the unnecessary rows, and then reshape and reformat the data for visualization with &lt;strong&gt;ggplot2&lt;/strong&gt;.    &lt;/p&gt;
&lt;p&gt;The data are now ready for plotting with &lt;strong&gt;ggplot2&lt;/strong&gt;, and can then be converted to an interactive Plotly chart.  The code below shows how to get this done.  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c1"&gt;## Create the ggplot, initialize the plotly object, and convert the ggplot to plotly&lt;/span&gt;

t1 &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; ggplot&lt;span class="p"&gt;(&lt;/span&gt;tidy_dat&lt;span class="p"&gt;,&lt;/span&gt; aes&lt;span class="p"&gt;(&lt;/span&gt;x &lt;span class="o"&gt;=&lt;/span&gt; year&lt;span class="p"&gt;,&lt;/span&gt; y &lt;span class="o"&gt;=&lt;/span&gt; value&lt;span class="p"&gt;,&lt;/span&gt; color &lt;span class="o"&gt;=&lt;/span&gt; country&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; 
  geom_line&lt;span class="p"&gt;(&lt;/span&gt;size &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; 
  scale_color_brewer&lt;span class="p"&gt;(&lt;/span&gt;palette &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Set1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; 
  labs&lt;span class="p"&gt;(&lt;/span&gt;list&lt;span class="p"&gt;(&lt;/span&gt;x &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Year&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; 
            y &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Total contribution of tourism to GDP (percent)&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; 
            title &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Total contribution of tourism to GDP (percent), select Pacific Island countries.  Data source: WTTC&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

py &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; plotly&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;YOUR USERNAME HERE&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;YOUR API KEY HERE&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

py&lt;span class="o"&gt;$&lt;/span&gt;ggplotly&lt;span class="p"&gt;(&lt;/span&gt;t1&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The &lt;strong&gt;ggplot2&lt;/strong&gt; code is fairly straightforward; I'm making a basic line chart with minimal customization.  After creating the ggplot, the last two lines of code are all that are necessary to create an interactive chart with Plotly.  You will need to sign up for a Plotly account and get an API key to get this to work; fill in your own username and password where instructed to initialize the Plotly interface object, which I've called &lt;code&gt;py&lt;/code&gt;.  Finally, the &lt;code&gt;py$ggplotly(t1)&lt;/code&gt; command converts the ggplot &lt;code&gt;t1&lt;/code&gt; into an interactive chart, which should appear in your browser.  If everything has worked correctly, you'll get a chart that looks like the one below:  &lt;/p&gt;
&lt;p&gt;(If the iframe is not showing up properly, &lt;a href="http://plot.ly/~walkerke/52"&gt;click here&lt;/a&gt; to access the chart)&lt;/p&gt;
&lt;hr /&gt;
&lt;div class = "iframe container"&gt;
&lt;iframe src="https://plot.ly/~walkerke/53" id="igraph" width="850" height="600" seamless scrolling="no" frameBorder = "0"&gt;&lt;/iframe&gt;
&lt;/div&gt;

&lt;hr /&gt;
&lt;p&gt;I now have an interactive chart that contains a wealth of information about the tourist economies of select Pacific Island countries.  As the chart reveals, the economic significance of tourism figures differently from country to country in the Pacific.  In places like Vanuatu and Fiji, tourism is a large component of the local economy and is projected to increase in importance.  In contrast, tourism is less prominent in places like Tonga, which relies heavily on remittances from Tongans living abroad; this example is familiar to my students, &lt;a href="http://www.star-telegram.com/2013/12/31/5453055/in-euless-tongans-usher-in-the.html"&gt;as there is a large Tongan community living in cities very near to TCU&lt;/a&gt;.  &lt;/p&gt;
&lt;p&gt;By default, Plotly embeds several options for interacting with the chart.  The user can click and drag on the chart itself to zoom in to particular areas; with a time series chart, this can be useful if the user wants to highlight a particular period of time in the graph.  Additionally, tooltips appear on hover that give direct access to the data informing the chart.  More interactivity is also available from the icons in the upper-right-hand corner of the chart, allowing users to zoom, pan, and change the desired tooltip display (all data series, or one at a time).  &lt;/p&gt;
&lt;p&gt;Once the chart is published to your Plotly account, you can customize it even further using Plotly's web-based GUI.  In the above example, I moved the position of the legend manually using the GUI to maximize the space occupied by the data; you can also edit the chart's appearance, change the axis and chart titles, and add notes to the chart, among other options.  &lt;/p&gt;
&lt;p&gt;Using &lt;code&gt;ggplotly&lt;/code&gt; in this way has become a major part of my workflow in preparing interactive materials for my teaching.  Here are a sampling of other charts I've prepared in this way:  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://plot.ly/~walkerke/12"&gt;Total fertility rates in South Asia by country, 1960-2011&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://plot.ly/~walkerke/21"&gt;Past and future population of Japan (projected)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://plot.ly/~walkerke/30"&gt;GDP by country since 1970, major world economies&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;More examples can be found at &lt;a href="https://plot.ly/~walkerke"&gt;my Plotly page&lt;/a&gt;, and I'll be posting the code for these visualizations to GitHub.  While &lt;code&gt;ggplotly&lt;/code&gt; has worked great for me so far, it is still very early in development and only supports a limited number of chart types from &lt;strong&gt;ggplot2&lt;/strong&gt; (&lt;a href="http://aarongonzales.net/plotly_examples.html"&gt;see this post for details&lt;/a&gt;).  In turn, you'll need to use Plotly's APIs to create the unavailable chart types, which I have just started to work with.  This summer, I'm going to explore using Plotly as well using Python, &lt;a href="http://nbviewer.ipython.org/github/plotly/python-user-guide/blob/master/s00_homepage/s00_homepage.ipynb"&gt;which has a well-developed API&lt;/a&gt; and appears to work very well with the IPython Notebook.  &lt;/p&gt;
&lt;p&gt;As always, please contact me at &lt;a href="&amp;#109;&amp;#97;&amp;#105;&amp;#108;&amp;#116;&amp;#111;&amp;#58;&amp;#107;&amp;#121;&amp;#108;&amp;#101;&amp;#46;&amp;#119;&amp;#97;&amp;#108;&amp;#107;&amp;#101;&amp;#114;&amp;#64;&amp;#116;&amp;#99;&amp;#117;&amp;#46;&amp;#101;&amp;#100;&amp;#117;"&gt;&amp;#107;&amp;#121;&amp;#108;&amp;#101;&amp;#46;&amp;#119;&amp;#97;&amp;#108;&amp;#107;&amp;#101;&amp;#114;&amp;#64;&amp;#116;&amp;#99;&amp;#117;&amp;#46;&amp;#101;&amp;#100;&amp;#117;&lt;/a&gt; or get in touch with me on &lt;a href="https://twitter.com/kyle_e_walker"&gt;Twitter&lt;/a&gt; if you have any questions or feedback.  &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Thanks to:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://twitter.com/plotlygraphs"&gt;The Plotly team&lt;/a&gt; for their amazing work;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://twitter.com/WTTC"&gt;The World Travel and Tourism Council&lt;/a&gt; for generously making their data publicly available.  &lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Kyle Walker</dc:creator><pubDate>Mon, 12 May 2014 00:00:00 -0500</pubDate><guid>tag:walkerke.github.io,2014-05-12:2014/05/tourism-plotly/</guid><category>R</category><category>Plotly</category><category>World Regional</category></item></channel></rss>