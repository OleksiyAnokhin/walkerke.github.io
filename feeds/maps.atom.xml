<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Teaching with Interactive Data Visualization</title><link href="http://walkerke.github.io/" rel="alternate"></link><link href="http://walkerke.github.io/feeds/maps.atom.xml" rel="self"></link><id>http://walkerke.github.io/</id><updated>2015-02-26T00:00:00-06:00</updated><entry><title>Mapping religious adherence in the US with CartoDB and value-by-alpha</title><link href="http://walkerke.github.io/2015/02/religion/" rel="alternate"></link><updated>2015-02-26T00:00:00-06:00</updated><author><name>Kyle Walker</name></author><id>tag:walkerke.github.io,2015-02-26:2015/02/religion/</id><summary type="html">&lt;p&gt;Before coming to TCU, I worked as a data analyst for the &lt;a href="https://www.cpg.org/"&gt;Church Pension Group&lt;/a&gt;, which manages the retirement funds and provides other financial services for the Episcopal Church.  I was part of a small research group that completed both internal and public-facing studies using the company's data.  &lt;a href="https://www.cpg.org/global/research/reports-statistics/"&gt;You can take a look at some of the studies I worked on here&lt;/a&gt;.  While I was at CPG, I developed an interest in the sociology of religion, as changing rates of religious adherence were of critical importance to CPG's work, as they impact the overall viability of parishes (and in turn the fiscal health of the Church).  During this time, data for the &lt;a href="http://www.rcms2010.org/"&gt;2010 US Religion Census (or Religious Congregations and Membership Study, abbreviated as RCMS)&lt;/a&gt; started to become available.  As the US Census does not ask questions about religion, researchers interested in studying religion must turn to other data sources like these.  &lt;/p&gt;
&lt;p&gt;I never had the opportunity to really dig into this dataset while at CPG, as I left for my current position at TCU shortly afterward.  However, as I teach about the geography of religious adherence (defined here as the proportion of the population actively practicing a religion) in my World Regional Geography course, I took the opportunity to dive back into the data.  I was inspired by &lt;a href="http://www.glenmary.org/rcms2010/"&gt;this map from the Glenmary Research Center&lt;/a&gt; which maps the top religious family by county in the United States.  This map is excellent, but I wanted an interactive version that I could explore with my students in class (and that they could explore outside of class).  However, I did really like the cartographic technique they used to present the data.  Their approach is similar to the &lt;strong&gt;value-by-alpha&lt;/strong&gt; approach, which is a method for bivariate mapping (&lt;a href="http://www.joshuastevens.net/cartography/make-a-bivariate-choropleth-map/"&gt;see this post from Joshua Stevens for a great overview&lt;/a&gt;).  In this instance, the top religious group in each county is assigned a color; then, the intensity of the color is related to the adherence percentage for that group.  This makes sense; if two counties have Catholic as their top group, but one has an adherence of 75 percent as opposed to 20 percent for the other, they should not be represented the same way.  &lt;/p&gt;
&lt;p&gt;Value-by-alpha works in a similar way in that the color of a feature represents one attribute, and the opacity of that feature represents another.  My inspiration for the technique comes from &lt;a href="https://twitter.com/awoodruff"&gt;Andy Woodruff's&lt;/a&gt; fine work on the topic: you can read about Andy's work &lt;a href="http://andywoodruff.com/blog/how-to-make-a-value-by-alpha-map/"&gt;here&lt;/a&gt;, &lt;a href="http://andywoodruff.com/blog/value-by-alpha-maps/"&gt;here&lt;/a&gt;, and &lt;a href="http://www.ncbi.nlm.nih.gov/pmc/articles/PMC3173776/"&gt;here&lt;/a&gt;.  &lt;/p&gt;
&lt;p&gt;I chose to implement value-by-alpha using &lt;a href="http://cartodb.com/"&gt;CartoDB&lt;/a&gt;, a phenomenal web-based platform for creating interactive maps.  CartoDB's functionality ranges from the creation of simple maps with a user-friendly web UI to actual GIS functionality using its PostGIS backend with spatial SQL.  Here is the map I created; below, I'll explain how I did it!  Use the arrows button in the upper left to pop the map out to full screen; &lt;a href="http://kwalkertcu.cartodb.com/viz/dfe2d3b2-a0da-11e4-a315-0e4fddd5de28/embed_map"&gt;click here if you'd like a direct link to the map.&lt;/a&gt;  &lt;/p&gt;
&lt;iframe width='100%' height='600' frameborder='0' src='http://kwalkertcu.cartodb.com/viz/dfe2d3b2-a0da-11e4-a315-0e4fddd5de28/embed_map' allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen&gt;&lt;/iframe&gt;

&lt;p&gt;The map shows the top religious adherence group by county, with some key differences from the Glenmary map; I classified the data as Catholic, Evangelical Protestant, Latter-Day Saints (Mormon), Mainline Protestant, and Black Protestant.  No other major category was the top group in the lower 48 states plus DC.  I used R to process the data; I won't go into detail about that here, but you can &lt;a href="https://github.com/walkerke/teaching-with-datavis/blob/master/religion/religion2.R"&gt;view the code in my GitHub repository&lt;/a&gt;.  The whole process can be reproduced by &lt;a href="https://github.com/walkerke/teaching-with-datavis/tree/master/religion"&gt;cloning the repo&lt;/a&gt;, running the script, and zipping up the new shapefile &lt;code&gt;cty_religion&lt;/code&gt; for uploading to CartoDB. &lt;/p&gt;
&lt;p&gt;Uploading your data to CartoDB is straightforward: once your data are in the right format (in this instance, in the form of a zipped shapefile), just sign in and drag and drop!  Once your data have loaded, CartoDB includes a number of "wizards" you can use to style your data in a very user-friendly way.  For more complex visualizations, however, you can use &lt;a href="https://www.mapbox.com/tilemill/docs/manual/carto/"&gt;CartoCSS&lt;/a&gt;.  CartoCSS, which is also used by MapBox Studio (another new favorite of mine), is a CSS-like syntax for styling map data.  It also makes bivariate visualizations like value-by-alpha maps possible.  To style the map, I grabbed some colors from &lt;a href="http://colorbrewer2.org/"&gt;ColorBrewer&lt;/a&gt; and used the following syntax: &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nf"&gt;#cty_religion&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
   &lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="k"&gt;color&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="m"&gt;#FFF&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
   &lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="k"&gt;width&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
   &lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="k"&gt;opacity&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="nf"&gt;#cty_religion&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="nt"&gt;religion&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Evangelical&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
   &lt;span class="n"&gt;polygon&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;fill&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="m"&gt;#e41a1c&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nf"&gt;#cty_religion&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="nt"&gt;religion&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Catholic&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
   &lt;span class="n"&gt;polygon&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;fill&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="m"&gt;#377eb8&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nf"&gt;#cty_religion&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="nt"&gt;religion&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Mainline&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
   &lt;span class="n"&gt;polygon&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;fill&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="m"&gt;#4daf4a&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nf"&gt;#cty_religion&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="nt"&gt;religion&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;LDS&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
   &lt;span class="n"&gt;polygon&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;fill&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="m"&gt;#984ea3&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nf"&gt;#cty_religion&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="nt"&gt;religion&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;African-American&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
   &lt;span class="n"&gt;polygon&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;fill&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="m"&gt;#ff7f00&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="nf"&gt;#cty_religion&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="nt"&gt;percent&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="nt"&gt;0&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;polygon&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="k"&gt;opacity&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; 
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nf"&gt;#cty_religion&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="nt"&gt;percent&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="nt"&gt;20&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;polygon&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="k"&gt;opacity&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="m"&gt;4&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nf"&gt;#cty_religion&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="nt"&gt;percent&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="nt"&gt;30&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;polygon&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="k"&gt;opacity&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="m"&gt;6&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nf"&gt;#cty_religion&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="nt"&gt;percent&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="nt"&gt;40&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;polygon&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="k"&gt;opacity&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="m"&gt;8&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The &lt;code&gt;polygon-fill&lt;/code&gt; method is used to style my data by religious category with colors; the &lt;code&gt;polygon-opacity&lt;/code&gt; method then adjusts the opacity of the features, which then blend with the light-gray CartoDB basemap.  I used, roughly, a quantile classification scheme with four bins (with some slight rounding to 20, 30, and 40) for this.  The map, I feel, shows clear trends in religious adherence in the US.  The South is the Evangelical center of the country; Catholicism is more prevalent along the US/Mexico border and in the Northeast, Utah is a Mormon stronghold, and Mainline Protestantism predominates in the Upper Midwest.   The value-by-alpha approach also gives the viewer a sense of the relative religiosity of different places; whereas Utah and the Southeast appear to have much stronger adherence to their top religious groups, the opacity of features in the Northwest suggests lower religiosity there (or at least no group that is significant numbers-wise).  &lt;/p&gt;
&lt;p&gt;There is a lot more I'd like to do with this map; here are some ideas: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;I've restricted this to the lower 48 states plus DC; Alaska and Hawaii should be added.  &lt;/li&gt;
&lt;li&gt;I'd like a better legend that shows variation in opacity as well as hue; I experimented with this a little but couldn't quite get anything satisfactory working.  &lt;/li&gt;
&lt;li&gt;It would be great to have an interactive chart appear upon clicking each county that shows the overall distribution of each group; this is beyond my current CartoDB.js skills but something to consider for a future iteration.  &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;If you have any comments or questions, please let me know!&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Thanks to:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Andy Woodruff and others for resources on the value-by-alpha technique&lt;/li&gt;
&lt;li&gt;CartoDB&lt;/li&gt;
&lt;li&gt;The &lt;a href="http://www.thearda.com/"&gt;Association of Religion Data Archives&lt;/a&gt; for providing free access to the RCMS data&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.nhgis.org"&gt;NHGIS&lt;/a&gt; at the University of Minnesota for the spatial data&lt;/li&gt;
&lt;li&gt;The Glenmary Research Center for inspiring this map&lt;/li&gt;
&lt;/ul&gt;</summary><category term="CartoDB"></category><category term="R"></category><category term="World Regional"></category></entry></feed>