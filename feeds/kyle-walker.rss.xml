<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Teaching with Interactive Data Visualization</title><link>http://walkerke.github.io/</link><description></description><atom:link href="http://walkerke.github.io/feeds%5Ckyle-walker.rss.xml" rel="self"></atom:link><lastBuildDate>Sat, 07 Jun 2014 00:00:00 -0500</lastBuildDate><item><title>Interactive international population pyramids with R, rCharts</title><link>http://walkerke.github.io/2014/06/rcharts-pyramids/</link><description>&lt;p&gt;I find population pyramids to be very effective teaching tools.  In short, a population pyramid is a type of chart that shows the population size of different age cohorts on the x-axis, with gender usually displayed back-to-back to create the shape of a "pyramid."  It is used to illustrate a snapshot of the age and sex structure of a population, and can serve as a tool that aids in discussion of many thematic issues such as population growth, aging, and gender imbalance.  The visually appealing structure of the population pyramid also makes it easy to compare the population structures of different countries, which is why I like to use pyramids in my classes.  This is exemplified by &lt;a href="http://blogs.worldbank.org/futuredevelopment/end-population-pyramid"&gt;this post from the World Bank&lt;/a&gt;, which shows how different "shapes" of the pyramid reflect different demographic contexts.  &lt;/p&gt;
&lt;p&gt;I was originally motivated to learn interactive visualization to produce interactive population pyramids.  My inspiration came from these examples from &lt;a href="http://vis.stanford.edu/jheer/d3/pyramid/shift.html"&gt;Jeff Heer&lt;/a&gt; and &lt;a href="http://bl.ocks.org/mbostock/4062085"&gt;Mike Bostock&lt;/a&gt;, which use data from the U.S. Census.  Since then, a number of other creative interactive population pyramid applications have gotten a lot of attention, such as &lt;a href="http://populationpyramid.net/"&gt;this visualization from Martin De Wulf&lt;/a&gt;, and &lt;a href="http://www.nytimes.com/2014/05/13/upshot/a-changing-shape-in-americas-age-distribution.html?rref=upshot&amp;amp;_r=1"&gt;this animated graphic from the Pew Research Center&lt;/a&gt;, referenced in &lt;em&gt;The New York Times'&lt;/em&gt; Upshot.  &lt;/p&gt;
&lt;p&gt;These are all great resources, but I wanted something both re-usable and customizable so that I could embed interactive pyramids for any country I needed in my slide decks for my World Regional Geography course.  To do this, I turned to the fantastic &lt;a href="http://www.census.gov/population/international/data/idb/informationGateway.php"&gt;International Data Base from the US Census Bureau&lt;/a&gt; for data, and the amazing &lt;a href="http://rcharts.io"&gt;rCharts&lt;/a&gt; to create the pyramids.  The Census Bureau's International Data Base contains a tremendous amount of information about basic demographic characteristics of the world's countries, and is easily downloaded; I've had students use it before to create their own population pyramids in Excel for class assignments.  However, as I wanted quick access to the data to in turn create interactive rCharts visualizations, I wrote a script, &lt;code&gt;rcharts_pyramids.R&lt;/code&gt;, that includes functions to scrape the Data Base website and produce an interactive pyramid with R within seconds.  &lt;/p&gt;
&lt;p&gt;Below, I'll discuss how to use the script.  I'd like anyone to be able to use this, regardless of their background with R; as such, I'm going to go easy on the technical details.  I'll follow up with another more code-heavy post, and &lt;a href="https://github.com/walkerke/teaching-with-datavis/blob/master/pyramids/rcharts_pyramids.R"&gt;the code is available on GitHub here&lt;/a&gt;.  &lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;To get started, make sure you have the following R packages installed: &lt;strong&gt;XML&lt;/strong&gt;, &lt;strong&gt;reshape2&lt;/strong&gt;, &lt;strong&gt;rCharts&lt;/strong&gt;, and &lt;strong&gt;plyr&lt;/strong&gt;.  &lt;strong&gt;rCharts&lt;/strong&gt; is not on CRAN, so you'll need to install it from GitHub with the &lt;strong&gt;devtools&lt;/strong&gt; package.  This script requires the &lt;code&gt;dev&lt;/code&gt; branch of &lt;strong&gt;rCharts&lt;/strong&gt;.  If you are just getting started with R, install the packages with the code below.  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;install.packages&lt;span class="p"&gt;(&lt;/span&gt;c&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;XML&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;reshape2&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;devtools&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;plyr&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
library&lt;span class="p"&gt;(&lt;/span&gt;devtools&lt;span class="p"&gt;)&lt;/span&gt;
install_github&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;ramnathv/rCharts@dev&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Once these packages are installed, you are ready to get started.  If you are using &lt;a href="http://www.rstudio.com/"&gt;RStudio&lt;/a&gt; (which I strongly recommend), simply enter the following command into the R Console: &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;source&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;https://raw.githubusercontent.com/walkerke/teaching-with-datavis/master/pyramids/rcharts_pyramids.R&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;If you are not using RStudio, use &lt;code&gt;source_url&lt;/code&gt; from the &lt;strong&gt;devtools&lt;/strong&gt; package instead of &lt;code&gt;source&lt;/code&gt;.  Alternatively, you can get the script from GitHub yourself and load it.&lt;/p&gt;
&lt;p&gt;The script contains four functions: &lt;code&gt;getAgeTable&lt;/code&gt;, &lt;code&gt;dPyramid&lt;/code&gt;, &lt;code&gt;hPyramid&lt;/code&gt;, and &lt;code&gt;nPyramid&lt;/code&gt;.  &lt;code&gt;getAgeTable&lt;/code&gt; is a helper function that uses the &lt;strong&gt;XML&lt;/strong&gt; package to scrape data from the International Data Base and convert it into an R data frame.  I pull data from the category "Mid-year Population by Five Year Age Groups and Sex" to create the pyramids.  The other three functions are used to create population pyramids from the data with different JavaScript libraries available through &lt;strong&gt;rCharts&lt;/strong&gt;.  Each function has three parameters:  &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;country&lt;/code&gt; (required): the FIPS 10-4 country code for your country of interest.  You can find the codes from &lt;a href="http://en.wikipedia.org/wiki/List_of_FIPS_country_codes"&gt;this Wikipedia page&lt;/a&gt;, or use the &lt;a href="https://github.com/vincentarelbundock/countrycode"&gt;&lt;strong&gt;countrycode&lt;/strong&gt; R package&lt;/a&gt;.  &lt;/li&gt;
&lt;li&gt;&lt;code&gt;year&lt;/code&gt; (required): The year for which you want to make the pyramid.  The Data Base includes historical information going back to 1950, and projected counts up to 2050 &lt;a href="http://www.census.gov/population/international/data/idb/informationGateway.php"&gt;see this link for the Census Bureau's projection methodology&lt;/a&gt;.  Not all years are available for all countries, however.  &lt;/li&gt;
&lt;li&gt;&lt;code&gt;colors&lt;/code&gt; (optional): A vector of length 2 that contains the colors you want to use for your pyramid.  If you leave this argument blank, you'll get the default colors for your pyramid.  &lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Now, let's see how this works!  &lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;The first example I'll show you is &lt;code&gt;nPyramid&lt;/code&gt;, which uses the &lt;a href="http://nvd3.org/"&gt;NVD3.js library&lt;/a&gt;, which is built on top of D3.  I'm going to create a population pyramid for Qatar in 2014.  I spend a fair amount of time talking about Qatar in my course, as it exemplifies many of the topics we cover such as economic inequality, energy and economic growth, and international labor migration.  In fact, &lt;a href="http://www.pewsocialtrends.org/2013/12/17/migration-tables/"&gt;around three-quarters of Qatar's population is foreign-born&lt;/a&gt;; further, &lt;a href="http://espn.go.com/video/clip?id=11019010&amp;amp;categoryid=2378529"&gt;the conditions endured by migrant laborers in Qatar are attracting international attention in the run-up to the 2022 World Cup&lt;/a&gt;.  &lt;/p&gt;
&lt;p&gt;To create the visualization, simply type the following command into your R console: &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;nPyramid&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;QA&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="m"&gt;2014&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; colors &lt;span class="o"&gt;=&lt;/span&gt; c&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;darkred&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;silver&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Which produces the chart below. I have trouble with NVD3 in the RStudio viewer, so you may need to open it in a web browser if you are using RStudio.  &lt;/p&gt;
&lt;iframe src="http://walkerke.github.io/teaching-with-datavis/pyramids/qatar.html" width="850" height="400" seamless scrolling="no" frameBorder = "0"&gt;&lt;/iframe&gt;

&lt;p&gt;The pyramid is striking for the dramatic gender imbalance in Qatar introduced by the influx of foreign laborers to the country.  Males aged 30-34 number nearly 300,000; this is over four times the number of females in that age category, who number just over 70,000.  Admittedly, population pyramids like this can be problematic for making gender comparisons (&lt;a href="http://bl.ocks.org/mbostock/4062085"&gt;Mike Bostock argues as much here&lt;/a&gt;), but this is allayed somewhat when using these pyramids interactively, as the visualizations produce a tooltip on hover that returns the precise population count for the age cohort, allowing for comparisons of the numbers.  &lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;The next example comes from &lt;a href="http://www.highcharts.com/"&gt;Highcharts&lt;/a&gt;, an interactive JavaScript charting library that includes many different examples and is very well-documented.  I'm going to use Highcharts here to create an interactive population pyramid for Japan in 2050 with the &lt;code&gt;hPyramid&lt;/code&gt; function.  In class, we discussed the &lt;a href="http://www.economist.com/news/asia/21603076-first-time-proper-debate-starting-about-immigration-incredible-shrinking-country?spc=scode&amp;amp;spv=xm&amp;amp;ah=9d7f7ab945510a56fa6d37c30b6f1709"&gt;challenges Japan is facing as its population ages&lt;/a&gt;; this population pyramid provided important visual context.  To create the chart, use the code below: &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;hPyramid&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;JA&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="m"&gt;2050&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; colors &lt;span class="o"&gt;=&lt;/span&gt; c&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;blue&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;red&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;iframe src="http://walkerke.github.io/teaching-with-datavis/pyramids/japan2050.html" width="850" height="400" seamless scrolling="no" frameBorder = "0"&gt;&lt;/iframe&gt;

&lt;p&gt;Japan's projected population structure in 2050 exemplifies an "inverted" population pyramid, with the oldest age cohorts comprising the largest proportions of the population, and the youngest the smallest.  There are many reasons why this is projected to happen in Japan, including high life expectancy, restrictive immigration policies, and declining marriage rates (contributing to low fertility levels).  In turn, Japan's shrinking workforce will have to provide for an increasingly large elderly population, which is illustrated in the chart.  As with the NVD3 pyramid, the chart gives a tooltip on mouseover that returns specific population figures.  One of the most striking features of the pyramid this reveals is the population of female centenarians (people aged 100+), which is projected to exceed 1 million by 2050 as per the Census Bureau.  &lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;The last example I'll show you is &lt;code&gt;dPyramid&lt;/code&gt;, which uses the &lt;a href="http://dimplejs.org/"&gt;DimpleJS&lt;/a&gt; library, built on top of D3.  &lt;code&gt;dPyramid&lt;/code&gt; works in much the same way as the other functions, but has the added bonus of being able to take advantage of Dimple's &lt;code&gt;storyboard&lt;/code&gt; property, which facilitates the creation of temporal animations.  As such, &lt;code&gt;dPyramid&lt;/code&gt; accepts a vector of years for the &lt;code&gt;year&lt;/code&gt; parameter; if you choose multiple years instead of a single year, &lt;code&gt;dPyramid&lt;/code&gt; will give you a population pyramid that changes over time.  Here's an example that shows the aging of Germany's population between 2000 and 2050.  If you are new to R, the &lt;code&gt;seq&lt;/code&gt; function returns a sequence of numbers from argument 1 (in this case, the year 2000), to argument 2 (2050), in intervals of argument 3 (every 10 years).   &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;dPyramid&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;GM&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; seq&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;2000&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="m"&gt;2050&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="m"&gt;10&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; colors &lt;span class="o"&gt;=&lt;/span&gt; c&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;black&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;red&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;iframe src="http://walkerke.github.io/teaching-with-datavis/pyramids/germany.html" width="850" height="425" seamless scrolling="no" frameBorder = "0"&gt;&lt;/iframe&gt;

&lt;p&gt;The animation does a compelling job of showing how Germany's population is projected to both age and shrink in the years ahead.  Animation can also be used to provide demographic context to key historical circumstances I teach about in class.  For example, I covered the devastation wrought by the &lt;a href="http://www.aljazeera.com/indepth/features/2012/02/20122314155454169.html"&gt;Khmer Rouge&lt;/a&gt; during the Cambodian genocide, and used the animated population pyramid below to illustrate the demographic impacts of the genocide. The chart covers 1974 to 1982, the time just before, during, and in the years following the Khmer Rouge.  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;dPyramid&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;CB&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; seq&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;1974&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="m"&gt;1982&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;iframe src="http://walkerke.github.io/teaching-with-datavis/pyramids/cambodia.html" width="850" height="425" seamless scrolling="no" frameBorder = "0"&gt;&lt;/iframe&gt;

&lt;p&gt;You can see how the bars shrink between 1975 and 1979, the years when Cambodia was ruled by the Khmer Rouge.  I could see the shock on some of my students' faces when I showed this to them - many of them were unfamiliar with the history of Cambodia and the Khmer Rouge.  The visualization shows an overall decline in population of around 900,000 between 1974 and 1979, which reflects official population numbers; this likely underestimates the scale of the atrocities in Cambodia (&lt;a href="http://www.yale.edu/gsp/publications/KiernanRevised1.pdf"&gt;see the article linked here&lt;/a&gt;), as the actual losses may have been twice that.  &lt;/p&gt;
&lt;p&gt;To save any of your pyramids as a standalone HTML document, just assign your pyramid to a variable and use rCharts' &lt;code&gt;save&lt;/code&gt; option to save your chart, setting the &lt;code&gt;cdn&lt;/code&gt; parameter to &lt;code&gt;TRUE&lt;/code&gt;.  The code below provides an example of how to save the html file in your working directory.    &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;q1 &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; nPyramid&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;QA&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="m"&gt;2014&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; colors &lt;span class="o"&gt;=&lt;/span&gt; c&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;darkred&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;silver&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
q1&lt;span class="o"&gt;$&lt;/span&gt;save&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;qatar.html&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; cdn &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;hr /&gt;
&lt;p&gt;I've learned a lot about rCharts as I've put these together; my next post will cover how these charts are created.  In the meantime, have a look at the &lt;a href="https://github.com/walkerke/teaching-with-datavis/blob/master/pyramids/rcharts_pyramids.R"&gt;code on GitHub&lt;/a&gt;; you are welcome to use and modify it as you please.  I'd love to hear your comments or feedback; you can contact me at &lt;a href="&amp;#109;&amp;#97;&amp;#105;&amp;#108;&amp;#116;&amp;#111;&amp;#58;&amp;#107;&amp;#121;&amp;#108;&amp;#101;&amp;#46;&amp;#119;&amp;#97;&amp;#108;&amp;#107;&amp;#101;&amp;#114;&amp;#64;&amp;#116;&amp;#99;&amp;#117;&amp;#46;&amp;#101;&amp;#100;&amp;#117;"&gt;&amp;#107;&amp;#121;&amp;#108;&amp;#101;&amp;#46;&amp;#119;&amp;#97;&amp;#108;&amp;#107;&amp;#101;&amp;#114;&amp;#64;&amp;#116;&amp;#99;&amp;#117;&amp;#46;&amp;#101;&amp;#100;&amp;#117;&lt;/a&gt; or get in touch with me on &lt;a href="https://twitter.com/kyle_e_walker"&gt;Twitter&lt;/a&gt;.    &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Thanks to:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://twitter.com/ramnath_vaidya"&gt;Ramnath Vaidyanathan&lt;/a&gt;, &lt;a href="https://twitter.com/timelyportfolio"&gt;Timely Portfolio&lt;/a&gt;, and &lt;a href="https://twitter.com/jkiernander"&gt;John Kiernander&lt;/a&gt; for their incredible contributions that make this all possible - and for helping me out with some Dimple formatting issues;&lt;/li&gt;
&lt;li&gt;The authors of the NVD3, D3, and Highcharts JavaScript libraries;&lt;/li&gt;
&lt;li&gt;The US Census Bureau for making the International Data Base such a valuable resource.   &lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Kyle Walker</dc:creator><pubDate>Sat, 07 Jun 2014 00:00:00 -0500</pubDate><guid>tag:walkerke.github.io,2014-06-07:2014/06/rcharts-pyramids/</guid><category>R</category><category>rCharts</category><category>World Regional</category></item><item><title>Visualizing the economics of tourism in the Pacific with Plotly</title><link>http://walkerke.github.io/2014/05/tourism-plotly/</link><description>&lt;p&gt;Over the last month or so, I've been working a lot with &lt;a href="http://plot.ly"&gt;Plotly&lt;/a&gt; to visualize data for my World Regional Geography course.  Plotly is a web-based service that allows for the creation of interactive, D3-based visualizations that can be easily shared.  Visualizations are deployed and hosted on Plotly's servers, so the service requires a connection to the internet to work.  One of the great things about Plotly is that it has APIs for popular data programming languages like &lt;a href="http://plot.ly/r/"&gt;R&lt;/a&gt;, &lt;a href="http://plot.ly/python/"&gt;Python&lt;/a&gt;, and &lt;a href="http://plot.ly/julia/"&gt;Julia&lt;/a&gt;.  I really got hooked on Plotly, however, when I learned about &lt;code&gt;ggplotly&lt;/code&gt;, &lt;a href="http://ropensci.org/blog/2014/04/17/plotly/"&gt;which allows you to convert &lt;strong&gt;ggplot2&lt;/strong&gt; graphs in R to interactive Plotly charts with just a couple extra lines of code&lt;/a&gt;.   I'm going to go over an example of how I used &lt;code&gt;ggplotly&lt;/code&gt; to assist with a discussion of the economic significance of tourism in the Pacific.&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;In my final class of the semester, I focused on Oceania (defined as Australia, New Zealand, and Pacific Island nations).  In this class, I wanted to show students how small, relatively isolated countries in the Pacific can be acutely affected by larger global forces.  We focused on topics such as trash accumulation in the Pacific, sea level rise due to climate change, and the ways in which island countries are connected to the global economy.  As part of this, we discussed the role of tourism in Pacific Island economies.  To help illustrate this to my students, I sought out data on the tourist economies of these countries, which is freely available from the &lt;a href="http://www.wttc.org/research/economic-data-search-tool/"&gt;World Travel &amp;amp; Tourism Council's Economic Data Search Tool&lt;/a&gt;.  To download the data, I followed these steps: &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;For Step 1 of the search tool, I clicked &lt;strong&gt;Countries &amp;gt; Oceania&lt;/strong&gt;, then selected Fiji, Kiribati, Other Oceania, Solomon Islands, Tonga, and Vanuatu.  &lt;/li&gt;
&lt;li&gt;For Step 2, I selected "Travel &amp;amp; Tourism Total Contribution to GDP."  These figures include both tourism's direct contributions to GDP (e.g. GDP generated by hotels, airlines, etc.) and its indirect contributions to the economy; &lt;a href="http://www.wttc.org/site_media/uploads/downloads/oceania2014.pdf"&gt;see this report for more details&lt;/a&gt;.  &lt;/li&gt;
&lt;li&gt;For Step 3, I selected "% share" as my unit, as I was interested in the extent to which tourism figures in the overall constitution of these countries' economies.  &lt;/li&gt;
&lt;li&gt;I chose the entire date range from 1988 to 2024 (projected), and clicked &lt;strong&gt;Submit&lt;/strong&gt;.  &lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The data can then be downloaded as an Excel file.  However, the Excel file is formatted in a way that resembles the HTML on the web page, and as such is not in the "tidy" format that is required for visualization in ggplot2.  As such, I saved the file as a CSV (which is available from my GitHub repository) and imported the data into R for some cleaning.  &lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;The R code below shows one way to clean up data downloaded from the WTTC in this particular format (multiple countries, one variable).  I've written a function, &lt;code&gt;tidy_WTTC&lt;/code&gt;, that should work for any dataset in this form available from the WTTC.  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c1"&gt;# Load packages and data&lt;/span&gt;

library&lt;span class="p"&gt;(&lt;/span&gt;reshape2&lt;span class="p"&gt;)&lt;/span&gt;
library&lt;span class="p"&gt;(&lt;/span&gt;ggplot2&lt;span class="p"&gt;)&lt;/span&gt;
library&lt;span class="p"&gt;(&lt;/span&gt;plotly&lt;span class="p"&gt;)&lt;/span&gt;
library&lt;span class="p"&gt;(&lt;/span&gt;zoo&lt;span class="p"&gt;)&lt;/span&gt;

dat &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; read.csv&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;tourism.csv&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;## Define the &amp;quot;tidy&amp;quot; function and call it&lt;/span&gt;

tidy_WTTC &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kr"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;df&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;

  start &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; df&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="m"&gt;7&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
  end &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; df&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="m"&gt;7&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; ncol&lt;span class="p"&gt;(&lt;/span&gt;df&lt;span class="p"&gt;)]&lt;/span&gt;

  df &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; df&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="m"&gt;8&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;nrow&lt;span class="p"&gt;(&lt;/span&gt;df&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt;

  nms &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; c&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;country&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; paste0&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;y&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; seq&lt;span class="p"&gt;(&lt;/span&gt;start&lt;span class="p"&gt;,&lt;/span&gt; end&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;

  names&lt;span class="p"&gt;(&lt;/span&gt;df&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; nms

  df &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; na.locf&lt;span class="p"&gt;(&lt;/span&gt;df&lt;span class="p"&gt;,&lt;/span&gt; fromLast &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

  df &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; df&lt;span class="p"&gt;[&lt;/span&gt;seq&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; nrow&lt;span class="p"&gt;(&lt;/span&gt;df&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt;

  df.melt &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; melt&lt;span class="p"&gt;(&lt;/span&gt;df&lt;span class="p"&gt;,&lt;/span&gt; id.vars &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;country&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; value.name&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;value&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; variable.name &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;year&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

  df.melt&lt;span class="o"&gt;$&lt;/span&gt;year &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; as.numeric&lt;span class="p"&gt;(&lt;/span&gt;gsub&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;y&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; df.melt&lt;span class="o"&gt;$&lt;/span&gt;year&lt;span class="p"&gt;))&lt;/span&gt;

  df.melt&lt;span class="o"&gt;$&lt;/span&gt;value &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; as.numeric&lt;span class="p"&gt;(&lt;/span&gt;df.melt&lt;span class="o"&gt;$&lt;/span&gt;value&lt;span class="p"&gt;)&lt;/span&gt;

  df.melt
&lt;span class="p"&gt;}&lt;/span&gt;

tidy_dat &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; tidy_WTTC&lt;span class="p"&gt;(&lt;/span&gt;dat&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;A few notes about the above code.  To do anything with Plotly in R, it is necessary to use the &lt;strong&gt;plotly&lt;/strong&gt; R package, &lt;a href="https://github.com/ropensci/plotly"&gt;which is available from rOpenSci's repository on GitHub&lt;/a&gt;.  As such, it must be installed first using the &lt;strong&gt;devtools&lt;/strong&gt; package with the command &lt;code&gt;install_github("ropensci/plotly")&lt;/code&gt;.  &lt;/p&gt;
&lt;p&gt;I'd also like to explain the function in brief.  I've set it up to handle data downloads from the WTTC, provided that a) you've chosen a group of countries and one variable, and b) you've saved the Excel download as a CSV.  Given the structure of the WTTC data, the function will detect the years you've chosen for your download and re-format the data accordingly.  Next, I use the &lt;code&gt;na.locf&lt;/code&gt; function from the &lt;strong&gt;zoo&lt;/strong&gt; package to resolve the fact that country names are on one row in the original data file, with corresponding values on the next row; this fills in NAs with their correct values.  I then remove the unnecessary rows, and then reshape and reformat the data for visualization with &lt;strong&gt;ggplot2&lt;/strong&gt;.    &lt;/p&gt;
&lt;p&gt;The data are now ready for plotting with &lt;strong&gt;ggplot2&lt;/strong&gt;, and can then be converted to an interactive Plotly chart.  The code below shows how to get this done.  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c1"&gt;## Create the ggplot, initialize the plotly object, and convert the ggplot to plotly&lt;/span&gt;

t1 &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; ggplot&lt;span class="p"&gt;(&lt;/span&gt;tidy_dat&lt;span class="p"&gt;,&lt;/span&gt; aes&lt;span class="p"&gt;(&lt;/span&gt;x &lt;span class="o"&gt;=&lt;/span&gt; year&lt;span class="p"&gt;,&lt;/span&gt; y &lt;span class="o"&gt;=&lt;/span&gt; value&lt;span class="p"&gt;,&lt;/span&gt; color &lt;span class="o"&gt;=&lt;/span&gt; country&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; 
  geom_line&lt;span class="p"&gt;(&lt;/span&gt;size &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; 
  scale_color_brewer&lt;span class="p"&gt;(&lt;/span&gt;palette &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Set1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; 
  labs&lt;span class="p"&gt;(&lt;/span&gt;list&lt;span class="p"&gt;(&lt;/span&gt;x &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Year&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; 
            y &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Total contribution of tourism to GDP (percent)&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; 
            title &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Total contribution of tourism to GDP (percent), select Pacific Island countries.  Data source: WTTC&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

py &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; plotly&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;YOUR USERNAME HERE&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;YOUR API KEY HERE&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

py&lt;span class="o"&gt;$&lt;/span&gt;ggplotly&lt;span class="p"&gt;(&lt;/span&gt;t1&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The &lt;strong&gt;ggplot2&lt;/strong&gt; code is fairly straightforward; I'm making a basic line chart with minimal customization.  After creating the ggplot, the last two lines of code are all that are necessary to create an interactive chart with Plotly.  You will need to sign up for a Plotly account and get an API key to get this to work; fill in your own username and password where instructed to initialize the Plotly interface object, which I've called &lt;code&gt;py&lt;/code&gt;.  Finally, the &lt;code&gt;py$ggplotly(t1)&lt;/code&gt; command converts the ggplot &lt;code&gt;t1&lt;/code&gt; into an interactive chart, which should appear in your browser.  If everything has worked correctly, you'll get a chart that looks like the one below:  &lt;/p&gt;
&lt;p&gt;(If the iframe is not showing up properly, &lt;a href="http://plot.ly/~walkerke/52"&gt;click here&lt;/a&gt; to access the chart)&lt;/p&gt;
&lt;hr /&gt;
&lt;div class = "iframe container"&gt;
&lt;iframe src="https://plot.ly/~walkerke/52" id="igraph" width="850" height="600" seamless scrolling="no" frameBorder = "0"&gt;&lt;/iframe&gt;
&lt;/div&gt;

&lt;hr /&gt;
&lt;p&gt;I now have an interactive chart that contains a wealth of information about the tourist economies of select Pacific Island countries.  As the chart reveals, the economic significance of tourism figures differently from country to country in the Pacific.  In places like Vanuatu and Fiji, tourism is a large component of the local economy and is projected to increase in importance.  In contrast, tourism is less prominent in places like Tonga, which relies heavily on remittances from Tongans living abroad; this example is familiar to my students, &lt;a href="http://www.star-telegram.com/2013/12/31/5453055/in-euless-tongans-usher-in-the.html"&gt;as there is a large Tongan community living in cities very near to TCU&lt;/a&gt;.  &lt;/p&gt;
&lt;p&gt;By default, Plotly embeds several options for interacting with the chart.  The user can click and drag on the chart itself to zoom in to particular areas; with a time series chart, this can be useful if the user wants to highlight a particular period of time in the graph.  Additionally, tooltips appear on hover that give direct access to the data informing the chart.  More interactivity is also available from the icons in the upper-right-hand corner of the chart, allowing users to zoom, pan, and change the desired tooltip display (all data series, or one at a time).  &lt;/p&gt;
&lt;p&gt;Once the chart is published to your Plotly account, you can customize it even further using Plotly's web-based GUI.  In the above example, I moved the position of the legend manually using the GUI to maximize the space occupied by the data; you can also edit the chart's appearance, change the axis and chart titles, and add notes to the chart, among other options.  &lt;/p&gt;
&lt;p&gt;Using &lt;code&gt;ggplotly&lt;/code&gt; in this way has become a major part of my workflow in preparing interactive materials for my teaching.  Here are a sampling of other charts I've prepared in this way:  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://plot.ly/~walkerke/12"&gt;Total fertility rates in South Asia by country, 1960-2011&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://plot.ly/~walkerke/21"&gt;Past and future population of Japan (projected)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://plot.ly/~walkerke/30"&gt;GDP by country since 1970, major world economies&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;More examples can be found at &lt;a href="https://plot.ly/~walkerke"&gt;my Plotly page&lt;/a&gt;, and I'll be posting the code for these visualizations to GitHub.  While &lt;code&gt;ggplotly&lt;/code&gt; has worked great for me so far, it is still very early in development and only supports a limited number of chart types from &lt;strong&gt;ggplot2&lt;/strong&gt; (&lt;a href="http://aarongonzales.net/plotly_examples.html"&gt;see this post for details&lt;/a&gt;).  In turn, you'll need to use Plotly's APIs to create the unavailable chart types, which I have just started to work with.  This summer, I'm going to explore using Plotly as well using Python, &lt;a href="http://nbviewer.ipython.org/github/plotly/python-user-guide/blob/master/s00_homepage/s00_homepage.ipynb"&gt;which has a well-developed API&lt;/a&gt; and appears to work very well with the IPython Notebook.  &lt;/p&gt;
&lt;p&gt;As always, please contact me at &lt;a href="&amp;#109;&amp;#97;&amp;#105;&amp;#108;&amp;#116;&amp;#111;&amp;#58;&amp;#107;&amp;#121;&amp;#108;&amp;#101;&amp;#46;&amp;#119;&amp;#97;&amp;#108;&amp;#107;&amp;#101;&amp;#114;&amp;#64;&amp;#116;&amp;#99;&amp;#117;&amp;#46;&amp;#101;&amp;#100;&amp;#117;"&gt;&amp;#107;&amp;#121;&amp;#108;&amp;#101;&amp;#46;&amp;#119;&amp;#97;&amp;#108;&amp;#107;&amp;#101;&amp;#114;&amp;#64;&amp;#116;&amp;#99;&amp;#117;&amp;#46;&amp;#101;&amp;#100;&amp;#117;&lt;/a&gt; or get in touch with me on &lt;a href="https://twitter.com/kyle_e_walker"&gt;Twitter&lt;/a&gt; if you have any questions or feedback.  &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Thanks to:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://twitter.com/plotlygraphs"&gt;The Plotly team&lt;/a&gt; for their amazing work;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://twitter.com/WTTC"&gt;The World Travel and Tourism Council&lt;/a&gt; for generously making their data publicly available.  &lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Kyle Walker</dc:creator><pubDate>Mon, 12 May 2014 00:00:00 -0500</pubDate><guid>tag:walkerke.github.io,2014-05-12:2014/05/tourism-plotly/</guid><category>R</category><category>Plotly</category><category>World Regional</category></item><item><title>Visualizing fertility trends in Europe</title><link>http://walkerke.github.io/2014/03/tfr-in-europe/</link><description>&lt;p&gt;In the classroom, interactive data visualizations can embed a wealth of information that can be interactively queried by the instructor depending on the course topics and students' questions.  The example I'll discuss below worked for me exactly in this way.  I'll show how to create an interactive chart using the World Bank's open data API; my example looks at fertility trends in European countries since 1960.  &lt;/p&gt;
&lt;p&gt;&lt;a href="http://data.worldbank.org/"&gt;The World Bank's Open Data catalog&lt;/a&gt; is a tremendous resource for any instructor addressing global issues; the website itself has readily-available data and charts for view.  Additionally, the World Bank makes these datasets available to developers via their API, &lt;a href="https://blogs.worldbank.org/opendata/accessing-world-bank-data-apis-python-r-ruby-stata"&gt;which can in turn be accessed through modules in Python, R, Ruby, and Stata&lt;/a&gt;.    In R, the API is available through the &lt;a href="https://github.com/vincentarelbundock/WDI"&gt;WDI&lt;/a&gt; package by Vincent Arel-Bundock, which makes it very simple for users to quickly access formatted World Bank datasets.  With the &lt;a href="https://github.com/ramnathv/rCharts"&gt;rCharts&lt;/a&gt; package, R users can then create dynamic D3 visualizations using these data.  &lt;/p&gt;
&lt;p&gt;In my World Regional Geography course at TCU, I spent a class period discussing demographic shifts in Europe, with a focus on fertility declines and aging populations in various parts of the continent.  My goal was to create a visualization that would allow me to interactively explore how fertility has declined in different ways in in different regions, and then discuss with my students the reasons why we observe these variations.  To get started, I called the World Bank API in R with the WDI package to give me the total fertility rates (the number of children a woman in a population would be expected to have in her lifetime given current age-specific fertility rates) for selected European countries by year since 1960.  The code below shows how to do this: &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;library&lt;span class="p"&gt;(&lt;/span&gt;WDI&lt;span class="p"&gt;)&lt;/span&gt;
library&lt;span class="p"&gt;(&lt;/span&gt;rCharts&lt;span class="p"&gt;)&lt;/span&gt;
library&lt;span class="p"&gt;(&lt;/span&gt;plyr&lt;span class="p"&gt;)&lt;/span&gt;

countries &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; c&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;AL&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;AT&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;BE&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;BA&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;BG&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;HR&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;CZ&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;DK&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;FI&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;FR&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;DE&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;GR&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; 
               &lt;span class="s"&gt;&amp;quot;HU&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;IS&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;IE&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;IT&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;NL&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;NO&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;PL&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;PT&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;RO&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;RS&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;SK&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;SI&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; 
               &lt;span class="s"&gt;&amp;quot;ES&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;SE&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;CH&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;GB&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

tfr &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; WDI&lt;span class="p"&gt;(&lt;/span&gt;country &lt;span class="o"&gt;=&lt;/span&gt; countries&lt;span class="p"&gt;,&lt;/span&gt; indicator &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;SP.DYN.TFRT.IN&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; start &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;1960&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; end &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;2011&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;A couple notes about the above code.  The WDI package asks for a vector of ISO-2 country codes for which it will fetch data; you can get those from many places, such as &lt;a href="http://en.wikipedia.org/wiki/ISO_3166-1_alpha-2"&gt;this Wikipedia page&lt;/a&gt;.  The &lt;code&gt;WDI&lt;/code&gt; function also requires the World Bank's code for your indicator of interest; you can use the &lt;code&gt;WDIsearch&lt;/code&gt; function in R to look for indicator codes, or simply look them up on the World Bank's website.  I've selected the code for the total fertility rate (TFR), and asked the function to give me data from 1960 to 2011 (the last year that TFR data are available).   I now have an R data frame, &lt;code&gt;tfr&lt;/code&gt;, that includes a time series of total fertility rates since 1960 for each country I asked for.  &lt;/p&gt;
&lt;p&gt;To visualize the data, I have selected the &lt;a href="http://nvd3.org/"&gt;NVD3 library&lt;/a&gt;, which is a D3 charting library that is available to R users through rCharts.  The code below will clean the data slightly for visualization, and call rCharts' &lt;code&gt;nPlot&lt;/code&gt; function to create an interactive chart.  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c1"&gt;#Clean up the data a bit&lt;/span&gt;
tfr &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; rename&lt;span class="p"&gt;(&lt;/span&gt;tfr&lt;span class="p"&gt;,&lt;/span&gt; replace &lt;span class="o"&gt;=&lt;/span&gt; c&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;SP.DYN.TFRT.IN&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;TFR&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

tfr&lt;span class="o"&gt;$&lt;/span&gt;TFR &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; round&lt;span class="p"&gt;(&lt;/span&gt;tfr&lt;span class="o"&gt;$&lt;/span&gt;TFR&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# Create the chart&lt;/span&gt;
tfrPlot &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; nPlot&lt;span class="p"&gt;(&lt;/span&gt;
  TFR &lt;span class="o"&gt;~&lt;/span&gt; year&lt;span class="p"&gt;,&lt;/span&gt; 
  data &lt;span class="o"&gt;=&lt;/span&gt; tfr&lt;span class="p"&gt;,&lt;/span&gt; 
  group &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;country&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  type &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;lineChart&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# Add axis labels and format the tooltip&lt;/span&gt;
tfrPlot&lt;span class="o"&gt;$&lt;/span&gt;yAxis&lt;span class="p"&gt;(&lt;/span&gt;axisLabel &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Total fertility rate&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; width &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;62&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

tfrPlot&lt;span class="o"&gt;$&lt;/span&gt;xAxis&lt;span class="p"&gt;(&lt;/span&gt;axisLabel &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Year&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

tfrPlot&lt;span class="o"&gt;$&lt;/span&gt;chart&lt;span class="p"&gt;(&lt;/span&gt;tooltipContent &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;#! function(key, x, y){&lt;/span&gt;
&lt;span class="s"&gt;        return &amp;#39;&amp;lt;h3&amp;gt;&amp;#39; + key + &amp;#39;&amp;lt;/h3&amp;gt;&amp;#39; + &lt;/span&gt;
&lt;span class="s"&gt;        &amp;#39;&amp;lt;p&amp;gt;&amp;#39; + y + &amp;#39; in &amp;#39; + x + &amp;#39;&amp;lt;/p&amp;gt;&amp;#39;&lt;/span&gt;
&lt;span class="s"&gt;        } !#&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Typing &lt;code&gt;tfrPlot&lt;/code&gt; in the console produces the graphic below:&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;iframe src="http://walkerke.github.io/teaching-with-datavis/plots/tfrplot.html" width="825" height="450" seamless frameBorder = "0"&gt;&lt;/iframe&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;The chart shows an overall decline in fertility in Europe since 1960; however, beyond that, it is a mess of information.  You can get tooltips on hover that allow you to discern some things that are going on, but it is really difficult to make out any particular country.  This is where NVD3 and rCharts really shine, however.  The chart's legend is interactive; you can click the bubble next to each country's name to turn off and on its line.  Further, if you double-click a country, the chart will reveal the line for that country only.  In turn, the chart functions as an application that the user can modify as she or he wishes.  For example, I used this chart to explore differences between fertility levels in Scandinavia and Southern Europe with a few clicks, as seen in the example below:&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;iframe src="http://walkerke.github.io/teaching-with-datavis/plots/selected.html" width="825" height="450" seamless frameBorder = "0"&gt;&lt;/iframe&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;In class, we interactively explored comparisons between countries all over Europe, discussing the varying roles of social programs, cultural differences, economic well-being, etc. in influencing the type of gaps like those observed in the chart above.  &lt;/p&gt;
&lt;p&gt;Additionally, rCharts includes options for specifying the type of chart you want to show in advance.  For example, I discussed in class the specific case of Romania, which during the &lt;a href="http://en.wikipedia.org/wiki/Nicolae_Ceausescu"&gt;Ceausescu era&lt;/a&gt; pursued severe pro-natalist policies that influenced sharp fluctuations in the country's TFR, and had lasting negative impacts on the health of Romanian women.  The code below modifies the chart's options to show only Romania.  To do this, I created a vector of unique country codes in their sorted order in my &lt;code&gt;tfr&lt;/code&gt; data frame, then created a boolean vector in which only the position representing Romania was set to false.  I can then pass this vector as a parameter in my chart's options, telling it to disable all lines except Romania.  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;ids &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; unique&lt;span class="p"&gt;(&lt;/span&gt;tfr&lt;span class="o"&gt;$&lt;/span&gt;iso2c&lt;span class="p"&gt;)&lt;/span&gt;

rom &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; as.logical&lt;span class="p"&gt;(&lt;/span&gt;ids &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;RO&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

tfrPlot&lt;span class="o"&gt;$&lt;/span&gt;set&lt;span class="p"&gt;(&lt;/span&gt;disabled &lt;span class="o"&gt;=&lt;/span&gt; rom&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Below, you can see the result. Note the huge jump in fertility between 1966 and 1967, which was in part the result of strong restrictions on abortion and contraception in the country.  Shortly thereafter, however, fertility rates fell once again; the slight bump in the 1980s was due to additional government influence in child-bearing, which in part included government monitoring of women to ensure that they were carrying pregnancies to term. Since the fall of the Ceausescu regime, the fertility rate plummeted to what is now one of the lowest in the world.  &lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;iframe src="http://walkerke.github.io/teaching-with-datavis/plots/romaniaplot.html" width="825" height="450" seamless frameBorder = "0"&gt;&lt;/iframe&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;For me, this example shows the power of interactive data visualization in the classroom.  Instead of a series of pre-made charts that I had chosen in advance of my lecture, my students were able to choose countries they were interested in looking at, allowing me to build a more interactive classroom experience.  &lt;/p&gt;
&lt;p&gt;I should mention as well that I display these charts in class using &lt;a href="https://github.com/ramnathv/slidify"&gt;slidify&lt;/a&gt;, which is an R package for creating HTML5 presentations from Markdown.  Its author, Ramnath Vaidyanathan, is also the author of rCharts; as such, slidify and rCharts play very nicely together.  I'll likely discuss my experiences with slidify in a future post, as I am using it now to produce all my lecture materials.  &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;To create the fertility chart on your computer, follow these steps:&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Be sure that you have the following R packages installed: &lt;strong&gt;WDI&lt;/strong&gt;, &lt;strong&gt;plyr&lt;/strong&gt;, and &lt;strong&gt;rCharts&lt;/strong&gt;.  rCharts is not yet on CRAN, so you'll need to install it from GitHub with the &lt;strong&gt;devtools&lt;/strong&gt; package.  I use the &lt;code&gt;dev&lt;/code&gt; branch of rCharts, which has the latest updates; you can install this with the command, &lt;code&gt;devtools::install_github('rCharts', 'ramnathv', ref='dev')&lt;/code&gt;.  &lt;/li&gt;
&lt;li&gt;Run the following command: &lt;code&gt;source("https://raw.github.com/walkerke/teaching-with-datavis/master/tfr-in-europe.R")&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Type &lt;code&gt;tfrPlot&lt;/code&gt; in the R console to create your chart!  Just a quick note: I have trouble showing NVD3 charts in the RStudio viewer, so you may need to open the chart in your web browser of choice to view it.  &lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The code is available on GitHub; use it as you please (though I'd love to hear how you are adapting/modifying it if you do).    &lt;/p&gt;
&lt;p&gt;To contact me, email me at &lt;a href="&amp;#109;&amp;#97;&amp;#105;&amp;#108;&amp;#116;&amp;#111;&amp;#58;&amp;#107;&amp;#121;&amp;#108;&amp;#101;&amp;#46;&amp;#119;&amp;#97;&amp;#108;&amp;#107;&amp;#101;&amp;#114;&amp;#64;&amp;#116;&amp;#99;&amp;#117;&amp;#46;&amp;#101;&amp;#100;&amp;#117;"&gt;&amp;#107;&amp;#121;&amp;#108;&amp;#101;&amp;#46;&amp;#119;&amp;#97;&amp;#108;&amp;#107;&amp;#101;&amp;#114;&amp;#64;&amp;#116;&amp;#99;&amp;#117;&amp;#46;&amp;#101;&amp;#100;&amp;#117;&lt;/a&gt;, or connect with me on &lt;a href="https://twitter.com/kyle_e_walker"&gt;Twitter&lt;/a&gt;.  &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Thanks to:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://data.worldbank.org/"&gt;The World Bank&lt;/a&gt; for generously making their data publicly available;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://twitter.com/ramnath_vaidya"&gt;Ramnath Vaidyanathan&lt;/a&gt; and &lt;a href="https://twitter.com/timelyportfolio"&gt;Timely Portfolio&lt;/a&gt; for the amazing rCharts;&lt;/li&gt;
&lt;li&gt;Vincent Arel-Bundock for creating the WDI package;&lt;/li&gt;
&lt;li&gt;The developers of NVD3 and d3.js for their innovations in data visualization.  &lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Kyle Walker</dc:creator><pubDate>Thu, 06 Mar 2014 00:00:00 -0600</pubDate><guid>tag:walkerke.github.io,2014-03-06:2014/03/tfr-in-europe/</guid><category>R</category><category>rCharts</category><category>World Regional</category></item><item><title>Visualizing the U.S. Hispanic population by state</title><link>http://walkerke.github.io/2014/01/hispanic-pop-by-state/</link><description>&lt;p&gt;Welcome!  This is the first post of my effort to document my foray into developing interactive data visualizations for use in my teaching.  Hopefully these examples will be of use to some readers who are interested in creating their own visualizations.  &lt;/p&gt;
&lt;p&gt;I'll first provide a bit of background.  I'm a geography professor at Texas Christian University in Fort Worth, and started getting interested in data visualization when putting together materials for a course I taught in population geography last spring.  Visuals are essential for social science instructors; however, it is not always easy to find publicly available images that are both effective and suitable for what you want to teach (I imagine many of you, like me, have gone on many a failed Google image search).  So, I started looking into developing my own materials.  I happened upon the incredible &lt;a href="http://d3js.org/"&gt;D3 JavaScript library&lt;/a&gt; by Mike Bostock and the stunning graphics from the &lt;a href="http://www.healthmetricsandevaluation.org/tools/data-visualizations"&gt;Institute for Health Metrics and Evaluation&lt;/a&gt; and was immediately blown away.  Interactive examples like &lt;a href="http://bl.ocks.org/mbostock/4062085"&gt;this population pyramid&lt;/a&gt; can be very effective for conveying social science concepts.  &lt;/p&gt;
&lt;p&gt;As a relative newcomer to JavaScript, however, I looked into what other resources were available for creating these types of interactive visualizations, especially in languages I have more of a familiarity with (R and Python, specifically).  Thus far, I've been using the fantastic &lt;a href="http://rcharts.io/"&gt;rCharts&lt;/a&gt; R package by Ramnath Vaidyanathan, which provides an R wrapper for several JavaScript charting libraries, and the the &lt;a href="http://cran.r-project.org/web/packages/googleVis/index.html"&gt;googleVis&lt;/a&gt; package, which is an R interface for the Google Charts API, and among other things allows R users to create &lt;a href="http://www.gapminder.org/"&gt;Hans Rosling-style motion charts.&lt;/a&gt;.  I've also started looking into tools like &lt;a href="https://plot.ly/"&gt;plotly&lt;/a&gt;, which has both R and Python APIs, and hope to create my own D3 visualizations from scratch eventually.  &lt;/p&gt;
&lt;p&gt;When possible, my examples on this site will use open data/open source tools and will be available on GitHub, so that anyone interested can use and adapt these examples as they need.  &lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;My first example is a visualization of the composition of Hispanic populations by state in the U.S., for the ten states with the largest Hispanic populations in 2010.   In my introductory geography course, I'm going to be soon discussing shifts in the racial &amp;amp; ethnic composition of the U.S.  Sometime between 2040 and 2050, non-Hispanic whites are projected to become a minority in the U.S., in large part due to continued growth of the Hispanic population.  However, I find that many discussions of this demographic shift in the media tend to homogenize the Hispanic population, which is not what I want to convey to my students; as such, I wanted to find a way to visualize its diversity.  I came across &lt;a href="http://www.pewhispanic.org/2012/09/06/population-distribution-of-hispanic-origin-groups-by-county/"&gt;these interesting interactive maps from the Pew Research Center&lt;/a&gt;, and downloaded the data they made available to see what I might do with it.  &lt;/p&gt;
&lt;p&gt;The data made available by the Pew Research Center are in Excel format.  There are many libraries for reading Excel data into R, but they often are not straightforward to use, so I first opened the file in Excel and saved it as a CSV for ease of use.  In their original form, the data are not in a great format for visualization in R; as such, I needed to do some munging, with help from Hadley Wickham's excellent packages.  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c1"&gt;# First, download the Excel file from the Pew Research Center, and save it as a CSV in your working directory&lt;/span&gt;

library&lt;span class="p"&gt;(&lt;/span&gt;stringr&lt;span class="p"&gt;)&lt;/span&gt;
library&lt;span class="p"&gt;(&lt;/span&gt;plyr&lt;span class="p"&gt;)&lt;/span&gt;
library&lt;span class="p"&gt;(&lt;/span&gt;rCharts&lt;span class="p"&gt;)&lt;/span&gt;
library&lt;span class="p"&gt;(&lt;/span&gt;reshape2&lt;span class="p"&gt;)&lt;/span&gt;

dat &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; read.csv&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;all_counties_by_top_six_groups.csv&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

keep &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; seq&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="m"&gt;25&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="m"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

dat &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; dat&lt;span class="p"&gt;[,&lt;/span&gt;keep&lt;span class="p"&gt;]&lt;/span&gt;

nms &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; c&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Name&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Total.Hisp&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Mexican&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Puerto.Rican&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Cuban&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Salvadoran&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Dominican&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Guatemalan&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Other&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

names&lt;span class="p"&gt;(&lt;/span&gt;dat&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; nms

dat &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; dat&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;c&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="m"&gt;3&lt;/span&gt;&lt;span class="p"&gt;),]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The above code simply cleans up the data to shape it into a nicely formatted data frame, and subsets it to get the population counts that we need.  However, there are still some steps to take before the data can be visualized.  Given the original data format, R has read in all my numeric data as factors, which wouldn't let me make the kinds of manipulations I needed to do to aggregate the data by state.  Such aggregation also required some string manipulation, so that I could identify which counts correspond to each state (given that the geographic identifiers in the data are presented as 'County, State').  The code that follows cleans up the data even further and aggregates each numeric column by state.  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;dat &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; cbind&lt;span class="p"&gt;(&lt;/span&gt;dat&lt;span class="p"&gt;,&lt;/span&gt; ldply&lt;span class="p"&gt;(&lt;/span&gt;str_split&lt;span class="p"&gt;(&lt;/span&gt;dat&lt;span class="o"&gt;$&lt;/span&gt;Name&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;, &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;

names&lt;span class="p"&gt;(&lt;/span&gt;dat&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; c&lt;span class="p"&gt;(&lt;/span&gt;nms&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;County&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;State&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

convCols &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="m"&gt;9&lt;/span&gt;

dat&lt;span class="p"&gt;[,&lt;/span&gt;convCols&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; apply&lt;span class="p"&gt;(&lt;/span&gt;dat&lt;span class="p"&gt;[,&lt;/span&gt;convCols&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kr"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;x&lt;span class="p"&gt;)&lt;/span&gt; as.numeric&lt;span class="p"&gt;(&lt;/span&gt;as.character&lt;span class="p"&gt;(&lt;/span&gt;gsub&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;,&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; x&lt;span class="p"&gt;))))&lt;/span&gt;

sums &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; ddply&lt;span class="p"&gt;(&lt;/span&gt;dat&lt;span class="p"&gt;,&lt;/span&gt; .&lt;span class="p"&gt;(&lt;/span&gt;State&lt;span class="p"&gt;),&lt;/span&gt; numcolwise&lt;span class="p"&gt;(&lt;/span&gt;sum&lt;span class="p"&gt;))&lt;/span&gt;

sorteddf &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; sums&lt;span class="p"&gt;[&lt;/span&gt;order&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;sums&lt;span class="o"&gt;$&lt;/span&gt;Total.Hisp&lt;span class="p"&gt;),][&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="m"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;I've now identified the 10 states with the largest Hispanic populations, and aggregated the different ancestry columns by state.  I now needed to decide how to visualize these data.  I elected to use the &lt;a href="http://dimplejs.org/"&gt;dimple&lt;/a&gt; D3 library, which is available through rCharts.  My hope was to create something like &lt;a href="http://dimplejs.org/examples_viewer.html?id=bars_horizontal_stacked_100pct"&gt;this horizontal 100% chart&lt;/a&gt;, which would allow direct comparison of the Hispanic population composition of these states.  Fortunately, rCharts makes this straightforward.  I first created a new data frame that held percentages instead of raw counts, reshaped it into a suitable format, and called rCharts' &lt;code&gt;dPlot&lt;/code&gt; function to create the chart.  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;newdf &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; data.frame&lt;span class="p"&gt;(&lt;/span&gt;sorteddf&lt;span class="o"&gt;$&lt;/span&gt;State&lt;span class="p"&gt;)&lt;/span&gt;

vals &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; c&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Mexican&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Puerto.Rican&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Cuban&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Salvadoran&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Dominican&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Guatemalan&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Other&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="kr"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;v &lt;span class="kr"&gt;in&lt;/span&gt; vals&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  newdf&lt;span class="p"&gt;[[&lt;/span&gt;v&lt;span class="p"&gt;]]&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; round&lt;span class="p"&gt;(((&lt;/span&gt;sorteddf&lt;span class="p"&gt;[[&lt;/span&gt;v&lt;span class="p"&gt;]]&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; sorteddf&lt;span class="o"&gt;$&lt;/span&gt;Total.Hisp&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="m"&gt;100&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

names&lt;span class="p"&gt;(&lt;/span&gt;newdf&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; c&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;State&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; vals&lt;span class="p"&gt;)&lt;/span&gt;

df.melt &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; melt&lt;span class="p"&gt;(&lt;/span&gt;newdf&lt;span class="p"&gt;,&lt;/span&gt; variable.name &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Ancestry&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; value.name &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Share&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

d1 &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; dPlot&lt;span class="p"&gt;(&lt;/span&gt;
  x &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Share&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; 
  y &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;State&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; 
  groups &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Ancestry&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; 
  data &lt;span class="o"&gt;=&lt;/span&gt; df.melt&lt;span class="p"&gt;,&lt;/span&gt; 
  type &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;bar&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;#Here, set the chart options to tell rCharts how to format the visualization  &lt;/span&gt;
d1&lt;span class="o"&gt;$&lt;/span&gt;xAxis&lt;span class="p"&gt;(&lt;/span&gt;type &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;addPctAxis&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
d1&lt;span class="o"&gt;$&lt;/span&gt;yAxis&lt;span class="p"&gt;(&lt;/span&gt;type &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;addCategoryAxis&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; orderRule &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;State&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

d1&lt;span class="o"&gt;$&lt;/span&gt;legend&lt;span class="p"&gt;(&lt;/span&gt; x &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;60&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; y &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; width &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;700&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; height &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;20&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; horizontalAlign &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;left&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; orderRule &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Ancestry&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Below, you can see the result: &lt;/p&gt;
&lt;hr /&gt;
&lt;h2&gt;&lt;iframe src="http://bl.ocks.org/walkerke/raw/8300770/" width="825" height="450" seamless frameBorder = "0"&gt;&lt;/iframe&gt;&lt;/h2&gt;
&lt;p&gt;The plot has accomplished what I hoped - displaying the considerable diversity of the Hispanic population across different states in the U.S.  The key here to the chart is the interactivity; while I could have produced a static visualization just like this, each component of the chart provides a tooltip on hover that gives specific information about its content.  I now have a more interactive document that I can explore with my students.  &lt;/p&gt;
&lt;p&gt;As the chart reveals, Hispanics are generally of Mexican origin in several states, including my state of Texas, where 84% of Hispanics are of Mexican ancestry; this will be the frame of reference for my students.  However, I can show students how in other parts of the country, such as my old home of New York, 'Hispanic' means something very different, as individuals of Mexican heritage only make up 13% of the state's Hispanic population.  It is also interesting to see how the 'Other' category varies by state.  In some states (New York, New Jersey, New Mexico, Florida), this category is very large.  The &lt;a href="http://www.pewhispanic.org/files/2012/06/The-10-Largest-Hispanic-Origin-Groups.pdf"&gt;Pew Center report provides some additional information on this&lt;/a&gt;; for example, many Colombians, Hondurans, and Peruvians live in the Miami area, and Queens, NYC has a large Ecuadorian population.  In New Mexico, the data reflect the Spanish and Native American heritage of many Hispanics in the state.  &lt;/p&gt;
&lt;p&gt;There are still some improvements that could be made; for example, in some browsers, the y-axis title is partially hidden, which I need to look into further.  Also, in order to get the effects to work correctly, I had to modify the version of Dimple in the HTML to point to version 1.1.3 (rCharts is still on 1.1.1).  &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;To create this chart on your computer, follow these steps:&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Visit the &lt;a href="http://www.pewhispanic.org/2012/09/06/population-distribution-of-hispanic-origin-groups-by-county/"&gt;Pew Research Center site&lt;/a&gt;, download the Excel file they make available, and save it as a CSV in your working directory (don't change the name, just the type).  &lt;/li&gt;
&lt;li&gt;Be sure that you have the following R packages installed: &lt;code&gt;stringr&lt;/code&gt;, &lt;code&gt;plyr&lt;/code&gt;, &lt;code&gt;rCharts&lt;/code&gt;, and &lt;code&gt;reshape2&lt;/code&gt;.  &lt;code&gt;rCharts&lt;/code&gt; is not yet on CRAN, so you'll need to install it from GitHub with the &lt;code&gt;devtools&lt;/code&gt; package.  I use the &lt;code&gt;dev&lt;/code&gt; branch of rCharts, which has the latest updates; you can install this with the command, &lt;code&gt;devtools::install_github('rCharts', 'ramnathv', ref='dev')&lt;/code&gt;.  &lt;/li&gt;
&lt;li&gt;Run the following command: &lt;code&gt;source("https://raw.github.com/walkerke/teaching-with-datavis/master/hispanics-by-state.R")&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Type &lt;code&gt;d1&lt;/code&gt; in your console, and you'll have your chart!&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Alternatively, feel free to grab the code from GitHub and modify it as you wish.  &lt;/p&gt;
&lt;p&gt;I'd love to hear your feedback; you can send me an email at &lt;a href="&amp;#109;&amp;#97;&amp;#105;&amp;#108;&amp;#116;&amp;#111;&amp;#58;&amp;#107;&amp;#121;&amp;#108;&amp;#101;&amp;#46;&amp;#119;&amp;#97;&amp;#108;&amp;#107;&amp;#101;&amp;#114;&amp;#64;&amp;#116;&amp;#99;&amp;#117;&amp;#46;&amp;#101;&amp;#100;&amp;#117;"&gt;&amp;#107;&amp;#121;&amp;#108;&amp;#101;&amp;#46;&amp;#119;&amp;#97;&amp;#108;&amp;#107;&amp;#101;&amp;#114;&amp;#64;&amp;#116;&amp;#99;&amp;#117;&amp;#46;&amp;#101;&amp;#100;&amp;#117;&lt;/a&gt;, or connect with me on &lt;a href="https://twitter.com/kyle_e_walker"&gt;Twitter&lt;/a&gt;.  &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Thanks to:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://www.pewhispanic.org/"&gt;The Pew Research Center's Hispanic Trends Project&lt;/a&gt; for making their data publicly available;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://twitter.com/ramnath_vaidya"&gt;Ramnath Vaidyanathan&lt;/a&gt; and &lt;a href="https://twitter.com/timelyportfolio"&gt;Timely Portfolio&lt;/a&gt; for their efforts and tutorials on rCharts;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://twitter.com/jkiernander"&gt;John Kiernander&lt;/a&gt; for the DimpleJS library;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://twitter.com/hadleywickham"&gt;Hadley Wickham&lt;/a&gt; and the &lt;a href="https://twitter.com/rstudioapp"&gt;RStudio team&lt;/a&gt; for making R a much better place to work with data.  &lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Kyle Walker</dc:creator><pubDate>Thu, 09 Jan 2014 00:00:00 -0600</pubDate><guid>tag:walkerke.github.io,2014-01-09:2014/01/hispanic-pop-by-state/</guid><category>R</category><category>rCharts</category><category>World Regional</category></item></channel></rss>