<!DOCTYPE html>
<html lang="en_us.utf-8 pelican">
<head>
    <meta charset="utf-8">
    <title>Teaching with Interactive Data Visualization</title>
    <meta name="description" content="">
    <meta name="author" content="Kyle Walker">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://walkerke.github.io/theme/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="http://walkerke.github.io/theme/bootstrap.min.css" rel="stylesheet">
    <link href="http://walkerke.github.io/theme/bootstrap.min.responsive.css" rel="stylesheet">
    <link href="http://walkerke.github.io/theme/local.css" rel="stylesheet">
    <link href="http://walkerke.github.io/theme/pygments.css" rel="stylesheet">

</head>

<body>

<div class="navbar">
    <div class="navbar-inner">
    <div class="container">

         <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
         </a>

        <a class="brand" href="http://walkerke.github.io">Teaching with Interactive Data Visualization</a>

        <div class="nav-collapse">
        <ul class="nav">
            
            <li><a href="http://walkerke.github.io/about/">About</a></li>
            <li><a href="http://walkerke.github.io/rpydocs/">RPubs/IPython Notebooks</a></li>
        </ul>
        </div>
        
    </div>
    </div>
</div>

<div class="container">
    <div class="content">
    <div class="row">

        <div class="span9">
    <div class='article'>
        <div class="content-title">
            <h1>Life expectancy trends in the former USSR</h1>
Thu 16 October 2014

by <a class="url fn" href="http://walkerke.github.io/author/kyle-walker.html">Kyle Walker</a>
 


<a href="http://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="kyle_e_walker">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
        </div>
	
        <div><p>When covering Russia and the former constitutent republics of the USSR in World Regional Geography, a key part of my material addresses the issues that some of these countries have had in their transitions from centralized to market economies.  Some of these countries experienced dramatic demographic shifts after the dissolution of the USSR, including a noticeable decline in life expectancy.</p>
<p>I'd been using some static Excel charts to illustrate life expectancy declines in Russia, Belarus, and Ukraine in previous courses.  However, I felt that an interactive solution would be preferable so that my students and I could explore the data in class over the course of our discussion.  I opted for <a href="http://www.highcharts.com/">Highcharts</a>, through R and <a href="http://rcharts.io">rCharts</a>, for the interactivity.  I then turned to <a href="http://shiny.rstudio.com/">Shiny</a> from <a href="http://www.rstudio.com/">RStudio</a> to put everything together.  </p>
<p>Shiny is a framework that allows R users to turn analyses and visualizations into interactive applications.  Shiny can be run locally on your computer, or deployed to the web via the <a href="https://www.shinyapps.io/">ShinyApps.io</a> hosting service, which is currently free.  The beauty of Shiny is that it allows you to explore your data interactively with a friendly web-based user interface without writing any JavaScript, and it lets R users create and deploy apps to be shared with non-R users who may nonetheless be interested in exploring a dataset or visualization. <a href="http://shiny.rstudio.com/gallery/">You can see RStudio's gallery of examples here.</a></p>
<p>To get started, I acquired data from <a href="http://www.mortality.org/">The Human Mortality Database</a>, (HMD) a project of UC Berkeley and the Max Planck Institute.  The HMD prefers that users not re-distribute the data, so if you'd like to reproduce this chart, you'll need to download the data yourself.  However, the service is free (with registration) and relatively simple to use.  The HMD provides mortality data for 37 countries, including Russia, Belarus, and Ukraine. From the HMD, I downloaded the 1-year life expectancy at birth tables for these countries, and saved them to my working directory as delimited text files, naming them accordingly.  Once I did this, I used the code below to process the data into a suitable format for visualization.  </p>
<div class="highlight"><pre>library<span class="p">(</span>tidyr<span class="p">)</span>
library<span class="p">(</span>dplyr<span class="p">)</span>

russia <span class="o">&lt;-</span> read.table<span class="p">(</span><span class="s">&#39;russia.txt&#39;</span><span class="p">,</span> skip <span class="o">=</span> <span class="m">3</span><span class="p">)</span>

names<span class="p">(</span>russia<span class="p">)</span> <span class="o">&lt;-</span> c<span class="p">(</span><span class="s">&quot;Year&quot;</span><span class="p">,</span> <span class="s">&quot;Female&quot;</span><span class="p">,</span> <span class="s">&quot;Male&quot;</span><span class="p">,</span> <span class="s">&quot;Total&quot;</span><span class="p">)</span>

russia<span class="o">$</span>country <span class="o">&lt;-</span> <span class="s">&quot;Russia&quot;</span>

ukraine <span class="o">&lt;-</span> read.table<span class="p">(</span><span class="s">&#39;ukraine.txt&#39;</span><span class="p">,</span> skip <span class="o">=</span> <span class="m">3</span><span class="p">)</span>

names<span class="p">(</span>ukraine<span class="p">)</span> <span class="o">&lt;-</span> c<span class="p">(</span><span class="s">&quot;Year&quot;</span><span class="p">,</span> <span class="s">&quot;Female&quot;</span><span class="p">,</span> <span class="s">&quot;Male&quot;</span><span class="p">,</span> <span class="s">&quot;Total&quot;</span><span class="p">)</span>

ukraine<span class="o">$</span>country <span class="o">&lt;-</span> <span class="s">&quot;Ukraine&quot;</span>

belarus <span class="o">&lt;-</span> read.table<span class="p">(</span><span class="s">&#39;belarus.txt&#39;</span><span class="p">,</span> skip <span class="o">=</span> <span class="m">3</span><span class="p">)</span>

names<span class="p">(</span>belarus<span class="p">)</span> <span class="o">&lt;-</span> c<span class="p">(</span><span class="s">&quot;Year&quot;</span><span class="p">,</span> <span class="s">&quot;Female&quot;</span><span class="p">,</span> <span class="s">&quot;Male&quot;</span><span class="p">,</span> <span class="s">&quot;Total&quot;</span><span class="p">)</span>

belarus<span class="o">$</span>country <span class="o">&lt;-</span> <span class="s">&quot;Belarus&quot;</span>

dat <span class="o">&lt;-</span> rbind<span class="p">(</span>russia<span class="p">,</span> ukraine<span class="p">,</span> belarus<span class="p">)</span>

dlong <span class="o">&lt;-</span> dat <span class="o">%&gt;%</span>
  select<span class="p">(</span><span class="o">-</span>Total<span class="p">)</span> <span class="o">%&gt;%</span>
  gather<span class="p">(</span>Gender<span class="p">,</span> lex<span class="p">,</span> Female<span class="o">:</span>Male<span class="p">)</span>

write.csv<span class="p">(</span>dlong<span class="p">,</span> <span class="s">&#39;data.csv&#39;</span><span class="p">)</span>
</pre></div>


<p>In a nutshell, the above code reads in each of the three text files, identifies the country the data correspond to, then combines them.  It then uses functions from the <a href="http://cran.r-project.org/web/packages/dplyr/index.html">dplyr</a> and <a href="http://cran.r-project.org/web/packages/tidyr/index.html">tidyr</a> to convert the data to "tidy" (long) format, which is what I want for visualization.  I then saved the data as a CSV and moved it to a new folder where I would create my Shiny app.  </p>
<p>A Shiny app requires two files to run: <strong>server.R</strong>, which specifies the data analysis/visualization to show, and <strong>ui.R</strong>, in which you prepare the user interface.  An optional third file (which I haven't used here), <strong>global.R</strong>, can be used to read in data or do any background data preparation that you want to make available to both the server and UI scripts.  I largely adapted my server and UI code from <a href="http://shiny.rstudio.com/tutorial/">RStudio's Shiny tutorials</a> and <a href="http://ramnathv.github.io/rChartsShiny/">Ramnath Vaidyanathan's tutorial on using rCharts with Shiny</a>, with some help from StackOverflow as well.  </p>
<p>I prepared the UI first with the code below.  </p>
<div class="highlight"><pre><span class="c1"># ui.R</span>

library<span class="p">(</span>rCharts<span class="p">)</span>

dat <span class="o">&lt;-</span> read.csv<span class="p">(</span><span class="s">&#39;data.csv&#39;</span><span class="p">)</span>

<span class="c1"># Define UI </span>
shinyUI<span class="p">(</span>fluidPage<span class="p">(</span>

  <span class="c1"># Sidebar </span>
  sidebarLayout<span class="p">(</span>
    sidebarPanel<span class="p">(</span>
      selectInput<span class="p">(</span>inputId <span class="o">=</span> <span class="s">&quot;country&quot;</span><span class="p">,</span> 
                  label <span class="o">=</span> <span class="s">&quot;Select a country:&quot;</span><span class="p">,</span> 
                  choices <span class="o">=</span> c<span class="p">(</span><span class="s">&quot;Russia&quot;</span><span class="p">,</span> <span class="s">&quot;Belarus&quot;</span><span class="p">,</span> <span class="s">&quot;Ukraine&quot;</span><span class="p">),</span> 
                  selected <span class="o">=</span> <span class="s">&quot;Russia&quot;</span><span class="p">),</span> 
      sliderInput<span class="p">(</span><span class="s">&quot;range&quot;</span><span class="p">,</span>
                  label <span class="o">=</span> <span class="s">&quot;Years to display:&quot;</span><span class="p">,</span>
                  min <span class="o">=</span> <span class="m">1959</span><span class="p">,</span>
                  max <span class="o">=</span> <span class="m">2010</span><span class="p">,</span>
                  value <span class="o">=</span> c<span class="p">(</span><span class="m">1959</span><span class="p">,</span> <span class="m">2010</span><span class="p">),</span> 
                  format <span class="o">=</span> <span class="s">&quot;0000&quot;</span><span class="p">),</span> 
      helpText<span class="p">(</span><span class="s">&quot;Data reflect the life expectancy &quot;</span><span class="p">,</span> 
                <span class="s">&quot;at birth from 1959 to 2010 &quot;</span><span class="p">,</span> 
               <span class="s">&quot;for men and women in Russia, &quot;</span><span class="p">,</span> 
                <span class="s">&quot;Belarus, and Ukraine.  Data are &quot;</span><span class="p">,</span> 
               <span class="s">&quot;obtained from the Human Mortality &quot;</span><span class="p">,</span> 
                <span class="s">&quot;Database, a project of &quot;</span><span class="p">,</span> 
                <span class="s">&quot; the University of California, &quot;</span><span class="p">,</span> 
                <span class="s">&quot;Berkeley (USA), and Max Planck &quot;</span><span class="p">,</span> 
                <span class="s">&quot;Institute for Demographic Research &quot;</span><span class="p">,</span> 
                <span class="s">&quot;(Germany). Data are available &quot;</span><span class="p">,</span> 
                <span class="s">&quot;at www.mortality.org or www.humanmortality.de &quot;</span><span class="p">,</span> 
               <span class="s">&quot;(downloaded on 14 Oct 2014).&quot;</span><span class="p">)</span>
    <span class="p">),</span>

    <span class="c1"># Show the plot </span>
    mainPanel<span class="p">(</span>
      showOutput<span class="p">(</span><span class="s">&quot;lexplot&quot;</span><span class="p">,</span> <span class="s">&quot;highcharts&quot;</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="p">)</span>
<span class="p">))</span>
</pre></div>


<p>In the <strong>ui.R</strong> script, I define the parameters of the Shiny user interface.  I'll have a drop-down menu to select the country of choice (Russia, Belarus, or Ukraine), as well as a time slider that allows the user to specify the years to show in the chart.  I then use the <code>showOutput</code> function from rCharts in the <code>mainPanel</code> call to tell Shiny to show my chart in the main area.  </p>
<p>Next, I set up the server.  </p>
<div class="highlight"><pre><span class="c1"># server.R</span>

library<span class="p">(</span>rCharts<span class="p">)</span>

dat <span class="o">&lt;-</span> read.csv<span class="p">(</span><span class="s">&#39;data.csv&#39;</span><span class="p">)</span>

options<span class="p">(</span>RCHART_WIDTH <span class="o">=</span> <span class="m">500</span><span class="p">)</span>

shinyServer<span class="p">(</span><span class="kr">function</span><span class="p">(</span>input<span class="p">,</span> output<span class="p">)</span> <span class="p">{</span>
  output<span class="o">$</span>lexplot <span class="o">&lt;-</span> renderChart2<span class="p">({</span>
    selected <span class="o">&lt;-</span> input<span class="o">$</span>country
    country <span class="o">&lt;-</span> subset<span class="p">(</span>dat<span class="p">,</span> country <span class="o">==</span> selected <span class="o">&amp;</span> Year <span class="o">%in%</span> seq<span class="p">(</span>input<span class="o">$</span>range<span class="p">[</span><span class="m">1</span><span class="p">],</span> input<span class="o">$</span>range<span class="p">[</span><span class="m">2</span><span class="p">],</span> <span class="m">1</span><span class="p">))</span>
    h1 <span class="o">&lt;-</span> hPlot<span class="p">(</span>
      x <span class="o">=</span> <span class="s">&quot;Year&quot;</span><span class="p">,</span> 
      y <span class="o">=</span> <span class="s">&quot;lex&quot;</span><span class="p">,</span> 
      group <span class="o">=</span> <span class="s">&quot;Gender&quot;</span><span class="p">,</span> 
      data <span class="o">=</span> country<span class="p">,</span> 
      type <span class="o">=</span> <span class="s">&quot;line&quot;</span><span class="p">)</span>

    h1<span class="o">$</span>colors<span class="p">(</span>c<span class="p">(</span><span class="s">&quot;red&quot;</span><span class="p">,</span> <span class="s">&quot;blue&quot;</span><span class="p">))</span>
    h1<span class="o">$</span>yAxis<span class="p">(</span>title <span class="o">=</span> list<span class="p">(</span>enabled <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> text <span class="o">=</span> <span class="s">&#39;Life expectancy at birth&#39;</span><span class="p">))</span>
    <span class="kr">return</span><span class="p">(</span>h1<span class="p">)</span>
  <span class="p">})</span>
<span class="p">})</span>
</pre></div>


<p>The key here to get this to work is to make sure that your <strong>server.R</strong> and <strong>ui.R</strong> scripts communicate correctly.  My UI takes an input that is dependent upon the country and years selected by the user, so I create a subsetted data frame, <code>country</code>, within the <code>renderChart2</code> function that will respond to that.  I then specify the parameters of the Highchart plot, and tell my <code>renderChart2</code> function to return that plot and assign it to the <code>lexplot</code> property of the output, which is what my user interface script will expect.  </p>
<p>RStudio will know that you are creating a Shiny app (given the names of your scripts), so you can simply click the <strong>Run App</strong> button to run your app locally, and then deploy it to ShinyApps if you'd like.  Now, let's take a look at the result.  Use the drop-down menu to select a country, and the time slider to specify a range of years to display.   </p>
<iframe src="https://walkerke.shinyapps.io/lex_former_ussr/" height="500" width="850" frameBorder = "0" scrolling = "no" seamless></iframe>

<p>I now have an application that allows me to seamlessly switch between countries, change years, and explore the data thanks to Highcharts' built-in interactivity.  The charts reveal key trends in life expectancy both pre- and post- USSR.  In Russia, for example, we see that life expectancy declines through the mid-20th century, then peaks in the 1980s, <a href="http://www.rand.org/pubs/conf_proceedings/CF124/cf124.chap4.html">which is attributed to Mikhail Gorbachev's anti-alcohol campaign.</a>  Life expectancy then falls dramatically around the time that the USSR dissolved.  For example, male life expectancy in 1994 in Russia was a little over 57, around 7.5 years less than its peak in 1987.  <a href="http://www.ncbi.nlm.nih.gov/pubmed/9508159">Studies have attributed this to a variety of factors, including alcohol abuse, poor nutrition and health behaviors, and problems with the health care system.</a>  However, life expectancy improves in the late 2000s, <a href="http://www.demographic-research.org/volumes/vol28/32/28-32.pdf">in part due to declines in cardiovascular disease and homicides</a>.  </p>
<p>In class, I first presented the chart (which displays very nicely in a <a href="http://ramnathv.github.io/slidify/">Slidify</a> presentation) and explored the data with my students.  I then showed my students the first segment from the documentary <a href="https://www.youtube.com/watch?v=J1OyIJtjdpo">Death of a Nation: Russia</a> by Marcel Theroux which explores some of the underlying issues behind these demographic changes in more depth.  We then used the video to collectively think about some reasons for the decline of life expectancy in Russia after the fall of the USSR.  The video paired very nicely with the interactive Shiny app; the charts provided key visual demographic context, and the video then put faces to the data.  </p>
<p>The app is fully reproducible (just make sure you download the data from <a href="http://www.mortality.org">the Human Mortality Database</a> first) and you can find the code in its <a href="https://github.com/walkerke/teaching-with-datavis/tree/master/russia-lex">GitHub repository</a>.  The chart is also available in stand-alone form here: <a href="https://walkerke.shinyapps.io/lex_former_ussr/">https://walkerke.shinyapps.io/lex_former_ussr/</a>.   Feel free to use the app as you'd like, or modify the code as you wish to create your own apps!</p>
<p><strong>Thanks to:</strong></p>
<ul>
<li>The creators of the Human Mortality Database for making their data available; </li>
<li>The <a href="http://http://www.rstudio.com/">RStudio</a> team for Shiny and all its associated training materials</li>
<li>The developers of rCharts and Highcharts</li>
</ul></div>
	
        <hr>
    	   
    </div>
        </div>
        
        <div class="span3">

            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Site
                </li>
            
                <li><a href="http://walkerke.github.io/archives.html">Archives</a>
                <li><a href="http://walkerke.github.io/tags.html">Tags</a>
                <li><a href="http://walkerke.github.io/" rel="alternate">Atom feed</a></li>
            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Categories
                </li>
                
                <li><a href="http://walkerke.github.io/category/misc.html">misc</a></li>
                   
            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Links
                </li>
            
                <li><a href="http://kylewalkertcu.wordpress.com/">Professional website</a></li>
                <li><a href="http://his.tcu.edu/">TCU Dept. of History & Geography</a></li>
                <li><a href="http://www.tcu.edu">TCU</a></li>
                <li><a href="http://www.r-bloggers.com/">R-bloggers</a></li>
            </ul>
            </div>


            <div class="social">
            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Social
                </li>
           
                <li><a href="https://twitter.com/kyle_e_walker">Twitter</a></li>
                <li><a href="https://github.com/walkerke">Github</a></li>
                <li><a href="http://www.linkedin.com/in/walkerke">LinkedIn</a></li>
            </ul>
            </div>
            </div>

        </div>  
    </div>     </div> 
<footer>
<br />
<p><a href="http://walkerke.github.io">Teaching with Interactive Data Visualization</a> &copy; Kyle Walker 2014</p>
</footer>

</div> <!-- /container -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="http://walkerke.github.io/theme/bootstrap-collapse.js"></script>
<script>var _gaq=[['_setAccount','UA-51388803-1'],['_trackPageview']];(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.src='//www.google-analytics.com/ga.js';s.parentNode.insertBefore(g,s)}(document,'script'))</script>
 
</body>
</html>